

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Engines &mdash; SSAGES 0.9.3 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Collective Variables" href="Collective%20Variables.html" />
    <link rel="prev" title="Input Files" href="Input%20Files.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SSAGES
          

          
          </a>

          
            
            
              <div class="version">
                0.9.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Getting%20Started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Input%20Files.html">Input Files</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Engines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#lammps">LAMMPS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building">Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running">Running</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gromacs">GROMACS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Running</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#openmd">OpenMD</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Running</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#qbox">Qbox</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Running</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-on-clusters">Running on Clusters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hoomd-blue">HOOMD-blue</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Running</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Collective%20Variables.html">Collective Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="Advanced%20Sampling%20Methods.html">Advanced Sampling Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="Write%20your%20own%20Methods%20and%20CVs.html">Write Your Own CVs and Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contribute%20to%20SSAGES.html">Contribute to SSAGES</a></li>
<li class="toctree-l1"><a class="reference internal" href="The%20SSAGES%20Cookbook.html">The SSAGES Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="Acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="zReferences.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="Copyright%20and%20License.html">Copyright and License Information</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SSAGES</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Engines</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Engines.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="engines">
<span id="id1"></span><h1>Engines<a class="headerlink" href="#engines" title="Permalink to this headline">¶</a></h1>
<p>SSAGES supports multiple molecular dynamics engines. However, supported
features between MD engines. This may be the result of engine limitations
or work in progress. The table below summarizes the main features that
vary between supported engines.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 36%" />
<col style="width: 22%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Engine</p></th>
<th class="head"><p>Supported versions</p></th>
<th class="head"><p>Multi-walker</p></th>
<th class="head"><p>NPT virial</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="#lammps">LAMMPS</a></p></td>
<td><p>2010 or newer</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#gromacs">GROMACS</a></p></td>
<td><p>5.1.x, 2016.x, 2018.x</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#openmd">OpenMD</a></p></td>
<td><p>2.5, 2.6</p></td>
<td><p>no</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#qbox">Qbox</a></p></td>
<td><p>1.60 or newer</p></td>
<td><p>yes</p></td>
<td><p>no</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#hoomd-blue">HOOMD-blue</a></p></td>
<td><p>2.4.0 or newer</p></td>
<td><p>yes</p></td>
<td><p>no</p></td>
</tr>
</tbody>
</table>
<p>Special instructions on how to use SSAGES with a particular engine are
listed under the appropriate section.</p>
<div class="section" id="lammps">
<h2>LAMMPS<a class="headerlink" href="#lammps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="building">
<h3>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h3>
<p>SSAGES supports most recent versions of LAMMPS. To compile SSAGES with a
compatible version of LAMMPS, either <code class="docutils literal notranslate"><span class="pre">-DLAMMPS=YES</span></code> or
<code class="docutils literal notranslate"><span class="pre">-DLAMMPS_SRC=/path/to/LAMMPS</span></code> must be specified in the CMake command.
For example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DLAMMPS<span class="o">=</span>YES ..
make
</pre></div>
</div>
<p>will automatically download LAMMPS (version 30 Jul 2016, tagged <code class="docutils literal notranslate"><span class="pre">r15407</span></code>)
and compile SSAGES. If a user is interested in using a different version of
LAMMPS, SSAGES can download a specific stable release (must be supported) with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DLAMMPS<span class="o">=</span><span class="s2">&quot;22 Aug 2018&quot;</span> ..
</pre></div>
</div>
<p>If a user is interested in using an already-downloaded source or one with
personal modifications, then SSAGES can be pointed to that particular source
repository.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DLAMMPS_SRC<span class="o">=</span>/path/to/lammps ..
</pre></div>
</div>
<p>Because many users may take advantage of optional LAMMPS
packages, SSAGES forwards the make commands necessary to do so. To enable or
disable these packages, you can call</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make yes-package
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make no-package
</pre></div>
</div>
<p>For more information on optional packages for LAMMPS, refer to
the <a class="reference external" href="https://lammps.sandia.gov/doc/Packages.html">LAMMPS User Manual</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Once you link SSAGES to a particular LAMMPS source, you will be
<strong>unable</strong> to compile that LAMMPS source outside of SSAGES because of
SSAGES dependencies which are introduced. Be sure to backup your
repository accordingly.</p>
</div>
<p>The following stable versions of LAMMPS have been tested extensively, but we
are confident that SSAGES will also work with most other LAMMPS versions.</p>
<ul class="simple">
<li><p>10 Aug 2015</p></li>
<li><p>7 Dec 2015</p></li>
<li><p>16 Feb 2016</p></li>
<li><p>14 May 2016</p></li>
<li><p>30 Jul 2016</p></li>
<li><p>5 Nov 2016</p></li>
<li><p>17 Nov 2016</p></li>
<li><p>31 Mar 2017</p></li>
<li><p>11 Aug 2017</p></li>
<li><p>16 Mar 2018</p></li>
<li><p>22 Aug 2018</p></li>
</ul>
</div>
<div class="section" id="running">
<h3>Running<a class="headerlink" href="#running" title="Permalink to this headline">¶</a></h3>
<p>SSAGES integrates with LAMMPS though the flexible <em>fix</em> API offered
by LAMMPS. It is therefore necessary to define a SSAGES fix within
the LAMMPS input file as follows.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fix ssages all ssages
</pre></div>
</div>
<p>This directive ensures that SSAGES is able to locate the appropriate
adapter and interface with the LAMMPS library. <strong>It is very important to
name the fix “ssages” as shown above. Otherwise, SSAGES will not work
properly</strong>. It is highly recommended that the SSAGES fix command be placed
after all integrator fixes. Also, make sure that the fix is specified before
the run command, which will begin the advanced sampling simulation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Due to the nature of how SSAGES forwards commands to LAMMPS, the use
of <code class="docutils literal notranslate"><span class="pre">include</span></code> and <code class="docutils literal notranslate"><span class="pre">label/jump</span></code> within a LAMMPS input script is
currently not supported.</p>
</div>
<p>SSAGES is compatible with typical LAMMPS workflows that include equilibration
or energy minimization steps before production. So long as the SSAGES fix is not
declared, LAMMPS will run without any modification.</p>
<p>The only LAMMPS-specific property required in a SSAGES input file is the <code class="docutils literal notranslate"><span class="pre">input</span></code>
property which points to the LAMMPS input script. Details can be found on the
<a class="reference internal" href="Input%20Files.html#inputfiles"><span class="std std-ref">input files page</span></a>.</p>
</div>
</div>
<div class="section" id="gromacs">
<h2>GROMACS<a class="headerlink" href="#gromacs" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Building<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>SSAGES supports most recent versions of GROMACS. To compile SSAGES with a
compatible version of GROMACS, either <code class="docutils literal notranslate"><span class="pre">-DGROMACS=YES</span></code> or
<code class="docutils literal notranslate"><span class="pre">-DGROMACS_SRC=/path/to/GROMACS</span></code> must be specified in the CMake command.
For example,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DGROMACS<span class="o">=</span>YES ..
make
</pre></div>
</div>
<p>will automatically download GROMACS 5.1.3 and compile SSAGES.
If a user is interested in using a different version of GROMACS, SSAGES can
download a specific release (must be supported) with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DGROMACS<span class="o">=</span><span class="m">2018</span>.3 ..
</pre></div>
</div>
<p>If a user is interested in using an already-downloaded source or one with
personal modifications, then SSAGES can be pointed to that particular source
repository.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DGROMACS_SRC<span class="o">=</span>/path/to/gromacs ..
</pre></div>
</div>
<p>Common options for building GROMACS will be passed through to the GROMACS
compilation step. For instance, options such as <code class="docutils literal notranslate"><span class="pre">-DGMX_BUILD_OWN_FFTW=ON</span></code>,
<code class="docutils literal notranslate"><span class="pre">-DGMX_GPU=ON</span></code>, and <code class="docutils literal notranslate"><span class="pre">-DGMX_DOUBLE=ON</span></code> are supported. With newer versions
of the <code class="docutils literal notranslate"><span class="pre">hwloc</span></code> package, GROMACS may not be able to automatically detect the
SIMD level. A workaround is to manually specify this with
<code class="docutils literal notranslate"><span class="pre">-DGMX_SIMD=AVX2_256</span></code>, which will turn off automatic detection using the
<code class="docutils literal notranslate"><span class="pre">hwloc</span></code> package.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Once you link SSAGES to a particular GROMACS source, you will be
<strong>unable</strong> to compile that GROMACS source outside of SSAGES because of
SSAGES dependencies which are introduced. Be sure to backup your
repository accordingly.</p>
</div>
<p>The following versions of GROMACS are supported by SSAGES, but we are very
confident that SSAGES will <em>not</em> work with other versions of GROMACS out of
the box, in contrast to LAMMPS. We are working hard to make SSAGES
compatible with new versions of GROMACS, as they are released.</p>
<ul class="simple">
<li><p>5.1.x</p></li>
<li><p>2016.x</p></li>
<li><p>2018.x</p></li>
</ul>
</div>
<div class="section" id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<p>After compiling GROMACS with SSAGES, you can use all of GROMACS’s available
tools to set up systems and generate input files. The executable is located at
<code class="docutils literal notranslate"><span class="pre">hooks/gromacs/gromacs/bin/gmx_ssages</span></code> within the build directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that, the <code class="docutils literal notranslate"><span class="pre">gmx_ssages</span></code> executable in the SSAGES folder will NOT
function normally for running regular GROMACS simulations via
<code class="docutils literal notranslate"><span class="pre">gmx_ssages</span> <span class="pre">mdrun</span></code>.</p>
</div>
<p>As GROMACS has in-depth
<a class="reference external" href="http://manual.gromacs.org/documentation/current/user-guide/">Documentation</a>
and a helpful
<a class="reference external" href="http://manual.gromacs.org/documentation/current/user-guide/getting-started.html">Getting Started</a>
section, we will not dwell much on how to use these tools to generate systems.</p>
<p>Briefly, generating a GROMACS binary input file (<code class="docutils literal notranslate"><span class="pre">.tpr</span></code>) requires the
following three files:</p>
<ol class="arabic simple">
<li><p>A “box” of particle coordinates to simulate (<code class="docutils literal notranslate"><span class="pre">.gro</span></code> file)</p></li>
<li><p>A topology that describes the forcefield and connectivity (<code class="docutils literal notranslate"><span class="pre">.top</span></code> file,
optionally <code class="docutils literal notranslate"><span class="pre">.itp</span></code> files)</p></li>
<li><p>A simulation detail file that sets parameters such as which thermostat
and barostat to use, number and length of time steps, integrator, saving
frequency, and many more (<code class="docutils literal notranslate"><span class="pre">.mdp</span></code> file)</p></li>
</ol>
<p>For example, one can convert a protein <code class="docutils literal notranslate"><span class="pre">.pdb</span></code> file from an
<a class="reference external" href="https://www.rcsb.org/">online database</a> using GROMACS tools to generate
a <code class="docutils literal notranslate"><span class="pre">.gro</span></code> and a <code class="docutils literal notranslate"><span class="pre">.top</span></code> file. To generate an input file, use the preprocessor
<code class="docutils literal notranslate"><span class="pre">gmx_ssages</span> <span class="pre">grompp</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gmx_ssages grompp -f npt.mdp -p topol.top -c conf.gro -o input.tpr
</pre></div>
</div>
<p>There are example <code class="docutils literal notranslate"><span class="pre">.gro</span></code>, <code class="docutils literal notranslate"><span class="pre">.mdp</span></code>, <code class="docutils literal notranslate"><span class="pre">.top</span></code>, <code class="docutils literal notranslate"><span class="pre">.tpr</span></code>, and <code class="docutils literal notranslate"><span class="pre">.json</span></code> inputs
available in the Examples folder.</p>
<p>After an energy minimization and brief NVT and NPT equilibration runs, you
should be ready to use SSAGES with your system. First, generate a <code class="docutils literal notranslate"><span class="pre">.json</span></code>
file for your SSAGES input. If using a single walker, the <code class="docutils literal notranslate"><span class="pre">inputfile</span></code> should
be the same as your <code class="docutils literal notranslate"><span class="pre">.tpr</span></code> file name. If using multiple walkers, you should
number your input files right before the extension, include a numberless file,
and set the “inputfile” to be the same as the numberless. For example, if using
four walkers, you should set your “inputfile” to <code class="docutils literal notranslate"><span class="pre">input.tpr</span></code> and have the
following in your folder:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input.tpr</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input0.tpr</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input1.tpr</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input2.tpr</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input3.tpr</span></code></p></li>
</ul>
<p>Finally, define your CV(s) and Methods, as detailed in the
<a class="reference internal" href="Input%20Files.html#inputfiles"><span class="std std-ref">input files</span></a> page.</p>
</div>
<div class="section" id="id3">
<h3>Running<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>SSAGES forwards arguments to the GROMACS <strong>mdrun</strong> library. The
<code class="docutils literal notranslate"><span class="pre">args</span></code> property must specified in the SSAGES input file as
described on the <a class="reference internal" href="Input%20Files.html#inputfiles"><span class="std std-ref">input files</span></a> page.</p>
<p>You can start your simulation by calling the SSAGES executable:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpiexec -np N ./ssages input.json
</pre></div>
</div>
<p>where <cite>N</cite> is the total number of MPI processes. For example, for three walkers
using 2 processors each, set <span class="math notranslate nohighlight">\(N = 3*2 = 6\)</span>.</p>
</div>
</div>
<div class="section" id="openmd">
<h2>OpenMD<a class="headerlink" href="#openmd" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id4">
<h3>Building<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>SSAGES supports most recent versions of OpenMD. To compile SSAGES with a
compatible version of OpenMD, the location of the already-downloaded source
must be specified in the CMake command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DOPENMD_SRC<span class="o">=</span>/path/to/OpenMD ..
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Once you link SSAGES to a particular OpenMD source, you will be
<strong>unable</strong> to compile that OpenMD source outside of SSAGES because of
SSAGES dependencies which are introduced. Be sure to backup your
repository accordingly.</p>
</div>
<p>The following versions of OpenMD are supported by SSAGES, but we are very
confident that SSAGES will <em>not</em> work with other versions of OpenMD out of
the box, in contrast to LAMMPS.</p>
<ul class="simple">
<li><p>2.5</p></li>
<li><p>2.6</p></li>
</ul>
</div>
<div class="section" id="id5">
<h3>Running<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The only OpenMD-specific property required in a SSAGES input file is the <code class="docutils literal notranslate"><span class="pre">input</span></code>
property which points to the OpenMD input script. Details can be found on the
<a class="reference internal" href="Input%20Files.html#inputfiles"><span class="std std-ref">input files page</span></a>.</p>
</div>
</div>
<div class="section" id="qbox">
<h2>Qbox<a class="headerlink" href="#qbox" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id6">
<h3>Building<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>SSAGES and Qbox can be run together to use advanced sampling methods in
<em>ab initio</em> molecular dynamics simulations. The coupling with Qbox is performed
in a server–driver mode, with SSAGES acting as the driver and Qbox as the
server. This means that if you have access to a version of Qbox (minimum 1.60)
you do not need to recompile SSAGES and Qbox together. However, it is necessary
to configure SSAGES to be used with Qbox, so that it will compile the correct
Hook and Driver. To do so, add the following flag during the configuration of
SSAGES:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake -DQBOX<span class="o">=</span>YES ..
</pre></div>
</div>
<p>It is important to remark that in this case, <strong>SSAGES will not automatically
download Qbox</strong>, it will be simply configured so to communicate with it. You
are required to have access to a Qbox executable. If you do not have access to
a pre-compiled version, then you will need to
<a class="reference external" href="http://qboxcode.org/build/">download and compile it yourself</a>.</p>
</div>
<div class="section" id="id7">
<h3>Setup<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>As for other engines, there are two input scripts necessary to run a
Qbox–SSAGES calculation composed of <code class="docutils literal notranslate"><span class="pre">N</span></code> walkers:</p>
<ol class="arabic simple">
<li><p>A JSON input file, specifying the methods and CVs that you want to use.
Also, it specifies the Qbox input file names and the number of MD, density,
and wavefunction steps that you want to use.</p></li>
<li><p>A number <code class="docutils literal notranslate"><span class="pre">N</span></code> of Qbox input files, that will be used in the first step of
the calculation to obtain the ground state density in the first step.</p></li>
</ol>
<p>The JSON file contains the same field that would usually have (CVs, methods, logger, etc.) with three additional options:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
        <span class="s2">&quot;walkers&quot;</span><span class="o">:</span> <span class="nx">N</span><span class="p">,</span>
        <span class="s2">&quot;input&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;md.1&quot;</span><span class="p">,</span> <span class="s2">&quot;md.2&quot;</span><span class="p">,</span> <span class="p">...,</span> <span class="s2">&quot;md.N&quot;</span><span class="p">],</span>
        <span class="s2">&quot;md_iterations&quot;</span> <span class="o">:</span> <span class="mf">10</span><span class="p">,</span>
        <span class="s2">&quot;qm_iterations&quot;</span> <span class="o">:</span> <span class="mf">30</span><span class="p">,</span>
        <span class="s2">&quot;wf_iterations&quot;</span> <span class="o">:</span> <span class="mf">1</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The keywords <code class="docutils literal notranslate"><span class="pre">walkers</span></code> and <code class="docutils literal notranslate"><span class="pre">input</span></code> are the standard SSAGES keywords to
declare the number of walkers and the starting input file of each walker. The
keywords <code class="docutils literal notranslate"><span class="pre">md_iterations</span></code>, <code class="docutils literal notranslate"><span class="pre">qm_iterations</span></code> and <code class="docutils literal notranslate"><span class="pre">wf_iterations</span></code>  are the
respectively the number of MD steps to perform, the number of <cite>scf</cite> to perform
per MD step, and the number of wave-function optimization per <cite>scf</cite> steps.
These parameters correspond to the first, second and third number in the
command <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">20</span> <span class="pre">10</span> <span class="pre">0</span></code>. Consult the
<a class="reference external" href="http://qboxcode.org/doc/html/">Qbox Documentation</a> for more information.</p>
<p>The Qbox input file of each walker, specifies the parameters to be used in the
DFT calculations (<code class="docutils literal notranslate"><span class="pre">xc</span></code>, <code class="docutils literal notranslate"><span class="pre">ecut</span></code>, <code class="docutils literal notranslate"><span class="pre">T</span></code>, etc.). This file will be parsed by
Qbox <strong>at the first time step of the simulations</strong> to set up the calculations.
If the file contains a command such as <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">200</span> <span class="pre">10</span></code>, the 200 MD steps that
Qbox will perform <strong>will be unbiased</strong>. If wanted, this feature can be used to
equilibrate the system. After this first step, the command
<code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">1</span> <span class="pre">qm_iterations</span> <span class="pre">wf_iterations</span></code> will be repeated for <code class="docutils literal notranslate"><span class="pre">md_iterations</span></code>.
<strong>The QBox input file must contain at least 1 MD step in order to run with SSAGES.</strong>
Thus always include the <code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">1</span></code> command.</p>
<p>An example of <code class="docutils literal notranslate"><span class="pre">input.json</span></code> and <code class="docutils literal notranslate"><span class="pre">md.i</span></code> is present in the <code class="docutils literal notranslate"><span class="pre">Examples/User/ABF/NaCl-Qbox</span></code> directory.</p>
</div>
<div class="section" id="id8">
<h3>Running<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>As previously reported, Qbox and SSAGES communicate in a server–driver mode.
To launch Qbox in a server mode is sufficient to use the proper keyword and
specify its input and output file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun -n X qb -server ssages_in_0 ssages_out_0
</pre></div>
</div>
<p>for a single walker or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpirun -n X qb -server ssages_in_0 ssages_out_0
mpirun -n X qb -server ssages_in_1 ssages_out_1
....
mpirun -n X qb -server ssages_in_N ssages_out_N
</pre></div>
</div>
<p>for multiple walkers. At the moment, the name <code class="docutils literal notranslate"><span class="pre">ssages_in_</span></code> and
<code class="docutils literal notranslate"><span class="pre">ssages_out_</span></code> are <strong>mandatory</strong> and cannot be changed. When launched in this
way, Qbox creates <code class="docutils literal notranslate"><span class="pre">N</span></code> files called <code class="docutils literal notranslate"><span class="pre">ssages_in_N.lock</span></code>, and then wait for
input. When the files <code class="docutils literal notranslate"><span class="pre">ssages_in_N.lock</span></code> are deleted from disk, Qbox will
execute the commands contained in the files <code class="docutils literal notranslate"><span class="pre">ssages_in_N</span></code>, write the result
of the calculation in <code class="docutils literal notranslate"><span class="pre">ssages_out_N</span></code>, and create N <code class="docutils literal notranslate"><span class="pre">ssages_in_N.lock</span></code>
files. Without the deletion of the <code class="docutils literal notranslate"><span class="pre">.lock</span></code> files, Qbox will not execute any
command and will remain idle.</p>
<p>After Qbox has started the server mode run (so it is idling and the <code class="docutils literal notranslate"><span class="pre">.lock</span></code>
files are present on disk), we can launch SSAGES to drive the calculations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mpirun</span> <span class="o">-</span><span class="n">n</span> <span class="n">N</span> <span class="n">ssages</span> <span class="nb">input</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>After SSAGES has started, the two codes will alternate with each other in the
following way:</p>
<ol class="arabic simple">
<li><p>SSAGES will write the script <code class="docutils literal notranslate"><span class="pre">md.i</span></code> to file <code class="docutils literal notranslate"><span class="pre">ssages_in_i</span></code>, which will
initialize the DFT parameters of the calculations. Then, it will trigger
Qbox execution by deleting the <code class="docutils literal notranslate"><span class="pre">.lock</span></code> files.</p></li>
<li><p>Qbox will perform the DFT calculation specified in <code class="docutils literal notranslate"><span class="pre">ssages_in_i</span></code> and write
the output in <code class="docutils literal notranslate"><span class="pre">ssages_out_i</span></code> and will recreate the <code class="docutils literal notranslate"><span class="pre">.lock</span></code> files.</p></li>
<li><p>SSAGES will read the Qbox output, calculate the CVs and the bias, and write
to the files <code class="docutils literal notranslate"><span class="pre">ssages_in_i</span></code>, containing the external forces and the
position of the atoms, as well as the command
<code class="docutils literal notranslate"><span class="pre">run</span> <span class="pre">1</span> <span class="pre">qm_iterations</span> <span class="pre">wf_iterations</span></code>. It will then delete the <code class="docutils literal notranslate"><span class="pre">.lock</span></code>
file, triggering another MD step calculation in Qbox.</p></li>
<li><p>Steps 2 and 3 will be repeated for <code class="docutils literal notranslate"><span class="pre">md_iterations</span></code> number of time.</p></li>
<li><p>After the last iteration, SSAGES will write an input file that will instruct
Qbox to save a <code class="docutils literal notranslate"><span class="pre">restart_i.xml</span></code> file that can be used to restart the
calculations, and terminate the Qbox instance.</p></li>
<li><p>Qbox and SSAGES will then finish the execution.</p></li>
</ol>
<p>Normally, Qbox overwrites the output <code class="docutils literal notranslate"><span class="pre">ssages_out_i</span></code> in server mode. To
preserve the trajectory and avoid the loss of data, SSAGES will append the
<code class="docutils literal notranslate"><span class="pre">ssages_out_i</span></code> file to a <code class="docutils literal notranslate"><span class="pre">ssages_out_i_run_j.xml</span></code> file. In the latter, the
<code class="docutils literal notranslate"><span class="pre">i</span></code> index identifies the walker, while the <code class="docutils literal notranslate"><span class="pre">j</span></code> index identifies the number
of runs. (For example, if you restarted two times, you would have
<code class="docutils literal notranslate"><span class="pre">_run_1.xml</span></code>, <code class="docutils literal notranslate"><span class="pre">_run_2.xml</span></code>, and <code class="docutils literal notranslate"><span class="pre">_run_3.xml</span></code>.) We suggest using the
<code class="docutils literal notranslate"><span class="pre">restart_i.xml</span></code> files to avoid discontinuities in the trajectories; when
restarting, create a <code class="docutils literal notranslate"><span class="pre">md.i</span></code> file that contains the <code class="docutils literal notranslate"><span class="pre">load</span> <span class="pre">restart_i.xml</span></code>
instructions.</p>
<p>There are useful scripts to analyze and plot Qbox trajectories, which are available in the <a class="reference external" href="http://qboxcode.org/tools//">Qbox tools webpage</a>. To run any of these scripts, first reformat <code class="docutils literal notranslate"><span class="pre">ssages_out_i_run_j.xml</span></code> file by running a python script <code class="docutils literal notranslate"><span class="pre">Qbox-xml-cleaning.py</span></code> present in <code class="docutils literal notranslate"><span class="pre">Tools/</span></code> directory. For example, if the original ssages-qbox output file is <code class="docutils literal notranslate"><span class="pre">ssages_out_0_run_0.xml</span></code> then the command line to reformat this xml file is</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 Qbox-xml-cleaning.py ssages_out_0_run_0.xml ssages_out_0_run_0_cleaned.xml
</pre></div>
</div>
<p>where first arugment the name of the original xml output file, and the second argument is the reformatted xml file. Now these files can be analyzed using the scripts in <a class="reference external" href="http://qboxcode.org/tools//">Qbox tools webpage</a>. For example, to create xyz trajectory file from the reformatted output  <code class="docutils literal notranslate"><span class="pre">ssages_out_0_run_0_cleaned.xml</span></code>, run the command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python2 qbox_xyz.py -all ssages_out_0_run_0_cleaned.xml &gt; out_0_run_0.xyz
</pre></div>
</div>
</div>
<div class="section" id="running-on-clusters">
<h3>Running on Clusters<a class="headerlink" href="#running-on-clusters" title="Permalink to this headline">¶</a></h3>
<p>Most likely, you are going to launch this calculation on a cluster or a
supercomputer, where you will need to prepare a submission scripts and then
launch through a job scheduler. Given the fact that SSAGES needs to start
<em>after</em> Qbox, it is better to either separate the scripts that submit the two
different calculations, or use a syntax that ensure that the submission occurs
in the right order. For example, on <a class="reference external" href="https://slurm.schedmd.com/">Slurm</a>, we
can use one script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun -n X  -N <span class="m">1</span> qb -server ssages_in0 ssages_out0  <span class="p">&amp;</span>
srun -n X  -N <span class="m">1</span> qb -server ssages_in1 ssages_out1  <span class="p">&amp;</span>
srun -n <span class="m">2</span>  -N <span class="m">1</span> ssages input.json <span class="p">&amp;</span>
<span class="nb">wait</span>
</pre></div>
</div>
<p>which ensures that the scripts are executed in the right way.</p>
<p>If you want to have different scripts for Qbox and SSAGES:</p>
<p>In the Qbox scripts, <code class="docutils literal notranslate"><span class="pre">qb.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun -n X  -N <span class="m">1</span> qb -server ssages_in0 ssages_out0
srun -n X  -N <span class="m">1</span> qb -server ssages_in1 ssages_out1
</pre></div>
</div>
<p>In the SSAGES script, <code class="docutils literal notranslate"><span class="pre">ssages.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun -n <span class="m">2</span>  -N <span class="m">1</span> ssages input.json
</pre></div>
</div>
<p>Then you will need to submit both of them with a third script, <code class="docutils literal notranslate"><span class="pre">launch.sh</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">j_qb</span><span class="o">=</span><span class="sb">`</span>sbatch qb.sh <span class="p">|</span> awk <span class="s1">&#39;{print $4}&#39;</span><span class="sb">`</span>

sbatch --dependency<span class="o">=</span>after:<span class="si">${</span><span class="nv">j_qb</span><span class="si">}</span> ssages.sh
</pre></div>
</div>
<p>The advantage of the latter method, with three scripts, is that it will avoid
conflict between modules, which may be present in the first example, depending
on how you have compiled Qbox and SSAGES.</p>
</div>
</div>
<div class="section" id="hoomd-blue">
<h2>HOOMD-blue<a class="headerlink" href="#hoomd-blue" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id10">
<h3>Building<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>HOOMD-blue supports SSAGES in releases v2.4.0 and later. HOOMD-blue must be built
with <strong>MPI support enabled</strong>, using the HOOMD CMake flag <code class="docutils literal notranslate"><span class="pre">-DENABLE_MPI=ON</span></code>.
It is recommended to use a Python virtual environment with HOOMD-blue, as
described in <a class="reference external" href="https://hoomd-blue.readthedocs.io/en/stable/installation.html#compile-hoomd-blue">the HOOMD compilation instructions</a>.
With the virtual environment active, building HOOMD-blue and SSAGES from source
can use Python to appropriately set relevant CMake variables.
For example (using 8 <code class="docutils literal notranslate"><span class="pre">make</span></code> job slots),</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /path/to/HOOMD
mkdir build
<span class="nb">cd</span> build/
python3 -m venv /path/to/new/virtual/environment --system-site-packages
<span class="nb">source</span> /path/to/new/virtual/environment/bin/activate
cmake .. -DCMAKE_INSTALL_PREFIX<span class="o">=</span><span class="k">$(</span>python3 -c <span class="s2">&quot;import site; print(site.getsitepackages()[0])&quot;</span><span class="k">)</span> -DENABLE_MPI<span class="o">=</span>ON
make install -j <span class="m">8</span>

<span class="nb">cd</span> /path/to/SSAGES
mkdir build
<span class="nb">cd</span> build/
cmake .. -DHOOMD<span class="o">=</span>ON
make -j <span class="m">8</span>
</pre></div>
</div>
<p>Alternatively, HOOMD can be built using <code class="docutils literal notranslate"><span class="pre">make</span></code> (without installation) using
the HOOMD CMake flag <code class="docutils literal notranslate"><span class="pre">-DCOPY_HEADERS=ON</span></code>.
For more information on HOOMD CMake flags, see <a class="reference external" href="https://hoomd-blue.readthedocs.io/en/stable/installation.html">the HOOMD documentation</a>.
In this case, you must specify the SSAGES CMake flag
<code class="docutils literal notranslate"><span class="pre">-DHOOMD_ROOT=/path/to/hoomd_installation/hoomd</span></code>,
pointing to the <code class="docutils literal notranslate"><span class="pre">hoomd</span></code> directory within the HOOMD-blue installation prefix.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /path/to/HOOMD
mkdir build
<span class="nb">cd</span> build/
cmake .. -DCOPY_HEADERS<span class="o">=</span>ON -DENABLE_MPI<span class="o">=</span>ON
make -j <span class="m">8</span>

<span class="nb">cd</span> /path/to/SSAGES
mkdir build
<span class="nb">cd</span> build/
cmake .. -DHOOMD_ROOT<span class="o">=</span>/path/to/HOOMD/build/hoomd
make -j <span class="m">8</span>
</pre></div>
</div>
<p>It may be necessary to put the HOOMD build directory in your <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>,
so that your Python interpreter can find the <code class="docutils literal notranslate"><span class="pre">hoomd</span></code> module. Set this
variable with the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PYTHONPATH</span><span class="si">}</span><span class="s2">:/path/to/hoomd/build&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h3>Running<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>HOOMD-blue offers a “half-step hook” API to support SSAGES.
This feature is automatically configured when SSAGES launches
the HOOMD-blue simulation.</p>
<p>The HOOMD-blue SSAGES user script is written in Python. This script should
contain necessary <code class="docutils literal notranslate"><span class="pre">import</span></code> statements, configure the simulation, and set
types, interactions, integrators, log outputs and so forth. However, the
simulation user script should <em>not</em> call <code class="docutils literal notranslate"><span class="pre">hoomd.run(steps)</span></code> as this will
be called within SSAGES.</p>
<p>To set
<a class="reference external" href="https://hoomd-blue.readthedocs.io/en/v2.5.0/command-line-options.html">HOOMD-blue command-line options</a>,
use the SSAGES JSON input file. Set the key <code class="docutils literal notranslate"><span class="pre">&quot;args&quot;</span></code> with a string of command
line options that will be passed to <code class="docutils literal notranslate"><span class="pre">hoomd.context.initialize()</span></code>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Collective%20Variables.html" class="btn btn-neutral float-right" title="Collective Variables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Input%20Files.html" class="btn btn-neutral float-left" title="Input Files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, the SSAGES Team.
      <span class="lastupdated">
        Last updated on Jun 04, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>