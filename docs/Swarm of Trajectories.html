

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Swarm of Trajectories &mdash; SSAGES 0.9.3 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Umbrella Sampling" href="Umbrella%20Sampling.html" />
    <link rel="prev" title="Metadynamics" href="Metadynamics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SSAGES
          

          
          </a>

          
            
            
              <div class="version">
                0.9.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Getting%20Started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="Input%20Files.html">Input Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="Engines.html">Engines</a></li>
<li class="toctree-l1"><a class="reference internal" href="Collective%20Variables.html">Collective Variables</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="Advanced%20Sampling%20Methods.html">Advanced Sampling Methods</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Adaptive%20Biasing%20Force%20Algorithm.html">Adaptive Biasing Force Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="Artificial%20Neural%20Network%20Sampling.html">Artificial Neural Network Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Basis%20Function%20Sampling.html">Basis Function Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Combined%20Force-Frequency%20Sampling.html">Combined Force-Frequency Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Elastic%20Band.html">Elastic Band</a></li>
<li class="toctree-l2"><a class="reference internal" href="Finite%20Temperature%20String.html">Finite Temperature String</a></li>
<li class="toctree-l2"><a class="reference internal" href="Forward-Flux.html">Forward-Flux</a></li>
<li class="toctree-l2"><a class="reference internal" href="Metadynamics.html">Metadynamics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Swarm of Trajectories</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#options-parameters">Options &amp; Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tutorial">Tutorial</a></li>
<li class="toctree-l3"><a class="reference internal" href="#developer">Developer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Umbrella%20Sampling.html">Umbrella Sampling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Write%20your%20own%20Methods%20and%20CVs.html">Write Your Own CVs and Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contribute%20to%20SSAGES.html">Contribute to SSAGES</a></li>
<li class="toctree-l1"><a class="reference internal" href="The%20SSAGES%20Cookbook.html">The SSAGES Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="Acknowledgements.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="zReferences.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="Copyright%20and%20License.html">Copyright and License Information</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SSAGES</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="Advanced%20Sampling%20Methods.html">Advanced Sampling Methods</a> &raquo;</li>
        
      <li>Swarm of Trajectories</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Swarm of Trajectories.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="swarm-of-trajectories">
<h1>Swarm of Trajectories<a class="headerlink" href="#swarm-of-trajectories" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Like all string methods in general, the <strong>String Method with Swarms of
Trajectories</strong> (often abbreviated to “Swarm of Trajectories” or even more simply
“SoT”) is a method to identify a transition pathway in an arbitrarily
high-dimensional collective variable space between two metastable states of a
system. This pathway (the string) is a parametrized curve discretized into a
set of images, each of which is itself a molecular system. The classical <em>String
Method in Collective Variables</em> <span id="id1">[<a class="reference internal" href="zReferences.html#id24">15</a>]</span>
evolves each image by estimating a mean force and
metric tensor at each image with restrained molecular dynamics simulations. In
the SoT method, the string is instead evolved by launching a large number (a
swarm) of <strong>unrestrained</strong> trajectories from each image and estimating the average
drift of the collective variables over the swarm.</p>
<p>The mathematical background of the method can be expressed in a few relatively
straightforward equations, with further detail available in the original work of
Benoît Roux and collaborators <span id="id2">[<a class="reference internal" href="zReferences.html#id25">17</a>]</span>.
First, consider a path <span class="math notranslate nohighlight">\(z(\alpha)\)</span>
constructed between two metastable states, such that <span class="math notranslate nohighlight">\(\alpha=0\)</span> represents
the starting state and <span class="math notranslate nohighlight">\(\alpha=1\)</span> is the final state. The “Most Probable
Transition Pathway” (MPTP) is defined such that a molecular system started from
anywhere on the path will most probably evolve while staying on the path. It is
shown in the original work that a mathematical definition for such a path is
given when the collective variables evolve according to:</p>
<div class="math notranslate nohighlight">
\[z_{i}(\alpha) = z_{i}(\alpha') + \sum\limits_{j}\left(
\beta D_{ij}\left[ z(0) \right] F_{j}\left[z(0)\right] +
\frac{\partial}{\partial z_{j}}\left( D_{ij}\left[z(0)\right]\right)
\right)\delta\tau\]</div>
<p>Where the following notation is used: <span class="math notranslate nohighlight">\(z_{i}\)</span> represents the collective
variables belonging to the string, <span class="math notranslate nohighlight">\(\alpha\)</span> represents the parameter
identifying that point on the string, <span class="math notranslate nohighlight">\(\beta\)</span> represents the temperature,
<span class="math notranslate nohighlight">\(D_{ij}\)</span> represents the diffusion tensor, <span class="math notranslate nohighlight">\(F_{j}\)</span> represents the
mean force, <span class="math notranslate nohighlight">\(z\)</span> represents the collective variables constructed from the
molecular system at a given moment in time, and <span class="math notranslate nohighlight">\(\delta\tau\)</span> represents
the time step of the evolution of the dynamics. The SoT method approximates
this equation using the average drift evaluated from a large number of unbiased
trajectories, each of length <span class="math notranslate nohighlight">\(\delta\tau\)</span>, launched from each image:</p>
<div class="math notranslate nohighlight">
\[\overline{\Delta z_{i}(\delta\tau)} =
\overline{z_{i}(\delta\tau) - z_{i}(0)} \equiv
\sum\limits_{j} \left( \beta D_{ij}\left[z(0)\right] F_{j}\left[z(0)]\right] +
\frac{\partial}{\partial z_{j}}\left( D_{ij}\left[
z(0)\right]\right)\right)\delta\tau\]</div>
<p>Like all string methods, there is an additional step beyond evolving the
collective variables - after one iteration of evolution, the images along the
path must be reparameterized such that they lie (for example) an equal arc length
apart. This step is necessary to ensure that all images do not fall into one
metastable basin or the other.</p>
<p>Algorithmically, the SoT method is implemented as follows:</p>
<ol class="arabic simple">
<li><p>An initial string is defined between the two states of interest. This can be
defined however one wishes; often it is simply a linear interpolation through
the space of the collective variables. In fact, the ends of the string need
not necessarily be in the basins of interest; the dynamic nature of the
method should allow the ends to naturally fall into nearby metastable basins.</p></li>
<li><p>For each image of the string, a molecular system with atomic coordinates that
roughly correspond to the collective variables of that image is constructed.</p></li>
<li><p>A set of equilibrium trajectories are generated from that system by performing
restrained sampling around the image’s collective variables.</p></li>
<li><p>That set of equilibrium trajectories is used as the starting point of a large
number of short unbiased trajectories; the resulting average displacement of
each collective variable is used to update the positions of the images.</p></li>
<li><p>A reparameterization scheme is enforced to ensure that, for example, the
string images are equally distant in collective variable space.</p></li>
</ol>
<p>Steps 2–5 are iterated upon, leading to convergence of the method
and the MPTP.</p>
</div>
<div class="section" id="options-parameters">
<h2>Options &amp; Parameters<a class="headerlink" href="#options-parameters" title="Permalink to this headline">¶</a></h2>
<p>To construct a Swarm input file, the following options are available. A
complete Swarm JSON file will inherit some of its inputs from the String
schema (for parameters common to all string methods).
The options unique to Swarm are:</p>
<dl class="simple">
<dt>initial_steps</dt><dd><p>For each iteration of the method, this is the number of steps to spend
doing restrained sampling and not harvesting trajectories. This time is
important to ensure the underlying molecular system’s CV values are
close to the string CV values.</p>
</dd>
<dt>harvest_length</dt><dd><p>After the initial restraining is finished, a trajectory is harvested for
later use in launching an unrestrained trajectory every so often - harvest
length specifies how often this will be done. Harvest length multiplied by
number of trajectories (see below) will determine overall how many more
steps will be taken under restrained sampling.</p>
</dd>
<dt>number_of_trajectories</dt><dd><p>The total number of unrestrained trajectories to be included in each swarm.</p>
</dd>
<dt>swarm_length</dt><dd><p>The length of each unrestrained trajectory in the swarm. Swarm length
multiplied by number of trajectories specifies how many total steps will be
spent doing unrestrained sampling.</p>
</dd>
</dl>
<p>From the String schema, the options are:</p>
<dl class="simple">
<dt>type</dt><dd><p>This parameter identifies that a String-type method is being used, and
thus should be set to “String”.</p>
</dd>
<dt>flavor</dt><dd><p>This parameter identifies the specific kind of string-type method
being used; for swarm, it should be set to “Swarm”.</p>
</dd>
<dt>centers</dt><dd><p>The initial values of each CV for each image on the string are specified
under “centers”, which is an array of size equal to the total number of
images, with each entry consisting of an array with size equal to the
number of CVs used for the string method. In this way, the initial string
is defined.</p>
</dd>
<dt>tolerance</dt><dd><p>This is a tolerance threshold that can be set to trigger the end of
the method; it is a percentage by which, if no node CV changes by this
percentage, the method will end. It must be specified as an array with
one entry for each CV desired.</p>
</dd>
<dt>max_iterations</dt><dd><p>A complementary stopping criterion can be specified; the method will
stop if it undergoes this many iterations of the string method.</p>
</dd>
<dt>ksprings</dt><dd><p>A unique spring constant must be defined for each CV; its purpose is
described above.</p>
</dd>
<dt>frequency</dt><dd><p>The frequency of each integration step. This should almost always be
set to 1.</p>
</dd>
</dl>
</div>
<div class="section" id="tutorial">
<span id="swarm-tutorial"></span><h2>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h2>
<p>This tutorial will walk you step by step through the user example provided with
the SSAGES source code that runs the SoT method on the alanine dipeptide using
LAMMPS. First, be sure you have compiled SSAGES with LAMMPS. Then, navigate to
the <code class="docutils literal notranslate"><span class="pre">SSAGES/Examples/User/Swarm/ADP</span></code> subdirectory. Now, take a moment to
observe the <code class="docutils literal notranslate"><span class="pre">in.ADP_Test</span> <span class="pre">and</span> <span class="pre">data.input</span></code> files. In general, these should be
the same as what you would use for any other method, but for the SoT method, it
is important to define a larger skin distance than one normally would in the
neighbor command in LAMMPS. This is because, under the hood, each unrestrained
trajectory in the swarm is started by manually resetting the positions of each
atom in the LAMMPS simulation to the start of a new trajectory. From the
perspective of LAMMPS, this is a huge amount of distance to move in a single
time step; this move triggers neighbor list rebuilding, but LAMMPS considers it
a “dangerous build” which threatens to crash the simulation. Thus, we increase
the skin distance, which forces LAMMPS to keep track of more pairs in the
neighbor lists, and thus reduces the number of dangerous builds. Keep this in
mind for future runs of the SoT method.</p>
<p>The next two files of interest are the <code class="docutils literal notranslate"><span class="pre">Template_Input.json</span></code> input file and
the <code class="docutils literal notranslate"><span class="pre">Input_Generator.py</span></code> script. Both of these files can be modified in your
text editor of choice to customize the inputs, but for this tutorial, simply
observe them and leave them be. <code class="docutils literal notranslate"><span class="pre">Template_Input.json</span></code> contains all the
information necessary to fully specify one driver; <code class="docutils literal notranslate"><span class="pre">Input_Generator.py</span></code> copies
this information a number of times specified within the script (for this
tutorial, 22 times) while also linearly interpolating through the start and end
states defined in the script and substituting the correct values into the
“centers” portion of the method definition. Execute this script as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python Input_Generator.py
</pre></div>
</div>
<p>You will produce a file called <code class="docutils literal notranslate"><span class="pre">Swarm.json</span></code>. You can also open this file to
verify for yourself that the script did what it was supposed to do. Now, with
your JSON input and your SSAGES binary, you have everything you need to perform
a simulation. Simply run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mpiexec -np <span class="m">22</span> ./ssages Swarm.json
</pre></div>
</div>
<p>Soon, the simulation will produce a <code class="docutils literal notranslate"><span class="pre">node-X.log</span></code> file for each driver, where
X is the number specifying the driver (in this case, 0-21 for our 22 drivers).
Each one will report the following information, in order: the node number, the
iteration number, and for each CV, the current value of the string CV as well as
the current value of the CV calculated from the molecular system.</p>
<p>Allow your system to run for the desired number of MD steps, but keep an eye on
it - the system should exit once one driver reaches the maximum number of MD
steps, but it is possible that instead one driver will exit and the rest will
get stuck. Check in on your node files and see if they’ve been updated recently - if
not, the simulation has likely finished. Once this is done, you can execute the
included plotter.py function in a directory containing the node files with the
command line argument of how many images your string had. The script also
accepts an argument to plot a free energy surface alongside the string
(generated with another method), but that
goes beyond the scope of this tutorial. Thus, simply execute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python plotter.py <span class="m">22</span> none
</pre></div>
</div>
<p>And in a moment you should have a graph of your converged string. Thus concludes
this tutorial.</p>
</div>
<div class="section" id="developer">
<h2>Developer<a class="headerlink" href="#developer" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Cody Bezik</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Umbrella%20Sampling.html" class="btn btn-neutral float-right" title="Umbrella Sampling" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="Metadynamics.html" class="btn btn-neutral float-left" title="Metadynamics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018, the SSAGES Team.
      <span class="lastupdated">
        Last updated on Jun 04, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>