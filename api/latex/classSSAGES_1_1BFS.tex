\hypertarget{classSSAGES_1_1BFS}{}\doxysection{S\+S\+A\+G\+ES\+::B\+FS Class Reference}
\label{classSSAGES_1_1BFS}\index{SSAGES::BFS@{SSAGES::BFS}}


Basis Function Sampling Algorithm.  




{\ttfamily \#include $<$Basis\+Func.\+h$>$}



Inheritance diagram for S\+S\+A\+G\+ES\+::B\+FS\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=204pt]{classSSAGES_1_1BFS__inherit__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classSSAGES_1_1BFS_a8f114a16c6e1f374eef47eb97177ddce}{B\+FS}} (const M\+P\+I\+\_\+\+Comm \&world, const M\+P\+I\+\_\+\+Comm \&comm, \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ unsigned int $>$ $\ast$h, \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ std\+::vector$<$ double $>$$>$ $\ast$f, \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ double $>$ $\ast$b, const std\+::vector$<$ \mbox{\hyperlink{classSSAGES_1_1BasisFunction}{Basis\+Function}} $\ast$ $>$ \&functions, const std\+::vector$<$ double $>$ \&restraint, const std\+::vector$<$ double $>$ \&bound\+Up, const std\+::vector$<$ double $>$ \&bound\+Low, unsigned int cyclefreq, unsigned int frequency, const std\+::string bnme, const double temperature, const double tol, const double weight, bool converge)
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1BFS_adabd5c246d1bfd9d0bd23cfbad5130df}{Pre\+Simulation}} (\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$snapshot, const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&cvmanager) override
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call prior to simulation initiation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1BFS_a6b4639e309cbaffa82113f2577c065c4}{Post\+Integration}} (\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$snapshot, const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&cvmanager) override
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call post integration. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1BFS_a0cbb6ae5b66ff83d556ca44087f40c06}{Post\+Simulation}} (\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$snapshot, const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&cvmanager) override
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call post simulation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1BFS_a68a91253692394292c0aee4daa7bbd54}{Set\+Iteration}} (const int iter)
\begin{DoxyCompactList}\small\item\em Set the current iteration. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1BFS_ae7a1e5c49a98296b2451e6127ef8f425}{Set\+Basis}} (const std\+::vector$<$ double $>$ \&coeff, std\+::vector$<$ double $>$ \&unbias)
\begin{DoxyCompactList}\small\item\em Set the values for the basis. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_ae7e85e21f589b6478a6bf6236bb39120}\label{classSSAGES_1_1BFS_ae7e85e21f589b6478a6bf6236bb39120}} 
\mbox{\hyperlink{classSSAGES_1_1BFS_ae7e85e21f589b6478a6bf6236bb39120}{$\sim$\+B\+FS}} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{classSSAGES_1_1BFS}{B\+FS}} $\ast$ \mbox{\hyperlink{classSSAGES_1_1BFS_aae30a5592035f756e0290fd2b044cf5e}{Build}} (const Json\+::\+Value \&json, const M\+P\+I\+\_\+\+Comm \&world, const M\+P\+I\+\_\+\+Comm \&comm, const std\+::string \&path)
\begin{DoxyCompactList}\small\item\em Build a derived method from \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{classSSAGES_1_1BFS_a417bd522d0ec956394e0ee0d5a154f73}{Project\+Bias}} (const \mbox{\hyperlink{namespaceSSAGES_acddea47426ac0a643b048f870ddd2907}{C\+V\+List}} \&cvs, const double beta)
\begin{DoxyCompactList}\small\item\em The functions which calculates the updated bias and coefficients and then stores them. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1BFS_a84bf66b3a01113c541646142d96abaa8}{In\+Bounds}} (const \mbox{\hyperlink{namespaceSSAGES_acddea47426ac0a643b048f870ddd2907}{C\+V\+List}} \&cvs)
\begin{DoxyCompactList}\small\item\em A function which checks to see if the C\+Vs are still in bounds. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1BFS_ab32a7fe0fa2d38cd95576e3102d51f06}{Print\+Bias}} (const \mbox{\hyperlink{namespaceSSAGES_acddea47426ac0a643b048f870ddd2907}{C\+V\+List}} \&cvs, const double beta)
\begin{DoxyCompactList}\small\item\em Prints the current bias to a defined file from the \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}}. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ unsigned int $>$ $\ast$ \mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\+\_\+}}
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}} of visited states. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ double $>$ $\ast$ \mbox{\hyperlink{classSSAGES_1_1BFS_a4b12d4c30951fe0d64e09c2f0607d52f}{b\+\_\+}}
\begin{DoxyCompactList}\small\item\em Stored bias potential. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ std\+::vector$<$ double $>$ $>$ $\ast$ \mbox{\hyperlink{classSSAGES_1_1BFS_a2eba4830e64c05fe99ddc12d9d6bb95d}{f\+\_\+}}
\begin{DoxyCompactList}\small\item\em Stored gradients. \end{DoxyCompactList}\item 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\+\_\+}}
\begin{DoxyCompactList}\small\item\em The biased histogram of states. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_a5bc27ba07feb8ae8b05b96eb3acca1f7}\label{classSSAGES_1_1BFS_a5bc27ba07feb8ae8b05b96eb3acca1f7}} 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classSSAGES_1_1BFS_a5bc27ba07feb8ae8b05b96eb3acca1f7}{coeff\+Arr\+\_\+}}
\begin{DoxyCompactList}\small\item\em The coefficient array for restart runs. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classSSAGES_1_1BasisEvaluator}{Basis\+Evaluator}} \mbox{\hyperlink{classSSAGES_1_1BFS_a30981e775e2bed6c3c531ccc813acfaf}{evaluator\+\_\+}}
\begin{DoxyCompactList}\small\item\em The basis evaluator class. \end{DoxyCompactList}\item 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classSSAGES_1_1BFS_a11d9317604fb0b474eaf40744377480b}{restraint\+\_\+}}
\begin{DoxyCompactList}\small\item\em Spring constants for restrained system. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_a60e7ffc4b53a1b52201f628893876ed1}\label{classSSAGES_1_1BFS_a60e7ffc4b53a1b52201f628893876ed1}} 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classSSAGES_1_1BFS_a60e7ffc4b53a1b52201f628893876ed1}{bound\+Up\+\_\+}}
\begin{DoxyCompactList}\small\item\em Upper position of the spring restraint. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_aa6d040dd9064767661ba8db4776bc75f}\label{classSSAGES_1_1BFS_aa6d040dd9064767661ba8db4776bc75f}} 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classSSAGES_1_1BFS_aa6d040dd9064767661ba8db4776bc75f}{bound\+Low\+\_\+}}
\begin{DoxyCompactList}\small\item\em Lower position of the spring restraint. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_a64ad4487a5718a19d7b21fd621d873a8}\label{classSSAGES_1_1BFS_a64ad4487a5718a19d7b21fd621d873a8}} 
unsigned int \mbox{\hyperlink{classSSAGES_1_1BFS_a64ad4487a5718a19d7b21fd621d873a8}{cyclefreq\+\_\+}}
\begin{DoxyCompactList}\small\item\em Frequency of coefficient updates. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_a09051de884cd13e453435147a86cc075}\label{classSSAGES_1_1BFS_a09051de884cd13e453435147a86cc075}} 
unsigned int \mbox{\hyperlink{classSSAGES_1_1BFS_a09051de884cd13e453435147a86cc075}{cyclefreq\+Tmp\+\_\+}}
\begin{DoxyCompactList}\small\item\em Temporary cyclefrequency that ensures sweeps are of proper length for restrained simulations. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_a877aee71aa8e35690dc7caac62c2cce4}\label{classSSAGES_1_1BFS_a877aee71aa8e35690dc7caac62c2cce4}} 
unsigned int \mbox{\hyperlink{classSSAGES_1_1BFS_a877aee71aa8e35690dc7caac62c2cce4}{step\+\_\+}}
\begin{DoxyCompactList}\small\item\em Step counter for the cyclefrequency. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_ae98abc80a22b09a73f284b2e3f77e250}\label{classSSAGES_1_1BFS_ae98abc80a22b09a73f284b2e3f77e250}} 
unsigned int \mbox{\hyperlink{classSSAGES_1_1BFS_ae98abc80a22b09a73f284b2e3f77e250}{mpiid\+\_\+}}
\begin{DoxyCompactList}\small\item\em The node that the current system belongs to, primarily for printing and debugging. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classSSAGES_1_1BFS_a0790f5dfa981809fb3f2aa468fd26326}{weight\+\_\+}}
\begin{DoxyCompactList}\small\item\em Weighting for potentially faster sampling. \end{DoxyCompactList}\item 
double \mbox{\hyperlink{classSSAGES_1_1BFS_a1d2663f5237b2dc961699f59ee83cf2e}{temperature\+\_\+}}
\begin{DoxyCompactList}\small\item\em Self-\/defined temperature. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_a617d1e1c2cfbb23c09f9e56200febf2e}\label{classSSAGES_1_1BFS_a617d1e1c2cfbb23c09f9e56200febf2e}} 
double \mbox{\hyperlink{classSSAGES_1_1BFS_a617d1e1c2cfbb23c09f9e56200febf2e}{tol\+\_\+}}
\begin{DoxyCompactList}\small\item\em The tolerance criteria for the system . \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}\label{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}} 
bool \mbox{\hyperlink{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}{bounds\+\_\+}}
\begin{DoxyCompactList}\small\item\em A variable to check to see if the simulation is in bounds or not. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_a0d1eb924d068ec3a3369c5f48c0a113b}\label{classSSAGES_1_1BFS_a0d1eb924d068ec3a3369c5f48c0a113b}} 
bool \mbox{\hyperlink{classSSAGES_1_1BFS_a0d1eb924d068ec3a3369c5f48c0a113b}{converge\+Exit\+\_\+}}
\begin{DoxyCompactList}\small\item\em A check to see if you want the system to end when it reaches the convergence criteria. \end{DoxyCompactList}\item 
std\+::string \mbox{\hyperlink{classSSAGES_1_1BFS_a5509ec03f12b0198f478a119909f31cc}{bnme\+\_\+}}
\item 
\mbox{\Hypertarget{classSSAGES_1_1BFS_a6c269415f6ffb33f306286e990c80235}\label{classSSAGES_1_1BFS_a6c269415f6ffb33f306286e990c80235}} 
unsigned int \mbox{\hyperlink{classSSAGES_1_1BFS_a6c269415f6ffb33f306286e990c80235}{iteration\+\_\+}}
\begin{DoxyCompactList}\small\item\em Iteration counter. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
Basis Function Sampling Algorithm. 

Implementation of the Basis Function Sampling \mbox{\hyperlink{classSSAGES_1_1Method}{Method}} based on \cite{WHITMER2014190602}. 

Definition at line 38 of file Basis\+Func.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classSSAGES_1_1BFS_a8f114a16c6e1f374eef47eb97177ddce}\label{classSSAGES_1_1BFS_a8f114a16c6e1f374eef47eb97177ddce}} 
\index{SSAGES::BFS@{SSAGES::BFS}!BFS@{BFS}}
\index{BFS@{BFS}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{BFS()}{BFS()}}
{\footnotesize\ttfamily S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::\+B\+FS (\begin{DoxyParamCaption}\item[{const M\+P\+I\+\_\+\+Comm \&}]{world,  }\item[{const M\+P\+I\+\_\+\+Comm \&}]{comm,  }\item[{\mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ unsigned int $>$ $\ast$}]{h,  }\item[{\mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ std\+::vector$<$ double $>$$>$ $\ast$}]{f,  }\item[{\mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ double $>$ $\ast$}]{b,  }\item[{const std\+::vector$<$ \mbox{\hyperlink{classSSAGES_1_1BasisFunction}{Basis\+Function}} $\ast$ $>$ \&}]{functions,  }\item[{const std\+::vector$<$ double $>$ \&}]{restraint,  }\item[{const std\+::vector$<$ double $>$ \&}]{bound\+Up,  }\item[{const std\+::vector$<$ double $>$ \&}]{bound\+Low,  }\item[{unsigned int}]{cyclefreq,  }\item[{unsigned int}]{frequency,  }\item[{const std\+::string}]{bnme,  }\item[{const double}]{temperature,  }\item[{const double}]{tol,  }\item[{const double}]{weight,  }\item[{bool}]{converge }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Constructor. 


\begin{DoxyParams}{Parameters}
{\em world} & M\+PI global communicator. \\
\hline
{\em comm} & M\+PI local communicator. \\
\hline
{\em h} & \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}} containing histogram. \\
\hline
{\em f} & \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}} containing histogram. \\
\hline
{\em b} & \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}} containing histogram. \\
\hline
{\em functions} & Vector of basis functions. \\
\hline
{\em restraint} & Restraint spring constants. \\
\hline
{\em bound\+Up} & Upper bounds of restraint springs. \\
\hline
{\em bound\+Low} & Lower bounds of restraint springs. \\
\hline
{\em cyclefreq} & Cycle frequency. \\
\hline
{\em frequency} & Frequency with which this \mbox{\hyperlink{classSSAGES_1_1Method}{Method}} is applied. \\
\hline
{\em bnme} & Basis file name. \\
\hline
{\em temperature} & Automatically set temperature. \\
\hline
{\em tol} & Threshold for tolerance criterion. \\
\hline
{\em weight} & Weight for improved sampling. \\
\hline
{\em converge} & If {\ttfamily True} quit on convergence.\\
\hline
\end{DoxyParams}
Constructs an instance of the Basis function sampling method. The coefficients describe the basis projection of the system. This is updated once every cyclefreq\+\_\+. For now, only the \mbox{\hyperlink{classSSAGES_1_1Legendre}{Legendre}} polynomial is implemented. Others will be added later. 

Definition at line 181 of file Basis\+Func.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{196                            :}
\DoxyCodeLine{197         \mbox{\hyperlink{classSSAGES_1_1Method_ad751450ecd30e8ab40024c6f5e870d30}{Method}}(frequency, world, comm), }
\DoxyCodeLine{198         \mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}(h),  \mbox{\hyperlink{classSSAGES_1_1BFS_a4b12d4c30951fe0d64e09c2f0607d52f}{b\_}}(b), \mbox{\hyperlink{classSSAGES_1_1BFS_a2eba4830e64c05fe99ddc12d9d6bb95d}{f\_}}(f), \mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}}(), \mbox{\hyperlink{classSSAGES_1_1BFS_a5bc27ba07feb8ae8b05b96eb3acca1f7}{coeffArr\_}}(), \mbox{\hyperlink{classSSAGES_1_1BFS_a30981e775e2bed6c3c531ccc813acfaf}{evaluator\_}}(functions),}
\DoxyCodeLine{199         \mbox{\hyperlink{classSSAGES_1_1BFS_a11d9317604fb0b474eaf40744377480b}{restraint\_}}(restraint), \mbox{\hyperlink{classSSAGES_1_1BFS_a60e7ffc4b53a1b52201f628893876ed1}{boundUp\_}}(boundUp), \mbox{\hyperlink{classSSAGES_1_1BFS_aa6d040dd9064767661ba8db4776bc75f}{boundLow\_}}(boundLow),}
\DoxyCodeLine{200         \mbox{\hyperlink{classSSAGES_1_1BFS_a64ad4487a5718a19d7b21fd621d873a8}{cyclefreq\_}}(cyclefreq), \mbox{\hyperlink{classSSAGES_1_1BFS_ae98abc80a22b09a73f284b2e3f77e250}{mpiid\_}}(0), \mbox{\hyperlink{classSSAGES_1_1BFS_a0790f5dfa981809fb3f2aa468fd26326}{weight\_}}(weight),}
\DoxyCodeLine{201         \mbox{\hyperlink{classSSAGES_1_1BFS_a1d2663f5237b2dc961699f59ee83cf2e}{temperature\_}}(temperature), \mbox{\hyperlink{classSSAGES_1_1BFS_a617d1e1c2cfbb23c09f9e56200febf2e}{tol\_}}(tol),}
\DoxyCodeLine{202         \mbox{\hyperlink{classSSAGES_1_1BFS_a0d1eb924d068ec3a3369c5f48c0a113b}{convergeExit\_}}(converge), \mbox{\hyperlink{classSSAGES_1_1BFS_a5509ec03f12b0198f478a119909f31cc}{bnme\_}}(bnme), \mbox{\hyperlink{classSSAGES_1_1BFS_a6c269415f6ffb33f306286e990c80235}{iteration\_}}(0)}
\DoxyCodeLine{203         \{}
\DoxyCodeLine{204         \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classSSAGES_1_1BFS_aae30a5592035f756e0290fd2b044cf5e}\label{classSSAGES_1_1BFS_aae30a5592035f756e0290fd2b044cf5e}} 
\index{SSAGES::BFS@{SSAGES::BFS}!Build@{Build}}
\index{Build@{Build}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{Build()}{Build()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classSSAGES_1_1BFS}{B\+FS}} $\ast$ S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::\+Build (\begin{DoxyParamCaption}\item[{const Json\+::\+Value \&}]{json,  }\item[{const M\+P\+I\+\_\+\+Comm \&}]{world,  }\item[{const M\+P\+I\+\_\+\+Comm \&}]{comm,  }\item[{const std\+::string \&}]{path }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Build a derived method from \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node. 


\begin{DoxyParams}{Parameters}
{\em json} & \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} Value containing all input information. \\
\hline
{\em world} & M\+PI global communicator. \\
\hline
{\em comm} & M\+PI local communicator. \\
\hline
{\em path} & Path for \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} path specification. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the \mbox{\hyperlink{classSSAGES_1_1Method}{Method}} built. nullptr if an unknown error occurred.
\end{DoxyReturn}
This function builds a registered method from a \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node. The difference between this function and \char`\"{}\+Build\char`\"{} is that this automatically determines the appropriate derived type based on the \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node information.

\begin{DoxyNote}{Note}
Object lifetime is the caller\textquotesingle{}s responsibility. 
\end{DoxyNote}


Definition at line 308 of file Basis\+Func.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{312     \{}
\DoxyCodeLine{313         \mbox{\hyperlink{classJson_1_1ObjectRequirement}{ObjectRequirement}} validator;}
\DoxyCodeLine{314         Value schema;}
\DoxyCodeLine{315         CharReaderBuilder rbuilder;}
\DoxyCodeLine{316         CharReader* reader = rbuilder.newCharReader();}
\DoxyCodeLine{317 }
\DoxyCodeLine{318         reader-\/>parse(JsonSchema::BFSMethod.c\_str(),}
\DoxyCodeLine{319                       JsonSchema::BFSMethod.c\_str() + JsonSchema::BFSMethod.size(),}
\DoxyCodeLine{320                       \&schema, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{321         validator.\mbox{\hyperlink{classJson_1_1ObjectRequirement_a4ed02ae1d612a5efba1688fcdd2df092}{Parse}}(schema, path);}
\DoxyCodeLine{322 }
\DoxyCodeLine{323         \textcolor{comment}{//Validate Inputs}}
\DoxyCodeLine{324         validator.\mbox{\hyperlink{classJson_1_1ObjectRequirement_a9ac3b920001a35bc70580035d8d802b7}{Validate}}(json, path);}
\DoxyCodeLine{325         \textcolor{keywordflow}{if}(validator.\mbox{\hyperlink{classJson_1_1Requirement_adfaec336a9f051d6f6b9a6d7f1d97b75}{HasErrors}}())}
\DoxyCodeLine{326             \textcolor{keywordflow}{throw} BuildException(validator.\mbox{\hyperlink{classJson_1_1Requirement_a60bc275c366eb59f192fa2e621268480}{GetErrors}}());}
\DoxyCodeLine{327 }
\DoxyCodeLine{328         std::vector<double> restrCV(0);}
\DoxyCodeLine{329         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& restr : json[\textcolor{stringliteral}{"CV\_restraint\_spring\_constants"}])}
\DoxyCodeLine{330             restrCV.push\_back(restr.asDouble());}
\DoxyCodeLine{331 }
\DoxyCodeLine{332         std::vector<double> boundLow(0);}
\DoxyCodeLine{333         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& bndl : json[\textcolor{stringliteral}{"CV\_restraint\_minimums"}])}
\DoxyCodeLine{334             boundLow.push\_back(bndl.asDouble());}
\DoxyCodeLine{335     }
\DoxyCodeLine{336         std::vector<double> boundUp(0);}
\DoxyCodeLine{337         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& bndu : json[\textcolor{stringliteral}{"CV\_restraint\_maximums"}])}
\DoxyCodeLine{338             boundUp.push\_back(bndu.asDouble());}
\DoxyCodeLine{339 }
\DoxyCodeLine{340         \textcolor{keyword}{auto} cyclefreq = json.get(\textcolor{stringliteral}{"cycle\_frequency"}, 100000).asInt();}
\DoxyCodeLine{341         \textcolor{keyword}{auto} freq = json.get(\textcolor{stringliteral}{"frequency"}, 1).asInt();}
\DoxyCodeLine{342         \textcolor{keyword}{auto} wght = json.get(\textcolor{stringliteral}{"weight"}, 1.0).asDouble();}
\DoxyCodeLine{343         \textcolor{keyword}{auto} bnme = json.get(\textcolor{stringliteral}{"basis\_filename"}, \textcolor{stringliteral}{""}).asString();}
\DoxyCodeLine{344         \textcolor{keyword}{auto} temp = json.get(\textcolor{stringliteral}{"temperature"}, 0.0).asDouble();}
\DoxyCodeLine{345         \textcolor{keyword}{auto} tol  = json.get(\textcolor{stringliteral}{"tolerance"}, 1e-\/6).asDouble();}
\DoxyCodeLine{346         \textcolor{keyword}{auto} conv = json.get(\textcolor{stringliteral}{"convergence\_exit"}, \textcolor{keyword}{false}).asBool();}
\DoxyCodeLine{347 }
\DoxyCodeLine{348         Grid<unsigned int> *h = \mbox{\hyperlink{classSSAGES_1_1Grid_a24d2373042debae156618906637e819c}{Grid<unsigned int>::BuildGrid}}(}
\DoxyCodeLine{349                                         json.get(\textcolor{stringliteral}{"grid"}, Json::Value()) );}
\DoxyCodeLine{350 }
\DoxyCodeLine{351         Grid<std::vector<double>> *f = Grid<std::vector<double>>::BuildGrid(}
\DoxyCodeLine{352                                         json.get(\textcolor{stringliteral}{"grid"}, Json::Value()) );}
\DoxyCodeLine{353 }
\DoxyCodeLine{354         Grid<double> *b = \mbox{\hyperlink{classSSAGES_1_1Grid_a24d2373042debae156618906637e819c}{Grid<double>::BuildGrid}}(}
\DoxyCodeLine{355                                         json.get(\textcolor{stringliteral}{"grid"}, Json::Value()) );}
\DoxyCodeLine{356 }
\DoxyCodeLine{357         \textcolor{keywordtype}{size\_t} ii = 0;}
\DoxyCodeLine{358         std::vector<BasisFunction*> functions;}
\DoxyCodeLine{359         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& m : json[\textcolor{stringliteral}{"basis\_functions"}])}
\DoxyCodeLine{360         \{}
\DoxyCodeLine{361             \textcolor{keyword}{auto} *bf = \mbox{\hyperlink{classSSAGES_1_1BasisFunction_a25b1e4f6b8655529bb4b68268dfdcdb5}{BasisFunction::Build}}(m, path, b-\/>GetNumPoints(ii));}
\DoxyCodeLine{362             functions.push\_back(bf);}
\DoxyCodeLine{363             ii++;}
\DoxyCodeLine{364         \}}
\DoxyCodeLine{365 }
\DoxyCodeLine{366         \textcolor{comment}{// If restraints were not specified then set them equal to zero}}
\DoxyCodeLine{367         \textcolor{keywordflow}{if} (restrCV.size() == 0) \{}
\DoxyCodeLine{368             \textcolor{comment}{// Choose simplest array that should have equivalent size}}
\DoxyCodeLine{369             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i<functions.size(); i++)}
\DoxyCodeLine{370                 restrCV.push\_back(0); \textcolor{comment}{// Push back value of 0}}
\DoxyCodeLine{371         \}}
\DoxyCodeLine{372 }
\DoxyCodeLine{373         \textcolor{comment}{// This also needs to be the same for upper bounds and lower bounds}}
\DoxyCodeLine{374         \textcolor{keywordflow}{if} (boundLow.size() == 0) \{}
\DoxyCodeLine{375             \textcolor{comment}{// Choose simplest array that should have equivalent size}}
\DoxyCodeLine{376             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i<functions.size(); i++)}
\DoxyCodeLine{377                 boundLow.push\_back(0); \textcolor{comment}{// Push back value of 0}}
\DoxyCodeLine{378         \}}
\DoxyCodeLine{379 }
\DoxyCodeLine{380         \textcolor{comment}{// This also needs to be the same for upper bounds and lower bounds}}
\DoxyCodeLine{381         \textcolor{keywordflow}{if} (boundUp.size() == 0) \{}
\DoxyCodeLine{382             \textcolor{comment}{// Choose simplest array that should have equivalent size}}
\DoxyCodeLine{383             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i<functions.size(); i++)}
\DoxyCodeLine{384                 boundUp.push\_back(0); \textcolor{comment}{// Push back value of 0}}
\DoxyCodeLine{385         \}}
\DoxyCodeLine{386 }
\DoxyCodeLine{387         \textcolor{comment}{// Check to make sure that the arrays for boundaries and restraints are of the same length}}
\DoxyCodeLine{388         \textcolor{keywordflow}{if} (boundUp.size() != boundLow.size() \&\& boundLow.size() != restrCV.size()) \{}
\DoxyCodeLine{389             std::cerr<<\textcolor{stringliteral}{"ERROR: Number of restraint boundaries do not match number of spring constants."}<<std::endl;}
\DoxyCodeLine{390             std::cerr<<\textcolor{stringliteral}{"Boundary size is "} << boundUp.size() << \textcolor{stringliteral}{" boundary low size is "} << boundLow.size() << \textcolor{stringliteral}{" restraints size is"} << restrCV.size() << std::endl;}
\DoxyCodeLine{391             MPI\_Abort(world, EXIT\_FAILURE);}
\DoxyCodeLine{392         \}}
\DoxyCodeLine{393 }
\DoxyCodeLine{394         \textcolor{keyword}{auto}* m = \textcolor{keyword}{new} \mbox{\hyperlink{classSSAGES_1_1BFS_a8f114a16c6e1f374eef47eb97177ddce}{BFS}}(world, comm, h, f, b, functions, restrCV, boundUp, boundLow,}
\DoxyCodeLine{395                             cyclefreq, freq, bnme, temp, tol, wght,}
\DoxyCodeLine{396                             conv);}
\DoxyCodeLine{397       }
\DoxyCodeLine{398         \textcolor{keywordflow}{if}(json.isMember(\textcolor{stringliteral}{"iteration"}))}
\DoxyCodeLine{399             m-\/>SetIteration(json.get(\textcolor{stringliteral}{"iteration"},0).asInt());}
\DoxyCodeLine{400 }
\DoxyCodeLine{401         \textcolor{comment}{// Check if previously saved grids exist. If so, check that data match and load grids.}}
\DoxyCodeLine{402         std::ifstream restrFile;}
\DoxyCodeLine{403         restrFile.open(\textcolor{stringliteral}{"restart"}+bnme+\textcolor{stringliteral}{".out"});}
\DoxyCodeLine{404         \textcolor{keywordflow}{if}(restrFile.is\_open())}
\DoxyCodeLine{405         \{}
\DoxyCodeLine{406             std::string line;}
\DoxyCodeLine{407             std::vector<double> coeff;}
\DoxyCodeLine{408             std::vector<double> unbias;}
\DoxyCodeLine{409             \textcolor{keywordtype}{bool} coeffFlag = \textcolor{keyword}{false};}
\DoxyCodeLine{410             \textcolor{keywordtype}{bool} basisFlag = \textcolor{keyword}{false};}
\DoxyCodeLine{411             std::cout << \textcolor{stringliteral}{"Attempting to load data from a previous run of BFS."} << std::endl;}
\DoxyCodeLine{412 }
\DoxyCodeLine{413             \textcolor{keywordflow}{while}(!std::getline(restrFile,line).eof()) }
\DoxyCodeLine{414             \{}
\DoxyCodeLine{415                 \textcolor{keywordflow}{if}(line.find(\textcolor{stringliteral}{"COEFFICIENTS"}) != std::string::npos) \{}
\DoxyCodeLine{416                     std::getline(restrFile,line);}
\DoxyCodeLine{417                     coeffFlag = \textcolor{keyword}{true};}
\DoxyCodeLine{418                 \}}
\DoxyCodeLine{419                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (line.find(\textcolor{stringliteral}{"HISTOGRAM"}) != std::string::npos) \{}
\DoxyCodeLine{420                     std::getline(restrFile,line);}
\DoxyCodeLine{421                     basisFlag = \textcolor{keyword}{true};}
\DoxyCodeLine{422                     coeffFlag = \textcolor{keyword}{false};}
\DoxyCodeLine{423                 \}}
\DoxyCodeLine{424                 \textcolor{keywordflow}{if}(coeffFlag) \{}
\DoxyCodeLine{425                     coeff.push\_back(std::stod(line));}
\DoxyCodeLine{426                 \}}
\DoxyCodeLine{427                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (basisFlag) \{ }
\DoxyCodeLine{428                     unbias.push\_back(std::stod(line));}
\DoxyCodeLine{429                 \}}
\DoxyCodeLine{430             \}}
\DoxyCodeLine{431             m-\/>SetBasis(coeff, unbias);}
\DoxyCodeLine{432             restrFile.close();}
\DoxyCodeLine{433         \}}
\DoxyCodeLine{434 }
\DoxyCodeLine{435         \textcolor{keywordflow}{return} m;}
\DoxyCodeLine{436     \}}

\end{DoxyCode}


References Json\+::\+Requirement\+::\+Get\+Errors(), S\+S\+A\+G\+E\+S\+::\+Grid\+Base$<$ T $>$\+::\+Get\+Num\+Points(), Json\+::\+Requirement\+::\+Has\+Errors(), Json\+::\+Object\+Requirement\+::\+Parse(), and Json\+::\+Object\+Requirement\+::\+Validate().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1BFS_aae30a5592035f756e0290fd2b044cf5e_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1BFS_a84bf66b3a01113c541646142d96abaa8}\label{classSSAGES_1_1BFS_a84bf66b3a01113c541646142d96abaa8}} 
\index{SSAGES::BFS@{SSAGES::BFS}!InBounds@{InBounds}}
\index{InBounds@{InBounds}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{InBounds()}{InBounds()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::\+In\+Bounds (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespaceSSAGES_acddea47426ac0a643b048f870ddd2907}{C\+V\+List}} \&}]{cvs }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



A function which checks to see if the C\+Vs are still in bounds. 


\begin{DoxyParams}{Parameters}
{\em cvs} & List of C\+Vs to check \\
\hline
\end{DoxyParams}


Definition at line 272 of file Basis\+Func.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{273     \{   }
\DoxyCodeLine{274         std::vector<double> x (cvs.size(),0);}
\DoxyCodeLine{275         \textcolor{comment}{//This is calculating the derivatives for the bias force}}
\DoxyCodeLine{276         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < cvs.size(); ++j)}
\DoxyCodeLine{277         \{}
\DoxyCodeLine{278             x[j] = cvs[j]-\/>GetValue();}
\DoxyCodeLine{279             \textcolor{keywordtype}{double} min = \mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a2270a9233a9dc2d341e8ab88ce6655c9}{GetLower}}(j);}
\DoxyCodeLine{280             \textcolor{keywordtype}{double} max = \mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a875feace8fff4743b103147c4193eca0}{GetUpper}}(j);}
\DoxyCodeLine{281 }
\DoxyCodeLine{282             \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_ab4ff38d7e0ca60dfebd82c36d89cbede}{GetPeriodic}}(j))}
\DoxyCodeLine{283             \{}
\DoxyCodeLine{284                 \textcolor{comment}{// In order to prevent the index for the histogram from going out of bounds a check is in place}}
\DoxyCodeLine{285                 \textcolor{keywordflow}{if}(x[j] > max \&\& \mbox{\hyperlink{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}{bounds\_}})}
\DoxyCodeLine{286                 \{}
\DoxyCodeLine{287                     \textcolor{comment}{//std::cout<<"WARNING: CV is above the maximum boundary."<<std::endl;}}
\DoxyCodeLine{288                     \textcolor{comment}{//std::cout<<"Statistics will not be gathered during this interval"<<std::endl;}}
\DoxyCodeLine{289                     \mbox{\hyperlink{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}{bounds\_}} = \textcolor{keyword}{false};}
\DoxyCodeLine{290                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{291                 \}}
\DoxyCodeLine{292                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(x[j] < min \&\& \mbox{\hyperlink{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}{bounds\_}})}
\DoxyCodeLine{293                 \{}
\DoxyCodeLine{294                     \textcolor{comment}{//std::cout<<"WARNING: CV is below the minimum boundary."<<std::endl;}}
\DoxyCodeLine{295                     \textcolor{comment}{//std::cout<<"Statistics will not be gathered during this interval"<<std::endl;}}
\DoxyCodeLine{296                     \mbox{\hyperlink{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}{bounds\_}} = \textcolor{keyword}{false};}
\DoxyCodeLine{297                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{298                 \}}
\DoxyCodeLine{299                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(x[j] < max \&\& x[j] > min \&\& !\mbox{\hyperlink{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}{bounds\_}})}
\DoxyCodeLine{300                 \{}
\DoxyCodeLine{301                     \textcolor{comment}{//std::cout<<"CV has returned in between bounds. Run is resuming"<<std::endl;}}
\DoxyCodeLine{302                     \mbox{\hyperlink{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}{bounds\_}} = \textcolor{keyword}{true};}
\DoxyCodeLine{303                 \}}
\DoxyCodeLine{304             \}}
\DoxyCodeLine{305         \}}
\DoxyCodeLine{306     \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSSAGES_1_1BFS_a6b4639e309cbaffa82113f2577c065c4}\label{classSSAGES_1_1BFS_a6b4639e309cbaffa82113f2577c065c4}} 
\index{SSAGES::BFS@{SSAGES::BFS}!PostIntegration@{PostIntegration}}
\index{PostIntegration@{PostIntegration}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{PostIntegration()}{PostIntegration()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::\+Post\+Integration (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$}]{snapshot,  }\item[{const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&}]{cvmanager }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



\mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call post integration. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Pointer to the simulation snapshot. \\
\hline
{\em cvmanager} & Collective variable manager.\\
\hline
\end{DoxyParams}
This function will be called after each integration step. 

Implements \mbox{\hyperlink{classSSAGES_1_1Method_af2f33dfaa758c5cd505477f4767fb339}{S\+S\+A\+G\+E\+S\+::\+Method}}.



Definition at line 81 of file Basis\+Func.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{82     \{}
\DoxyCodeLine{83         \textcolor{keyword}{auto} cvs = cvmanager.GetCVs(\mbox{\hyperlink{classSSAGES_1_1Method_a24b0ac53b1fabcab0a5f3bd6cde26909}{cvmask\_}});        }
\DoxyCodeLine{84         std::vector<double> x(cvs.size(),0);}
\DoxyCodeLine{85 }
\DoxyCodeLine{86         \textcolor{comment}{/*The binned cv space is updated at every step}}
\DoxyCodeLine{87 \textcolor{comment}{         *After a certain number of steps has been passed, the system updates a}}
\DoxyCodeLine{88 \textcolor{comment}{         *bias projection based on the visited histogram states}}
\DoxyCodeLine{89 \textcolor{comment}{         */}}
\DoxyCodeLine{90         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < cvs.size(); ++i)}
\DoxyCodeLine{91         \{}
\DoxyCodeLine{92             x[i] = cvs[i]-\/>GetValue();}
\DoxyCodeLine{93         \}}
\DoxyCodeLine{94        }
\DoxyCodeLine{95         \textcolor{comment}{// The histogram is updated based on the index}}
\DoxyCodeLine{96         \mbox{\hyperlink{classSSAGES_1_1BFS_a84bf66b3a01113c541646142d96abaa8}{InBounds}}(cvs);}
\DoxyCodeLine{97         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}{bounds\_}}) \{\mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a7da01557a9b85498c2acd975c152403a}{at}}(x) += 1;\}}
\DoxyCodeLine{98         \textcolor{keywordflow}{else} \{\mbox{\hyperlink{classSSAGES_1_1BFS_a64ad4487a5718a19d7b21fd621d873a8}{cyclefreq\_}}++;\}}
\DoxyCodeLine{99     }
\DoxyCodeLine{100         \textcolor{comment}{// Update the basis projection after the requisite number of steps}}
\DoxyCodeLine{101         \textcolor{keywordtype}{int} steps = snapshot-\/>GetIteration()-\/\mbox{\hyperlink{classSSAGES_1_1BFS_a877aee71aa8e35690dc7caac62c2cce4}{step\_}};}
\DoxyCodeLine{102         \textcolor{keywordflow}{if}(steps  \% \mbox{\hyperlink{classSSAGES_1_1BFS_a64ad4487a5718a19d7b21fd621d873a8}{cyclefreq\_}} == 0) \{}
\DoxyCodeLine{103             \mbox{\hyperlink{classSSAGES_1_1BFS_a877aee71aa8e35690dc7caac62c2cce4}{step\_}} = snapshot-\/>GetIteration();}
\DoxyCodeLine{104             \mbox{\hyperlink{classSSAGES_1_1BFS_a64ad4487a5718a19d7b21fd621d873a8}{cyclefreq\_}} = \mbox{\hyperlink{classSSAGES_1_1BFS_a09051de884cd13e453435147a86cc075}{cyclefreqTmp\_}};}
\DoxyCodeLine{105             \textcolor{keywordtype}{double} beta;}
\DoxyCodeLine{106             beta = 1.0 / (\mbox{\hyperlink{classSSAGES_1_1BFS_a1d2663f5237b2dc961699f59ee83cf2e}{temperature\_}} * snapshot-\/>GetKb());}
\DoxyCodeLine{107 }
\DoxyCodeLine{108             \textcolor{comment}{// For systems with poorly defined temperature (ie: 1 particle) the}}
\DoxyCodeLine{109             \textcolor{comment}{// user needs to define their own temperature. This is a hack that}}
\DoxyCodeLine{110             \textcolor{comment}{// will be removed in future versions.}}
\DoxyCodeLine{111 }
\DoxyCodeLine{112             \mbox{\hyperlink{classSSAGES_1_1BFS_a6c269415f6ffb33f306286e990c80235}{iteration\_}}+= 1;}
\DoxyCodeLine{113             \mbox{\hyperlink{classSSAGES_1_1BFS_a417bd522d0ec956394e0ee0d5a154f73}{ProjectBias}}(cvs,beta);}
\DoxyCodeLine{114             std::cout<<\textcolor{stringliteral}{"Node: ["}<<\mbox{\hyperlink{classSSAGES_1_1BFS_ae98abc80a22b09a73f284b2e3f77e250}{mpiid\_}}<<\textcolor{stringliteral}{"]"}<<std::setw(10)<<\textcolor{stringliteral}{"\(\backslash\)tSweep: "}<<\mbox{\hyperlink{classSSAGES_1_1BFS_a6c269415f6ffb33f306286e990c80235}{iteration\_}}<<std::endl;}
\DoxyCodeLine{115         \}}
\DoxyCodeLine{116 }
\DoxyCodeLine{117         \textcolor{comment}{// This gets the bias force from the grid}}
\DoxyCodeLine{118         std::vector<double> bias\_grad(cvs.size(),0);}
\DoxyCodeLine{119 }
\DoxyCodeLine{120         \textcolor{keywordflow}{if} (\mbox{\hyperlink{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}{bounds\_}}) }
\DoxyCodeLine{121         \{}
\DoxyCodeLine{122             \textcolor{keyword}{auto}\& bias = \mbox{\hyperlink{classSSAGES_1_1BFS_a2eba4830e64c05fe99ddc12d9d6bb95d}{f\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a7da01557a9b85498c2acd975c152403a}{at}}(x); }
\DoxyCodeLine{123             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} ii = 0; ii<bias.size(); ii++)}
\DoxyCodeLine{124                 bias\_grad[ii] = bias[ii];}
\DoxyCodeLine{125         \}}
\DoxyCodeLine{126         \textcolor{keywordflow}{else} }
\DoxyCodeLine{127         \{}
\DoxyCodeLine{128             \textcolor{comment}{// This is where the wall potentials are going to be thrown into the method if the system is not a periodic CV}}
\DoxyCodeLine{129             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} j = 0; j < cvs.size(); ++j)}
\DoxyCodeLine{130             \{}
\DoxyCodeLine{131                 \textcolor{keywordflow}{if}(!\mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_ab4ff38d7e0ca60dfebd82c36d89cbede}{GetPeriodic}}(j))}
\DoxyCodeLine{132                 \{}
\DoxyCodeLine{133                     \textcolor{keywordflow}{if}(x[j] > \mbox{\hyperlink{classSSAGES_1_1BFS_a60e7ffc4b53a1b52201f628893876ed1}{boundUp\_}}[j])}
\DoxyCodeLine{134                         bias\_grad[j] = -\/\mbox{\hyperlink{classSSAGES_1_1BFS_a11d9317604fb0b474eaf40744377480b}{restraint\_}}[j] * (x[j] -\/ \mbox{\hyperlink{classSSAGES_1_1BFS_a60e7ffc4b53a1b52201f628893876ed1}{boundUp\_}}[j]);}
\DoxyCodeLine{135                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(x[j] < \mbox{\hyperlink{classSSAGES_1_1BFS_aa6d040dd9064767661ba8db4776bc75f}{boundLow\_}}[j])}
\DoxyCodeLine{136                         bias\_grad[j] = \mbox{\hyperlink{classSSAGES_1_1BFS_a11d9317604fb0b474eaf40744377480b}{restraint\_}}[j] * (x[j] -\/ \mbox{\hyperlink{classSSAGES_1_1BFS_aa6d040dd9064767661ba8db4776bc75f}{boundLow\_}}[j]);}
\DoxyCodeLine{137                 \}}
\DoxyCodeLine{138             \}}
\DoxyCodeLine{139         \}}
\DoxyCodeLine{140 }
\DoxyCodeLine{141         \textcolor{comment}{// Take each CV and add its biased forces to the atoms using the chain rule}}
\DoxyCodeLine{142         \textcolor{keyword}{auto}\& forces = snapshot-\/>GetForces();}
\DoxyCodeLine{143         \textcolor{keyword}{auto}\& virial = snapshot-\/>GetVirial();}
\DoxyCodeLine{144         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < cvs.size(); ++i)}
\DoxyCodeLine{145         \{}
\DoxyCodeLine{146             \textcolor{keyword}{auto}\& grad = cvs[i]-\/>GetGradient();}
\DoxyCodeLine{147             \textcolor{keyword}{auto}\& boxgrad = cvs[i]-\/>GetBoxGradient();}
\DoxyCodeLine{148 }
\DoxyCodeLine{149             \textcolor{comment}{/* Update the forces in snapshot by adding in the force bias from each}}
\DoxyCodeLine{150 \textcolor{comment}{             *CV to each atom based on the gradient of the CV.}}
\DoxyCodeLine{151 \textcolor{comment}{             */}}
\DoxyCodeLine{152             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < forces.size(); ++j) }
\DoxyCodeLine{153                 forces[j] += bias\_grad[i]*grad[j];}
\DoxyCodeLine{154             }
\DoxyCodeLine{155             virial -\/= bias\_grad[i]*boxgrad;}
\DoxyCodeLine{156         \}}
\DoxyCodeLine{157     \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+C\+V\+Manager\+::\+Get\+C\+Vs(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Forces(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Iteration(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Kb(), and S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Virial().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1BFS_a6b4639e309cbaffa82113f2577c065c4_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1BFS_a0cbb6ae5b66ff83d556ca44087f40c06}\label{classSSAGES_1_1BFS_a0cbb6ae5b66ff83d556ca44087f40c06}} 
\index{SSAGES::BFS@{SSAGES::BFS}!PostSimulation@{PostSimulation}}
\index{PostSimulation@{PostSimulation}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{PostSimulation()}{PostSimulation()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::\+Post\+Simulation (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$}]{snapshot,  }\item[{const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&}]{cvmanager }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



\mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call post simulation. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Pointer to the simulation snapshot. \\
\hline
{\em cvmanager} & Collective variable manager.\\
\hline
\end{DoxyParams}
This function will be called after the end of the simulation run. 

Implements \mbox{\hyperlink{classSSAGES_1_1Method_a7d18226669c88bc76b9b758f2d29e3c9}{S\+S\+A\+G\+E\+S\+::\+Method}}.



Definition at line 160 of file Basis\+Func.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{161     \{}
\DoxyCodeLine{162         std::cout<<\textcolor{stringliteral}{"Run has finished"}<<std::endl;   }
\DoxyCodeLine{163     \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSSAGES_1_1BFS_adabd5c246d1bfd9d0bd23cfbad5130df}\label{classSSAGES_1_1BFS_adabd5c246d1bfd9d0bd23cfbad5130df}} 
\index{SSAGES::BFS@{SSAGES::BFS}!PreSimulation@{PreSimulation}}
\index{PreSimulation@{PreSimulation}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{PreSimulation()}{PreSimulation()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::\+Pre\+Simulation (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$}]{snapshot,  }\item[{const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&}]{cvmanager }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



\mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call prior to simulation initiation. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Pointer to the simulation snapshot. \\
\hline
{\em cvmanager} & Collective variable manager.\\
\hline
\end{DoxyParams}
This function will be called before the simulation is started. 

Implements \mbox{\hyperlink{classSSAGES_1_1Method_a7d840d2b5f6dbf9ec75a7909ccf13ef7}{S\+S\+A\+G\+E\+S\+::\+Method}}.



Definition at line 36 of file Basis\+Func.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{37     \{}
\DoxyCodeLine{38         \textcolor{keyword}{auto} cvs = cvmanager.GetCVs(\mbox{\hyperlink{classSSAGES_1_1Method_a24b0ac53b1fabcab0a5f3bd6cde26909}{cvmask\_}});}
\DoxyCodeLine{39         \textcolor{comment}{// For print statements and file I/O, the walker IDs are used}}
\DoxyCodeLine{40         \mbox{\hyperlink{classSSAGES_1_1BFS_ae98abc80a22b09a73f284b2e3f77e250}{mpiid\_}} = snapshot-\/>GetWalkerID();}
\DoxyCodeLine{41 }
\DoxyCodeLine{42         \textcolor{comment}{// Make sure the iteration index is set correctly}}
\DoxyCodeLine{43         \mbox{\hyperlink{classSSAGES_1_1BFS_a6c269415f6ffb33f306286e990c80235}{iteration\_}} = 0;}
\DoxyCodeLine{44         \mbox{\hyperlink{classSSAGES_1_1BFS_a877aee71aa8e35690dc7caac62c2cce4}{step\_}} = 0;}
\DoxyCodeLine{45 }
\DoxyCodeLine{46         \textcolor{comment}{// Set the temporary sweep frequency to the same as the input}}
\DoxyCodeLine{47         \mbox{\hyperlink{classSSAGES_1_1BFS_a09051de884cd13e453435147a86cc075}{cyclefreqTmp\_}} = \mbox{\hyperlink{classSSAGES_1_1BFS_a64ad4487a5718a19d7b21fd621d873a8}{cyclefreq\_}};}
\DoxyCodeLine{48 }
\DoxyCodeLine{49         \textcolor{comment}{// There are a few error messages / checks that are in place with}}
\DoxyCodeLine{50         \textcolor{comment}{// defining CVs and grids}}
\DoxyCodeLine{51         \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a72f98ef47da691b00823d612efbd46b8}{GetDimension}}() != cvs.size())}
\DoxyCodeLine{52         \{}
\DoxyCodeLine{53             std::cerr<<\textcolor{stringliteral}{"ERROR: Grid dimensions doesn't match number of CVS."}<<std::endl;}
\DoxyCodeLine{54             MPI\_Abort(\mbox{\hyperlink{classSSAGES_1_1Method_a8471b11097a1018a9635bc578bf22f61}{world\_}}, EXIT\_FAILURE);}
\DoxyCodeLine{55         \}}
\DoxyCodeLine{56 }
\DoxyCodeLine{57         \textcolor{comment}{// This is to check for non-\/periodic bounds. It comes into play in the update bias function}}
\DoxyCodeLine{58         \mbox{\hyperlink{classSSAGES_1_1BFS_afeb65121cb4484417a3fe9400fc411ce}{bounds\_}} = \textcolor{keyword}{true};        }
\DoxyCodeLine{59         \mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}}.resize(\mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a4f8abb752ae6ec51ebcf24b599bf4896}{size}}(),0);}
\DoxyCodeLine{60         std::fill(\mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}}.begin(),\mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}}.end(),1.0);}
\DoxyCodeLine{61  }
\DoxyCodeLine{62         \textcolor{comment}{// Initialize the mapping for the hist function}}
\DoxyCodeLine{63         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&val : *\mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}) \{}
\DoxyCodeLine{64             val = 0;}
\DoxyCodeLine{65         \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67         \textcolor{comment}{// Reset the values in the force grid}}
\DoxyCodeLine{68         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&val : *\mbox{\hyperlink{classSSAGES_1_1BFS_a2eba4830e64c05fe99ddc12d9d6bb95d}{f\_}}) \{}
\DoxyCodeLine{69             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} i = 0; i <val.size(); i++) \{}
\DoxyCodeLine{70                 val[i] = 0;}
\DoxyCodeLine{71             \}}
\DoxyCodeLine{72         \}}
\DoxyCodeLine{73 }
\DoxyCodeLine{74         \textcolor{comment}{// Reset the values in the bias potential grid}}
\DoxyCodeLine{75         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&val : *\mbox{\hyperlink{classSSAGES_1_1BFS_a4b12d4c30951fe0d64e09c2f0607d52f}{b\_}}) \{}
\DoxyCodeLine{76             val = 0;}
\DoxyCodeLine{77         \}}
\DoxyCodeLine{78     \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+C\+V\+Manager\+::\+Get\+C\+Vs(), and S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Walker\+I\+D().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1BFS_adabd5c246d1bfd9d0bd23cfbad5130df_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1BFS_ab32a7fe0fa2d38cd95576e3102d51f06}\label{classSSAGES_1_1BFS_ab32a7fe0fa2d38cd95576e3102d51f06}} 
\index{SSAGES::BFS@{SSAGES::BFS}!PrintBias@{PrintBias}}
\index{PrintBias@{PrintBias}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{PrintBias()}{PrintBias()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::\+Print\+Bias (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespaceSSAGES_acddea47426ac0a643b048f870ddd2907}{C\+V\+List}} \&}]{cvs,  }\item[{const double}]{beta }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Prints the current bias to a defined file from the \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}}. 


\begin{DoxyParams}{Parameters}
{\em cvs} & List of collective variables. \\
\hline
{\em beta} & Scale parameter. \\
\hline
\end{DoxyParams}


Definition at line 227 of file Basis\+Func.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{228     \{}
\DoxyCodeLine{229         \textcolor{comment}{// The filenames will have a standard name, with a user-\/defined suffix}}
\DoxyCodeLine{230         std::string filename1 = \textcolor{stringliteral}{"basis"}+\mbox{\hyperlink{classSSAGES_1_1BFS_a5509ec03f12b0198f478a119909f31cc}{bnme\_}}+\textcolor{stringliteral}{".out"}; }
\DoxyCodeLine{231         std::string filename2 = \textcolor{stringliteral}{"restart"}+\mbox{\hyperlink{classSSAGES_1_1BFS_a5509ec03f12b0198f478a119909f31cc}{bnme\_}}+\textcolor{stringliteral}{".out"};}
\DoxyCodeLine{232         std::ofstream basisout;}
\DoxyCodeLine{233         std::ofstream coeffout;}
\DoxyCodeLine{234         basisout.precision(5);}
\DoxyCodeLine{235         coeffout.precision(5);}
\DoxyCodeLine{236         basisout.open(filename1.c\_str());}
\DoxyCodeLine{237         coeffout.open(filename2.c\_str());}
\DoxyCodeLine{238 }
\DoxyCodeLine{239         \textcolor{comment}{// The CV values, PMF projection, PMF, and biased histogram are output for the user}}
\DoxyCodeLine{240         basisout << \textcolor{stringliteral}{"The information stored in this file is the output of a Basis Function Sampling run"} << std::endl;}
\DoxyCodeLine{241         basisout << \textcolor{stringliteral}{"CV Values"} << std::setw(15*cvs.size()) << \textcolor{stringliteral}{"Basis Set Bias"} << std::setw(15) << \textcolor{stringliteral}{"PMF Estimate"} << std::endl;}
\DoxyCodeLine{242         coeffout << \textcolor{stringliteral}{"The information stored in this file is for the purpose of restarting simulations with BFS"} << std::endl;}
\DoxyCodeLine{243         coeffout << \textcolor{stringliteral}{"***COEFFICIENTS***"} << std::endl;}
\DoxyCodeLine{244         }
\DoxyCodeLine{245         \textcolor{keywordtype}{size\_t} j = 0;}
\DoxyCodeLine{246         \textcolor{keywordflow}{for}(\mbox{\hyperlink{classSSAGES_1_1Grid_a7c8ea83ff2ad6a18ea2eee5f0d8b2e49}{Grid<double>::iterator}} it = \mbox{\hyperlink{classSSAGES_1_1BFS_a4b12d4c30951fe0d64e09c2f0607d52f}{b\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1Grid_a709374b3cadf320347604077a2e45e5b}{begin}}(); it != \mbox{\hyperlink{classSSAGES_1_1BFS_a4b12d4c30951fe0d64e09c2f0607d52f}{b\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1Grid_ac4fcc9f0cd61476ce4fd880c768d9694}{end}}(); ++it, ++j)}
\DoxyCodeLine{247         \{}
\DoxyCodeLine{248             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} k = 0; k < cvs.size(); ++k)}
\DoxyCodeLine{249             \{}
\DoxyCodeLine{250                 \textcolor{comment}{// Evaluate the CV values for printing purposes}}
\DoxyCodeLine{251                 basisout << it.coordinate(k) << std::setw(15);}
\DoxyCodeLine{252             \}}
\DoxyCodeLine{253             basisout << -\/(*it) << std::setw(15) <<}
\DoxyCodeLine{254                         -\/1.0/beta*log(\mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}}[j]) << }
\DoxyCodeLine{255                         std::endl;}
\DoxyCodeLine{256         \}}
\DoxyCodeLine{257 }
\DoxyCodeLine{258         std::vector<double> coeff = \mbox{\hyperlink{classSSAGES_1_1BFS_a30981e775e2bed6c3c531ccc813acfaf}{evaluator\_}}.\mbox{\hyperlink{classSSAGES_1_1BasisEvaluator_a24714eacab2c0afdf4fa17a570354a34}{GetCoeff}}();}
\DoxyCodeLine{259         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& val : coeff) \{}
\DoxyCodeLine{260             coeffout << val << std::endl;}
\DoxyCodeLine{261         \}}
\DoxyCodeLine{262         coeffout << \textcolor{stringliteral}{"***HISTOGRAM***"} << std::endl;}
\DoxyCodeLine{263         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& val : \mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}}) \{}
\DoxyCodeLine{264             coeffout << val << std::endl;}
\DoxyCodeLine{265         \}}
\DoxyCodeLine{266 }
\DoxyCodeLine{267         basisout.close();}
\DoxyCodeLine{268         coeffout.close();}
\DoxyCodeLine{269     \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+Grid$<$ T $>$\+::begin().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1BFS_ab32a7fe0fa2d38cd95576e3102d51f06_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1BFS_a417bd522d0ec956394e0ee0d5a154f73}\label{classSSAGES_1_1BFS_a417bd522d0ec956394e0ee0d5a154f73}} 
\index{SSAGES::BFS@{SSAGES::BFS}!ProjectBias@{ProjectBias}}
\index{ProjectBias@{ProjectBias}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{ProjectBias()}{ProjectBias()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::\+Project\+Bias (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespaceSSAGES_acddea47426ac0a643b048f870ddd2907}{C\+V\+List}} \&}]{cvs,  }\item[{const double}]{beta }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



The functions which calculates the updated bias and coefficients and then stores them. 


\begin{DoxyParams}{Parameters}
{\em cvs} & List of C\+Vs onto which the bias is projected \\
\hline
{\em beta} & Thermodynamic beta (1/kT) \\
\hline
\end{DoxyParams}


Definition at line 166 of file Basis\+Func.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{167     \{}
\DoxyCodeLine{168         \textcolor{keywordtype}{double} sum  = 0.0;}
\DoxyCodeLine{169 }
\DoxyCodeLine{170         \textcolor{comment}{// For multiple walkers, the struct is unpacked}}
\DoxyCodeLine{171         Grid<unsigned int> histlocal(*\mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}});}
\DoxyCodeLine{172 }
\DoxyCodeLine{173         \textcolor{comment}{// Summed between all walkers}}
\DoxyCodeLine{174         MPI\_Allreduce(histlocal.data(), \mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a52e519b13f9b53c0767957d86015b0a1}{data}}(), \mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a4f8abb752ae6ec51ebcf24b599bf4896}{size}}(), MPI\_INT, MPI\_SUM, \mbox{\hyperlink{classSSAGES_1_1Method_a8471b11097a1018a9635bc578bf22f61}{world\_}});}
\DoxyCodeLine{175 }
\DoxyCodeLine{176         \mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_ab52bfd510cd1dffb2d91f516c9266c4b}{syncGrid}}();}
\DoxyCodeLine{177 }
\DoxyCodeLine{178         \textcolor{comment}{// Construct the biased histogram}}
\DoxyCodeLine{179         \textcolor{keywordtype}{size\_t} i = 0;}
\DoxyCodeLine{180         \textcolor{keywordflow}{for} (\mbox{\hyperlink{classSSAGES_1_1Grid_a7c8ea83ff2ad6a18ea2eee5f0d8b2e49}{Grid<unsigned int>::iterator}} it2 = \mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1Grid_a709374b3cadf320347604077a2e45e5b}{begin}}(); it2 != \mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1Grid_ac4fcc9f0cd61476ce4fd880c768d9694}{end}}(); ++it2, ++i)}
\DoxyCodeLine{181         \{}
\DoxyCodeLine{182             \textcolor{comment}{/* The evaluation of the biased histogram which projects the histogram to the}}
\DoxyCodeLine{183 \textcolor{comment}{             * current bias of CV space.}}
\DoxyCodeLine{184 \textcolor{comment}{             */}}
\DoxyCodeLine{185             \mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}}[i] += (*it2) * exp(beta * \mbox{\hyperlink{classSSAGES_1_1BFS_a4b12d4c30951fe0d64e09c2f0607d52f}{b\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a7da01557a9b85498c2acd975c152403a}{at}}(it2.coordinates()));}
\DoxyCodeLine{186         \}}
\DoxyCodeLine{187 }
\DoxyCodeLine{188         \textcolor{comment}{// Reset histogram}}
\DoxyCodeLine{189         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&val : *\mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}}) \{}
\DoxyCodeLine{190             val = 0;}
\DoxyCodeLine{191         \}}
\DoxyCodeLine{192 }
\DoxyCodeLine{193         \textcolor{comment}{// Create the log array and send that to the integrator}}
\DoxyCodeLine{194         std::vector<double> z (\mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}}.size(),0);}
\DoxyCodeLine{195         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}}.size(); i++)}
\DoxyCodeLine{196             \textcolor{comment}{// Make sure the log of the biased histogram is a number}}
\DoxyCodeLine{197             z[i] = 1.0/beta*log(\mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}}[i] * \mbox{\hyperlink{classSSAGES_1_1BFS_a0790f5dfa981809fb3f2aa468fd26326}{weight\_}});}
\DoxyCodeLine{198 }
\DoxyCodeLine{199         \textcolor{comment}{//Update the coefficients and determine the difference from the previous iteration}}
\DoxyCodeLine{200         sum = \mbox{\hyperlink{classSSAGES_1_1BFS_a30981e775e2bed6c3c531ccc813acfaf}{evaluator\_}}.\mbox{\hyperlink{classSSAGES_1_1BasisEvaluator_ad02d4d3e5e2e0af87a8e4a9d759a64a0}{UpdateCoeff}}(z,\mbox{\hyperlink{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}{h\_}});}
\DoxyCodeLine{201         \mbox{\hyperlink{classSSAGES_1_1BFS_a5bc27ba07feb8ae8b05b96eb3acca1f7}{coeffArr\_}} = \mbox{\hyperlink{classSSAGES_1_1BFS_a30981e775e2bed6c3c531ccc813acfaf}{evaluator\_}}.\mbox{\hyperlink{classSSAGES_1_1BasisEvaluator_a24714eacab2c0afdf4fa17a570354a34}{GetCoeff}}();}
\DoxyCodeLine{202         \textcolor{comment}{//Update both the gradient and the bias on the grids}}
\DoxyCodeLine{203         \mbox{\hyperlink{classSSAGES_1_1BFS_a30981e775e2bed6c3c531ccc813acfaf}{evaluator\_}}.\mbox{\hyperlink{classSSAGES_1_1BasisEvaluator_ad017032c44a0840f05c7ac4d7fedd5cd}{UpdateBias}}(\mbox{\hyperlink{classSSAGES_1_1BFS_a4b12d4c30951fe0d64e09c2f0607d52f}{b\_}},\mbox{\hyperlink{classSSAGES_1_1BFS_a2eba4830e64c05fe99ddc12d9d6bb95d}{f\_}});}
\DoxyCodeLine{204 }
\DoxyCodeLine{205         \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSSAGES_1_1EventListener_af9666daacfb047c1dd279ea339524d07}{IsMasterRank}}(\mbox{\hyperlink{classSSAGES_1_1Method_a8471b11097a1018a9635bc578bf22f61}{world\_}})) \{}
\DoxyCodeLine{206             \textcolor{comment}{// Write coeff at this step, but only one walker}}
\DoxyCodeLine{207             std::cout<<\textcolor{stringliteral}{"Coefficient difference is: "} <<sum<<std::endl;}
\DoxyCodeLine{208             \mbox{\hyperlink{classSSAGES_1_1BFS_ab32a7fe0fa2d38cd95576e3102d51f06}{PrintBias}}(cvs,beta);}
\DoxyCodeLine{209         \}}
\DoxyCodeLine{210 }
\DoxyCodeLine{211         \textcolor{comment}{// The convergence tolerance and whether the user wants to exit are incorporated here}}
\DoxyCodeLine{212         \textcolor{keywordflow}{if}(sum < \mbox{\hyperlink{classSSAGES_1_1BFS_a617d1e1c2cfbb23c09f9e56200febf2e}{tol\_}})}
\DoxyCodeLine{213         \{}
\DoxyCodeLine{214             std::cout<<\textcolor{stringliteral}{"System has converged"}<<std::endl;}
\DoxyCodeLine{215             \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSSAGES_1_1BFS_a0d1eb924d068ec3a3369c5f48c0a113b}{convergeExit\_}})}
\DoxyCodeLine{216             \{}
\DoxyCodeLine{217                 std::cout<<\textcolor{stringliteral}{"User has elected to exit. System is now exiting"}<<std::endl;}
\DoxyCodeLine{218                 exit(EXIT\_SUCCESS);}
\DoxyCodeLine{219             \}}
\DoxyCodeLine{220         \}}
\DoxyCodeLine{221     \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+Grid$<$ T $>$\+::begin(), and S\+S\+A\+G\+E\+S\+::\+Grid\+Base$<$ T $>$\+::data().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1BFS_a417bd522d0ec956394e0ee0d5a154f73_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1BFS_ae7a1e5c49a98296b2451e6127ef8f425}\label{classSSAGES_1_1BFS_ae7a1e5c49a98296b2451e6127ef8f425}} 
\index{SSAGES::BFS@{SSAGES::BFS}!SetBasis@{SetBasis}}
\index{SetBasis@{SetBasis}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{SetBasis()}{SetBasis()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::\+Set\+Basis (\begin{DoxyParamCaption}\item[{const std\+::vector$<$ double $>$ \&}]{coeff,  }\item[{std\+::vector$<$ double $>$ \&}]{unbias }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Set the values for the basis. 


\begin{DoxyParams}{Parameters}
{\em coeff} & List of coefficients. \\
\hline
{\em unbias} & List of unbiased values.\\
\hline
\end{DoxyParams}
This function is used to set starting values at the beginning of a run. For example when continuing from a restart value. 

Definition at line 235 of file Basis\+Func.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{236         \{}
\DoxyCodeLine{237             \mbox{\hyperlink{classSSAGES_1_1BFS_a30981e775e2bed6c3c531ccc813acfaf}{evaluator\_}}.\mbox{\hyperlink{classSSAGES_1_1BasisEvaluator_a17469fad6d29661c670c2b4ce4877570}{SetCoeff}}(coeff);}
\DoxyCodeLine{238             \mbox{\hyperlink{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}{unbias\_}} = unbias;}
\DoxyCodeLine{239         \}}

\end{DoxyCode}


References evaluator\+\_\+, S\+S\+A\+G\+E\+S\+::\+Basis\+Evaluator\+::\+Set\+Coeff(), and unbias\+\_\+.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1BFS_ae7a1e5c49a98296b2451e6127ef8f425_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1BFS_a68a91253692394292c0aee4daa7bbd54}\label{classSSAGES_1_1BFS_a68a91253692394292c0aee4daa7bbd54}} 
\index{SSAGES::BFS@{SSAGES::BFS}!SetIteration@{SetIteration}}
\index{SetIteration@{SetIteration}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{SetIteration()}{SetIteration()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::\+Set\+Iteration (\begin{DoxyParamCaption}\item[{const int}]{iter }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Set the current iteration. 


\begin{DoxyParams}{Parameters}
{\em iter} & New value for the current iteration.\\
\hline
\end{DoxyParams}
This function is used to set the current iteration, for example when continuing from a restart. 

Definition at line 222 of file Basis\+Func.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{223         \{}
\DoxyCodeLine{224             \mbox{\hyperlink{classSSAGES_1_1BFS_a6c269415f6ffb33f306286e990c80235}{iteration\_}} = iter;}
\DoxyCodeLine{225         \}}

\end{DoxyCode}


References iteration\+\_\+.



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classSSAGES_1_1BFS_a4b12d4c30951fe0d64e09c2f0607d52f}\label{classSSAGES_1_1BFS_a4b12d4c30951fe0d64e09c2f0607d52f}} 
\index{SSAGES::BFS@{SSAGES::BFS}!b\_@{b\_}}
\index{b\_@{b\_}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{b\_}{b\_}}
{\footnotesize\ttfamily \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$double$>$$\ast$ S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::b\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



Stored bias potential. 

The sum of basis functions that adds up to the bias potential of the surface 

Definition at line 52 of file Basis\+Func.\+h.

\mbox{\Hypertarget{classSSAGES_1_1BFS_a5509ec03f12b0198f478a119909f31cc}\label{classSSAGES_1_1BFS_a5509ec03f12b0198f478a119909f31cc}} 
\index{SSAGES::BFS@{SSAGES::BFS}!bnme\_@{bnme\_}}
\index{bnme\_@{bnme\_}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{bnme\_}{bnme\_}}
{\footnotesize\ttfamily std\+::string S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::bnme\+\_\+\hspace{0.3cm}{\ttfamily [private]}}

The option to name both the basis and coefficient files will be given Basis filename ~\newline
 

Definition at line 151 of file Basis\+Func.\+h.

\mbox{\Hypertarget{classSSAGES_1_1BFS_a30981e775e2bed6c3c531ccc813acfaf}\label{classSSAGES_1_1BFS_a30981e775e2bed6c3c531ccc813acfaf}} 
\index{SSAGES::BFS@{SSAGES::BFS}!evaluator\_@{evaluator\_}}
\index{evaluator\_@{evaluator\_}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{evaluator\_}{evaluator\_}}
{\footnotesize\ttfamily \mbox{\hyperlink{classSSAGES_1_1BasisEvaluator}{Basis\+Evaluator}} S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::evaluator\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



The basis evaluator class. 

A class which holds the basis functions and updates the coefficients at each cycle 

Definition at line 76 of file Basis\+Func.\+h.



Referenced by Set\+Basis().

\mbox{\Hypertarget{classSSAGES_1_1BFS_a2eba4830e64c05fe99ddc12d9d6bb95d}\label{classSSAGES_1_1BFS_a2eba4830e64c05fe99ddc12d9d6bb95d}} 
\index{SSAGES::BFS@{SSAGES::BFS}!f\_@{f\_}}
\index{f\_@{f\_}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{f\_}{f\_}}
{\footnotesize\ttfamily \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$std\+::vector$<$double$>$ $>$$\ast$ S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::f\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



Stored gradients. 

The gradients corresponding to each point on the grid 

Definition at line 58 of file Basis\+Func.\+h.

\mbox{\Hypertarget{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}\label{classSSAGES_1_1BFS_a291d4da1b6b8eb0de751fd3e6130d285}} 
\index{SSAGES::BFS@{SSAGES::BFS}!h\_@{h\_}}
\index{h\_@{h\_}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{h\_}{h\_}}
{\footnotesize\ttfamily \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$unsigned int$>$$\ast$ S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::h\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



\mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}} of visited states. 

\mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}} is stored locally. 

Definition at line 46 of file Basis\+Func.\+h.

\mbox{\Hypertarget{classSSAGES_1_1BFS_a11d9317604fb0b474eaf40744377480b}\label{classSSAGES_1_1BFS_a11d9317604fb0b474eaf40744377480b}} 
\index{SSAGES::BFS@{SSAGES::BFS}!restraint\_@{restraint\_}}
\index{restraint\_@{restraint\_}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{restraint\_}{restraint\_}}
{\footnotesize\ttfamily std\+::vector$<$double$>$ S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::restraint\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



Spring constants for restrained system. 

The system uses this to determine if the system is to be restrained on the defined interval. The user inputs the spring constants if the system is not periodic. 

Definition at line 84 of file Basis\+Func.\+h.

\mbox{\Hypertarget{classSSAGES_1_1BFS_a1d2663f5237b2dc961699f59ee83cf2e}\label{classSSAGES_1_1BFS_a1d2663f5237b2dc961699f59ee83cf2e}} 
\index{SSAGES::BFS@{SSAGES::BFS}!temperature\_@{temperature\_}}
\index{temperature\_@{temperature\_}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{temperature\_}{temperature\_}}
{\footnotesize\ttfamily double S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::temperature\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



Self-\/defined temperature. 

In the case of the MD engine using a poorly defined temperature, the option to throw it into the method is available. If not provided it takes the value from the engine. 

Definition at line 118 of file Basis\+Func.\+h.

\mbox{\Hypertarget{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}\label{classSSAGES_1_1BFS_af5f4a44ac6759ac5886618707b448dc2}} 
\index{SSAGES::BFS@{SSAGES::BFS}!unbias\_@{unbias\_}}
\index{unbias\_@{unbias\_}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{unbias\_}{unbias\_}}
{\footnotesize\ttfamily std\+::vector$<$double$>$ S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::unbias\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



The biased histogram of states. 

The biased histogram of states has the form hist\+\_\+$\ast$exp(phi$\ast$beta), where phi is the bias potential and beta is the inverse of the temperature. It is defined globally. 

Definition at line 66 of file Basis\+Func.\+h.



Referenced by Set\+Basis().

\mbox{\Hypertarget{classSSAGES_1_1BFS_a0790f5dfa981809fb3f2aa468fd26326}\label{classSSAGES_1_1BFS_a0790f5dfa981809fb3f2aa468fd26326}} 
\index{SSAGES::BFS@{SSAGES::BFS}!weight\_@{weight\_}}
\index{weight\_@{weight\_}!SSAGES::BFS@{SSAGES::BFS}}
\doxysubsubsection{\texorpdfstring{weight\_}{weight\_}}
{\footnotesize\ttfamily double S\+S\+A\+G\+E\+S\+::\+B\+F\+S\+::weight\+\_\+\hspace{0.3cm}{\ttfamily [private]}}



Weighting for potentially faster sampling. 

Weighting can be used to potentially sample faster, however it can cause the simulation to explode. By default this value will be set to 1.\+0 

Definition at line 110 of file Basis\+Func.\+h.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/michael/development/\+S\+S\+A\+G\+E\+S/src/\+Methods/Basis\+Func.\+h\item 
/home/michael/development/\+S\+S\+A\+G\+E\+S/src/\+Methods/Basis\+Func.\+cpp\end{DoxyCompactItemize}
