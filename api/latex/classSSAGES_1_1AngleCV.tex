\hypertarget{classSSAGES_1_1AngleCV}{}\doxysection{S\+S\+A\+G\+ES\+::Angle\+CV Class Reference}
\label{classSSAGES_1_1AngleCV}\index{SSAGES::AngleCV@{SSAGES::AngleCV}}


Collective variable to calculate angle.  




{\ttfamily \#include $<$Angle\+C\+V.\+h$>$}



Inheritance diagram for S\+S\+A\+G\+ES\+::Angle\+CV\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=223pt]{classSSAGES_1_1AngleCV__inherit__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classSSAGES_1_1AngleCV_a34ffc931d859a502a8f8c5f61561c896}{Angle\+CV}} (int atomid1, int atomid2, int atomid3)
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1AngleCV_a6e2a96d605cbf6f664e57dc312d219f2}{Initialize}} (const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&snapshot) override
\begin{DoxyCompactList}\small\item\em Initialize necessary variables. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1AngleCV_afc7cddc3872aeeeeb098c69f1126b594}{Evaluate}} (const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&snapshot) override
\begin{DoxyCompactList}\small\item\em Evaluate the CV. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{classSSAGES_1_1AngleCV}{Angle\+CV}} $\ast$ \mbox{\hyperlink{classSSAGES_1_1AngleCV_abb07c513c9eb73a0b4b44f2eb602096d}{Build}} (const Json\+::\+Value \&json, const std\+::string \&path)
\begin{DoxyCompactList}\small\item\em Set up collective variable. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classSSAGES_1_1AngleCV_a648e36657c1fbcc3b6f3cfdbedc36ad2}\label{classSSAGES_1_1AngleCV_a648e36657c1fbcc3b6f3cfdbedc36ad2}} 
\mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}} \mbox{\hyperlink{classSSAGES_1_1AngleCV_a648e36657c1fbcc3b6f3cfdbedc36ad2}{atomids\+\_\+}}
\begin{DoxyCompactList}\small\item\em Vector of 3 atom ID\textquotesingle{}s of interest. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
Collective variable to calculate angle. 

Definition at line 35 of file Angle\+C\+V.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classSSAGES_1_1AngleCV_a34ffc931d859a502a8f8c5f61561c896}\label{classSSAGES_1_1AngleCV_a34ffc931d859a502a8f8c5f61561c896}} 
\index{SSAGES::AngleCV@{SSAGES::AngleCV}!AngleCV@{AngleCV}}
\index{AngleCV@{AngleCV}!SSAGES::AngleCV@{SSAGES::AngleCV}}
\doxysubsubsection{\texorpdfstring{AngleCV()}{AngleCV()}}
{\footnotesize\ttfamily S\+S\+A\+G\+E\+S\+::\+Angle\+C\+V\+::\+Angle\+CV (\begin{DoxyParamCaption}\item[{int}]{atomid1,  }\item[{int}]{atomid2,  }\item[{int}]{atomid3 }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Constructor. 


\begin{DoxyParams}{Parameters}
{\em atomid1} & ID of the first atom defining the angle. \\
\hline
{\em atomid2} & ID of the second atom defining the angle. \\
\hline
{\em atomid3} & ID of the third atom defining the angle.\\
\hline
\end{DoxyParams}
Construct an dihedral CV.

\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000001}{Todo}}]Bounds needs to be an input and periodic boundary conditions \end{DoxyRefDesc}


Definition at line 53 of file Angle\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{53                                                        :}
\DoxyCodeLine{54         \mbox{\hyperlink{classSSAGES_1_1AngleCV_a648e36657c1fbcc3b6f3cfdbedc36ad2}{atomids\_}}(\{atomid1, atomid2, atomid3\})}
\DoxyCodeLine{55         \{}
\DoxyCodeLine{56             \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_abc60e9b019d4b61354faf60a76d3530e}{bounds\_}} = \{\{0,M\_PI\}\};}
\DoxyCodeLine{57         \}}

\end{DoxyCode}


Referenced by Build().

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1AngleCV_a34ffc931d859a502a8f8c5f61561c896_icgraph}
\end{center}
\end{figure}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classSSAGES_1_1AngleCV_abb07c513c9eb73a0b4b44f2eb602096d}\label{classSSAGES_1_1AngleCV_abb07c513c9eb73a0b4b44f2eb602096d}} 
\index{SSAGES::AngleCV@{SSAGES::AngleCV}!Build@{Build}}
\index{Build@{Build}!SSAGES::AngleCV@{SSAGES::AngleCV}}
\doxysubsubsection{\texorpdfstring{Build()}{Build()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{classSSAGES_1_1AngleCV}{Angle\+CV}}$\ast$ S\+S\+A\+G\+E\+S\+::\+Angle\+C\+V\+::\+Build (\begin{DoxyParamCaption}\item[{const Json\+::\+Value \&}]{json,  }\item[{const std\+::string \&}]{path }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Set up collective variable. 


\begin{DoxyParams}{Parameters}
{\em json} & \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} input value. \\
\hline
{\em path} & Path for \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} path specification. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the CV built by this function. {\ttfamily nullptr} in case of unknown error.
\end{DoxyReturn}
Builds a CV from a \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node. Returns a pointer to the built cv. If an unknown error is encountered, this function will return a {\ttfamily nullptr}, but generally it will throw a \mbox{\hyperlink{classSSAGES_1_1BuildException}{Build\+Exception}} on failure. \begin{DoxyWarning}{Warning}
Object lifetime is the caller\textquotesingle{}s responsibility. 
\end{DoxyWarning}


Definition at line 136 of file Angle\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{137         \{}
\DoxyCodeLine{138             \mbox{\hyperlink{classJson_1_1ObjectRequirement}{Json::ObjectRequirement}} validator;}
\DoxyCodeLine{139             Json::Value schema;}
\DoxyCodeLine{140             Json::CharReaderBuilder rbuilder;}
\DoxyCodeLine{141             Json::CharReader* reader = rbuilder.newCharReader();}
\DoxyCodeLine{142 }
\DoxyCodeLine{143             reader-\/>parse(JsonSchema::AngleCV.c\_str(),}
\DoxyCodeLine{144                           JsonSchema::AngleCV.c\_str() + JsonSchema::AngleCV.size(),}
\DoxyCodeLine{145                           \&schema, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{146             validator.\mbox{\hyperlink{classJson_1_1ObjectRequirement_a4ed02ae1d612a5efba1688fcdd2df092}{Parse}}(schema, path);}
\DoxyCodeLine{147 }
\DoxyCodeLine{148             \textcolor{comment}{// Validate inputs.}}
\DoxyCodeLine{149             validator.\mbox{\hyperlink{classJson_1_1ObjectRequirement_a9ac3b920001a35bc70580035d8d802b7}{Validate}}(json, path);}
\DoxyCodeLine{150             \textcolor{keywordflow}{if}(validator.\mbox{\hyperlink{classJson_1_1Requirement_adfaec336a9f051d6f6b9a6d7f1d97b75}{HasErrors}}())}
\DoxyCodeLine{151                 \textcolor{keywordflow}{throw} BuildException(validator.\mbox{\hyperlink{classJson_1_1Requirement_a60bc275c366eb59f192fa2e621268480}{GetErrors}}());}
\DoxyCodeLine{152             }
\DoxyCodeLine{153             std::vector<int> atomids;}
\DoxyCodeLine{154             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& s : json[\textcolor{stringliteral}{"atom\_ids"}])}
\DoxyCodeLine{155                 atomids.push\_back(s.asInt());}
\DoxyCodeLine{156 }
\DoxyCodeLine{157             \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classSSAGES_1_1AngleCV_a34ffc931d859a502a8f8c5f61561c896}{AngleCV}}(atomids[0], atomids[1], atomids[2]);}
\DoxyCodeLine{158         \}}

\end{DoxyCode}


References Angle\+C\+V(), Json\+::\+Requirement\+::\+Get\+Errors(), Json\+::\+Requirement\+::\+Has\+Errors(), Json\+::\+Object\+Requirement\+::\+Parse(), and Json\+::\+Object\+Requirement\+::\+Validate().



Referenced by S\+S\+A\+G\+E\+S\+::\+Collective\+Variable\+::\+Build\+C\+V().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1AngleCV_abb07c513c9eb73a0b4b44f2eb602096d_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1AngleCV_abb07c513c9eb73a0b4b44f2eb602096d_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1AngleCV_afc7cddc3872aeeeeb098c69f1126b594}\label{classSSAGES_1_1AngleCV_afc7cddc3872aeeeeb098c69f1126b594}} 
\index{SSAGES::AngleCV@{SSAGES::AngleCV}!Evaluate@{Evaluate}}
\index{Evaluate@{Evaluate}!SSAGES::AngleCV@{SSAGES::AngleCV}}
\doxysubsubsection{\texorpdfstring{Evaluate()}{Evaluate()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Angle\+C\+V\+::\+Evaluate (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&}]{snapshot }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}



Evaluate the CV. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Current simulation snapshot. \\
\hline
\end{DoxyParams}


Definition at line 85 of file Angle\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{86         \{}
\DoxyCodeLine{87             \textcolor{comment}{// Get data from snapshot. }}
\DoxyCodeLine{88             \textcolor{keyword}{auto} n = snapshot.GetNumAtoms();}
\DoxyCodeLine{89             \textcolor{keyword}{const} \textcolor{keyword}{auto}\& pos = snapshot.GetPositions();}
\DoxyCodeLine{90             \textcolor{keyword}{auto}\& comm = snapshot.GetCommunicator();}
\DoxyCodeLine{91 }
\DoxyCodeLine{92             \textcolor{comment}{// Initialize gradient.}}
\DoxyCodeLine{93             std::fill(\mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}.begin(), \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}.end(), \mbox{\hyperlink{namespaceSSAGES_a630084a0a5e185e89e21b3735f8f8b2e}{Vector3}}\{0,0,0\});}
\DoxyCodeLine{94             \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}.resize(n, \mbox{\hyperlink{namespaceSSAGES_a630084a0a5e185e89e21b3735f8f8b2e}{Vector3}}\{0,0,0\});}
\DoxyCodeLine{95 }
\DoxyCodeLine{96             \mbox{\hyperlink{namespaceSSAGES_a630084a0a5e185e89e21b3735f8f8b2e}{Vector3}} xi\{0, 0, 0\}, xj\{0, 0, 0\}, xk\{0, 0, 0\};}
\DoxyCodeLine{97 }
\DoxyCodeLine{98             \textcolor{keyword}{auto} iindex = snapshot.GetLocalIndex(\mbox{\hyperlink{classSSAGES_1_1AngleCV_a648e36657c1fbcc3b6f3cfdbedc36ad2}{atomids\_}}[0]);}
\DoxyCodeLine{99             \textcolor{keyword}{auto} jindex = snapshot.GetLocalIndex(\mbox{\hyperlink{classSSAGES_1_1AngleCV_a648e36657c1fbcc3b6f3cfdbedc36ad2}{atomids\_}}[1]);}
\DoxyCodeLine{100             \textcolor{keyword}{auto} kindex = snapshot.GetLocalIndex(\mbox{\hyperlink{classSSAGES_1_1AngleCV_a648e36657c1fbcc3b6f3cfdbedc36ad2}{atomids\_}}[2]);}
\DoxyCodeLine{101 }
\DoxyCodeLine{102             \textcolor{keywordflow}{if}(iindex != -\/1) xi = pos[iindex];}
\DoxyCodeLine{103             \textcolor{keywordflow}{if}(jindex != -\/1) xj = pos[jindex];}
\DoxyCodeLine{104             \textcolor{keywordflow}{if}(kindex != -\/1) xk = pos[kindex];}
\DoxyCodeLine{105 }
\DoxyCodeLine{106             \textcolor{comment}{// By performing a reduce, we actually collect all. This can }}
\DoxyCodeLine{107             \textcolor{comment}{// be converted to a more intelligent allgater on rank then bcast. }}
\DoxyCodeLine{108             MPI\_Allreduce(MPI\_IN\_PLACE, xi.data(), 3, MPI\_DOUBLE, MPI\_SUM, comm);}
\DoxyCodeLine{109             MPI\_Allreduce(MPI\_IN\_PLACE, xj.data(), 3, MPI\_DOUBLE, MPI\_SUM, comm);}
\DoxyCodeLine{110             MPI\_Allreduce(MPI\_IN\_PLACE, xk.data(), 3, MPI\_DOUBLE, MPI\_SUM, comm);}
\DoxyCodeLine{111 }
\DoxyCodeLine{112             \textcolor{comment}{// Two vectors}}
\DoxyCodeLine{113             \textcolor{keyword}{auto} rij = snapshot.ApplyMinimumImage(xi -\/ xj);}
\DoxyCodeLine{114             \textcolor{keyword}{auto} rkj = snapshot.ApplyMinimumImage(xk -\/ xj);}
\DoxyCodeLine{115 }
\DoxyCodeLine{116             \textcolor{keyword}{auto} dotP = rij.dot(rkj);}
\DoxyCodeLine{117             \textcolor{keyword}{auto} nrij = rij.norm();}
\DoxyCodeLine{118             \textcolor{keyword}{auto} nrkj = rkj.norm();}
\DoxyCodeLine{119 }
\DoxyCodeLine{120             \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a65b17f3e9b3c967ad42814c3eec88bb2}{val\_}} = acos(dotP/(nrij*nrkj));}
\DoxyCodeLine{121 }
\DoxyCodeLine{122             \textcolor{comment}{// Calculate gradients}}
\DoxyCodeLine{123             \textcolor{keyword}{auto} prefactor = -\/1.0/(sqrt(1. -\/ dotP/(nrij*nrkj))*nrij*nrkj);}
\DoxyCodeLine{124 }
\DoxyCodeLine{125             \mbox{\hyperlink{namespaceSSAGES_a630084a0a5e185e89e21b3735f8f8b2e}{Vector3}} gradi\{0, 0, 0\}, gradk\{0, 0, 0\};}
\DoxyCodeLine{126             \textcolor{keywordflow}{if}(iindex != -\/1) gradi = prefactor*(rkj -\/ dotP*rij/(nrij*nrij));}
\DoxyCodeLine{127             \textcolor{keywordflow}{if}(kindex != -\/1) gradk = prefactor*(rij -\/ dotP*rkj/(nrkj*nrkj));}
\DoxyCodeLine{128             MPI\_Allreduce(MPI\_IN\_PLACE, gradi.data(), 3, MPI\_DOUBLE, MPI\_SUM, comm);}
\DoxyCodeLine{129             MPI\_Allreduce(MPI\_IN\_PLACE, gradk.data(), 3, MPI\_DOUBLE, MPI\_SUM, comm);}
\DoxyCodeLine{130             \textcolor{keywordflow}{if}(iindex != -\/1) \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}[iindex] = gradi;    }
\DoxyCodeLine{131             \textcolor{keywordflow}{if}(kindex != -\/1) \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}[kindex] = gradk;}
\DoxyCodeLine{132             \textcolor{keywordflow}{if}(jindex != -\/1) \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}[jindex] = -\/gradi -\/ gradk;}
\DoxyCodeLine{133         \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Apply\+Minimum\+Image(), atomids\+\_\+, S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Communicator(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Local\+Index(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Num\+Atoms(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Positions(), S\+S\+A\+G\+E\+S\+::\+Collective\+Variable\+::grad\+\_\+, and S\+S\+A\+G\+E\+S\+::\+Collective\+Variable\+::val\+\_\+.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1AngleCV_afc7cddc3872aeeeeb098c69f1126b594_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1AngleCV_a6e2a96d605cbf6f664e57dc312d219f2}\label{classSSAGES_1_1AngleCV_a6e2a96d605cbf6f664e57dc312d219f2}} 
\index{SSAGES::AngleCV@{SSAGES::AngleCV}!Initialize@{Initialize}}
\index{Initialize@{Initialize}!SSAGES::AngleCV@{SSAGES::AngleCV}}
\doxysubsubsection{\texorpdfstring{Initialize()}{Initialize()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Angle\+C\+V\+::\+Initialize (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&}]{snapshot }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}



Initialize necessary variables. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Current simulation snapshot. \\
\hline
\end{DoxyParams}


Definition at line 63 of file Angle\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{64         \{}
\DoxyCodeLine{65             \textcolor{keyword}{using} std::to\_string;}
\DoxyCodeLine{66             }
\DoxyCodeLine{67             std::vector<int> found;}
\DoxyCodeLine{68             snapshot.GetLocalIndices(\mbox{\hyperlink{classSSAGES_1_1AngleCV_a648e36657c1fbcc3b6f3cfdbedc36ad2}{atomids\_}}, \&found);}
\DoxyCodeLine{69             \textcolor{keywordtype}{int} nfound = found.size();}
\DoxyCodeLine{70             MPI\_Allreduce(MPI\_IN\_PLACE, \&nfound, 1, MPI\_INT, MPI\_SUM, snapshot.GetCommunicator());}
\DoxyCodeLine{71             }
\DoxyCodeLine{72             \textcolor{keywordflow}{if}(nfound != 3)}
\DoxyCodeLine{73                 \textcolor{keywordflow}{throw} BuildException(\{}
\DoxyCodeLine{74                     \textcolor{stringliteral}{"TorsionalCV: Expected to find "} + }
\DoxyCodeLine{75                     to\_string(3) + }
\DoxyCodeLine{76                     \textcolor{stringliteral}{" atoms, but only found "} + }
\DoxyCodeLine{77                     to\_string(nfound) + \textcolor{stringliteral}{"."}}
\DoxyCodeLine{78                 \}); }
\DoxyCodeLine{79         \}}

\end{DoxyCode}


References atomids\+\_\+, S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Communicator(), and S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Local\+Indices().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1AngleCV_a6e2a96d605cbf6f664e57dc312d219f2_cgraph}
\end{center}
\end{figure}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
/home/michael/development/\+S\+S\+A\+G\+E\+S/src/\+C\+Vs/Angle\+C\+V.\+h\end{DoxyCompactItemize}
