\hypertarget{classSSAGES_1_1Meta}{}\doxysection{S\+S\+A\+G\+ES\+::Meta Class Reference}
\label{classSSAGES_1_1Meta}\index{SSAGES::Meta@{SSAGES::Meta}}


\char`\"{}\+Vanilla\char`\"{} multi-\/dimensional Metadynamics.  




{\ttfamily \#include $<$Meta.\+h$>$}



Inheritance diagram for S\+S\+A\+G\+ES\+::Meta\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=204pt]{classSSAGES_1_1Meta__inherit__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classSSAGES_1_1Meta_a3a8bf5758a11025cd76aea99895cc855}{Meta}} (const M\+P\+I\+\_\+\+Comm \&world, const M\+P\+I\+\_\+\+Comm \&comm, double height, const std\+::vector$<$ double $>$ \&widths, const std\+::vector$<$ double $>$ \&lowerb, const std\+::vector$<$ double $>$ \&upperb, const std\+::vector$<$ double $>$ \&lowerk, const std\+::vector$<$ double $>$ \&upperk, \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ \mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} $>$ $\ast$grid, unsigned int hillfreq, unsigned int frequency)
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1Meta_a9a584ea39168a9fd57f5f7cf98102480}{Pre\+Simulation}} (\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$snapshot, const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&cvmanager) override
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call prior to simulation initiation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1Meta_a352edd1cebb4731d7b2e260fbb96d3bc}{Post\+Integration}} (\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$snapshot, const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&cvmanager) override
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call post integration. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1Meta_a218346ad51e6991576baffde2e82f0e0}{Post\+Simulation}} (\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$snapshot, const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&cvmanager) override
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call post simulation. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1Meta_a9c53debbdcc91a5a5f54958dd67ae51f}{Load\+Hills}} (const std\+::string \&filename)
\begin{DoxyCompactList}\small\item\em Load hills from file. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_a2581995cf90fc1a72bcd5b00940818c5}\label{classSSAGES_1_1Meta_a2581995cf90fc1a72bcd5b00940818c5}} 
\mbox{\hyperlink{classSSAGES_1_1Meta_a2581995cf90fc1a72bcd5b00940818c5}{$\sim$\+Meta}} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{classSSAGES_1_1Meta}{Meta}} $\ast$ \mbox{\hyperlink{classSSAGES_1_1Meta_a51bd46425cf7d5aad4205ea17e2ac3e9}{Build}} (const Json\+::\+Value \&json, const M\+P\+I\+\_\+\+Comm \&world, const M\+P\+I\+\_\+\+Comm \&comm, const std\+::string \&path)
\begin{DoxyCompactList}\small\item\em Build a derived method from \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Member Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{classSSAGES_1_1Meta_afc8e23308641672a8e0363e2d40b19c2}{Add\+Hill}} (const \mbox{\hyperlink{namespaceSSAGES_acddea47426ac0a643b048f870ddd2907}{C\+V\+List}} \&cvs, int iteration)
\begin{DoxyCompactList}\small\item\em Adds a new hill. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1Meta_a9cd073ee3c04a98e5131e96ffcb11df8}{Calc\+Bias\+Force}} (const \mbox{\hyperlink{namespaceSSAGES_acddea47426ac0a643b048f870ddd2907}{C\+V\+List}} \&cvs)
\begin{DoxyCompactList}\small\item\em Computes the bias force. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1Meta_ad5a8f790fa4281d53ef6a0790de22192}{Print\+Hill}} (const \mbox{\hyperlink{structSSAGES_1_1Hill}{Hill}} \&hill, int iteration)
\begin{DoxyCompactList}\small\item\em Prints the new hill to file. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_a83a72749ecba4e0c248a191566689d63}\label{classSSAGES_1_1Meta_a83a72749ecba4e0c248a191566689d63}} 
std\+::vector$<$ \mbox{\hyperlink{structSSAGES_1_1Hill}{Hill}} $>$ \mbox{\hyperlink{classSSAGES_1_1Meta_a83a72749ecba4e0c248a191566689d63}{hills\+\_\+}}
\begin{DoxyCompactList}\small\item\em Hills. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_adfad422c777be811ccb5a47729992a4e}\label{classSSAGES_1_1Meta_adfad422c777be811ccb5a47729992a4e}} 
double \mbox{\hyperlink{classSSAGES_1_1Meta_adfad422c777be811ccb5a47729992a4e}{height\+\_\+}}
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{structSSAGES_1_1Hill}{Hill}} height. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_aad9cf755f8fd35f3d7fed60b981c1497}\label{classSSAGES_1_1Meta_aad9cf755f8fd35f3d7fed60b981c1497}} 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classSSAGES_1_1Meta_aad9cf755f8fd35f3d7fed60b981c1497}{widths\+\_\+}}
\begin{DoxyCompactList}\small\item\em \mbox{\hyperlink{structSSAGES_1_1Hill}{Hill}} widths. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_a588f0dfffb71410b59caf12b7ad0cc50}\label{classSSAGES_1_1Meta_a588f0dfffb71410b59caf12b7ad0cc50}} 
unsigned int \mbox{\hyperlink{classSSAGES_1_1Meta_a588f0dfffb71410b59caf12b7ad0cc50}{hillfreq\+\_\+}}
\begin{DoxyCompactList}\small\item\em Frequency of new hills. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}\label{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}} 
\mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ \mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} $>$ $\ast$ \mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\+\_\+}}
\begin{DoxyCompactList}\small\item\em CV \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}\label{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}} 
std\+::ofstream \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\+\_\+}}
\begin{DoxyCompactList}\small\item\em Output stream for hill data. \end{DoxyCompactList}\end{DoxyCompactItemize}
\textbf{ }\par
\begin{DoxyCompactItemize}
\item 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\+\_\+}}
\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_a738a3f5f047225f8a6bcd5c995bcd6bf}\label{classSSAGES_1_1Meta_a738a3f5f047225f8a6bcd5c995bcd6bf}} 
std\+::vector$<$ double $>$ {\bfseries tder\+\_\+}
\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_ab77581d86329fd6e79c70012e03fd21f}\label{classSSAGES_1_1Meta_ab77581d86329fd6e79c70012e03fd21f}} 
std\+::vector$<$ double $>$ {\bfseries dx\+\_\+}
\end{DoxyCompactItemize}

\textbf{ }\par
\begin{DoxyCompactItemize}
\item 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classSSAGES_1_1Meta_a3f6d45e420b5795563de6f891908e807}{upperb\+\_\+}}
\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_afb05aaf4f0e71403c19c9d1fdefe54eb}\label{classSSAGES_1_1Meta_afb05aaf4f0e71403c19c9d1fdefe54eb}} 
std\+::vector$<$ double $>$ {\bfseries lowerb\+\_\+}
\end{DoxyCompactItemize}

\textbf{ }\par
\begin{DoxyCompactItemize}
\item 
std\+::vector$<$ double $>$ \mbox{\hyperlink{classSSAGES_1_1Meta_a33e2f67c058c3178af21631fe9777b4e}{upperk\+\_\+}}
\item 
\mbox{\Hypertarget{classSSAGES_1_1Meta_a00482d06440d31c835cdf47bd185aa0f}\label{classSSAGES_1_1Meta_a00482d06440d31c835cdf47bd185aa0f}} 
std\+::vector$<$ double $>$ {\bfseries lowerk\+\_\+}
\end{DoxyCompactItemize}

\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
\char`\"{}\+Vanilla\char`\"{} multi-\/dimensional Metadynamics. 

Implementation of a \char`\"{}vanilla\char`\"{} multi-\/dimensional Metadynamics method with no bells and whistles. 

Definition at line 68 of file Meta.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classSSAGES_1_1Meta_a3a8bf5758a11025cd76aea99895cc855}\label{classSSAGES_1_1Meta_a3a8bf5758a11025cd76aea99895cc855}} 
\index{SSAGES::Meta@{SSAGES::Meta}!Meta@{Meta}}
\index{Meta@{Meta}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{Meta()}{Meta()}}
{\footnotesize\ttfamily S\+S\+A\+G\+E\+S\+::\+Meta\+::\+Meta (\begin{DoxyParamCaption}\item[{const M\+P\+I\+\_\+\+Comm \&}]{world,  }\item[{const M\+P\+I\+\_\+\+Comm \&}]{comm,  }\item[{double}]{height,  }\item[{const std\+::vector$<$ double $>$ \&}]{widths,  }\item[{const std\+::vector$<$ double $>$ \&}]{lowerb,  }\item[{const std\+::vector$<$ double $>$ \&}]{upperb,  }\item[{const std\+::vector$<$ double $>$ \&}]{lowerk,  }\item[{const std\+::vector$<$ double $>$ \&}]{upperk,  }\item[{\mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}}$<$ \mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} $>$ $\ast$}]{grid,  }\item[{unsigned int}]{hillfreq,  }\item[{unsigned int}]{frequency }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Constructor. 


\begin{DoxyParams}{Parameters}
{\em world} & M\+PI global communicator. \\
\hline
{\em comm} & M\+PI local communicator. \\
\hline
{\em height} & Height of the hills to be deposited. \\
\hline
{\em widths} & Width of the hills to be deposited. \\
\hline
{\em lowerb} & Lower bounds for C\+Vs. \\
\hline
{\em upperb} & Upper bounds for C\+Vs. \\
\hline
{\em lowerk} & Lower bound restraints for C\+Vs. \\
\hline
{\em upperk} & Upper bound restraints for C\+Vs. \\
\hline
{\em grid} & \mbox{\hyperlink{classSSAGES_1_1Grid}{Grid}} containing bias. \\
\hline
{\em hillfreq} & Frequency of depositing hills. \\
\hline
{\em frequency} & Frequency of invoking this method.\\
\hline
\end{DoxyParams}
Constructs an instance of Metadynamics method. \begin{DoxyNote}{Note}
The size of \char`\"{}widths\char`\"{} should be commensurate with the number of CV\textquotesingle{}s expected. 
\end{DoxyNote}


Definition at line 143 of file Meta.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{153                                      : }
\DoxyCodeLine{154         \mbox{\hyperlink{classSSAGES_1_1Method_ad751450ecd30e8ab40024c6f5e870d30}{Method}}(frequency, world, comm), \mbox{\hyperlink{classSSAGES_1_1Meta_a83a72749ecba4e0c248a191566689d63}{hills\_}}(), \mbox{\hyperlink{classSSAGES_1_1Meta_adfad422c777be811ccb5a47729992a4e}{height\_}}(height), \mbox{\hyperlink{classSSAGES_1_1Meta_aad9cf755f8fd35f3d7fed60b981c1497}{widths\_}}(widths), }
\DoxyCodeLine{155         \mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\_}}(0), tder\_(0), dx\_(0), \mbox{\hyperlink{classSSAGES_1_1Meta_a588f0dfffb71410b59caf12b7ad0cc50}{hillfreq\_}}(hillfreq), \mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\_}}(grid),}
\DoxyCodeLine{156         \mbox{\hyperlink{classSSAGES_1_1Meta_a3f6d45e420b5795563de6f891908e807}{upperb\_}}(upperb), lowerb\_(lowerb), \mbox{\hyperlink{classSSAGES_1_1Meta_a33e2f67c058c3178af21631fe9777b4e}{upperk\_}}(upperk), lowerk\_(lowerk)}
\DoxyCodeLine{157         \{}
\DoxyCodeLine{158         \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classSSAGES_1_1Meta_afc8e23308641672a8e0363e2d40b19c2}\label{classSSAGES_1_1Meta_afc8e23308641672a8e0363e2d40b19c2}} 
\index{SSAGES::Meta@{SSAGES::Meta}!AddHill@{AddHill}}
\index{AddHill@{AddHill}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{AddHill()}{AddHill()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Meta\+::\+Add\+Hill (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespaceSSAGES_acddea47426ac0a643b048f870ddd2907}{C\+V\+List}} \&}]{cvs,  }\item[{int}]{iteration }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Adds a new hill. 


\begin{DoxyParams}{Parameters}
{\em cvs} & List of C\+Vs. \\
\hline
{\em iteration} & Current iteration. \\
\hline
\end{DoxyParams}


Definition at line 168 of file Meta.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{169     \{}
\DoxyCodeLine{170         \textcolor{keywordtype}{size\_t} n = cvs.size();}
\DoxyCodeLine{171 }
\DoxyCodeLine{172         \textcolor{comment}{// Assume we have the same number of procs per walker.}}
\DoxyCodeLine{173         \textcolor{keywordtype}{int} nwalkers = \mbox{\hyperlink{classSSAGES_1_1Method_a8471b11097a1018a9635bc578bf22f61}{world\_}}.size()/\mbox{\hyperlink{classSSAGES_1_1Method_a1118666d61dbf3bc7606e3b61aa3a460}{comm\_}}.size();}
\DoxyCodeLine{174 }
\DoxyCodeLine{175         \textcolor{comment}{// We need to exchange CV values across the walkers }}
\DoxyCodeLine{176         \textcolor{comment}{// and to each proc on a walker.    }}
\DoxyCodeLine{177         std::vector<double> cvals(n*nwalkers, 0);}
\DoxyCodeLine{178 }
\DoxyCodeLine{179         \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSSAGES_1_1EventListener_af9666daacfb047c1dd279ea339524d07}{IsMasterRank}}(\mbox{\hyperlink{classSSAGES_1_1Method_a1118666d61dbf3bc7606e3b61aa3a460}{comm\_}}))}
\DoxyCodeLine{180         \{}
\DoxyCodeLine{181             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0, j = \mbox{\hyperlink{classSSAGES_1_1EventListener_affe4b9179e312192ba364d44f0638874}{GetWalkerID}}(\mbox{\hyperlink{classSSAGES_1_1Method_a8471b11097a1018a9635bc578bf22f61}{world\_}},\mbox{\hyperlink{classSSAGES_1_1Method_a1118666d61dbf3bc7606e3b61aa3a460}{comm\_}})*n; i < n; ++i,++j)}
\DoxyCodeLine{182                 cvals[j] = cvs[i]-\/>GetValue();}
\DoxyCodeLine{183         \}}
\DoxyCodeLine{184 }
\DoxyCodeLine{185         \textcolor{comment}{// Reduce across all processors and add hills.}}
\DoxyCodeLine{186         MPI\_Allreduce(MPI\_IN\_PLACE, cvals.data(), n*nwalkers, MPI\_DOUBLE, MPI\_SUM, \mbox{\hyperlink{classSSAGES_1_1Method_a8471b11097a1018a9635bc578bf22f61}{world\_}});}
\DoxyCodeLine{187         }
\DoxyCodeLine{188         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n*nwalkers; i += n)}
\DoxyCodeLine{189         \{}
\DoxyCodeLine{190             std::vector<double> cval(cvals.begin() + i, cvals.begin() + i + n);}
\DoxyCodeLine{191             \mbox{\hyperlink{classSSAGES_1_1Meta_a83a72749ecba4e0c248a191566689d63}{hills\_}}.emplace\_back(cval, \mbox{\hyperlink{classSSAGES_1_1Meta_aad9cf755f8fd35f3d7fed60b981c1497}{widths\_}}, \mbox{\hyperlink{classSSAGES_1_1Meta_adfad422c777be811ccb5a47729992a4e}{height\_}});}
\DoxyCodeLine{192             }
\DoxyCodeLine{193             \textcolor{comment}{// Write hill to file.}}
\DoxyCodeLine{194             \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSSAGES_1_1EventListener_af9666daacfb047c1dd279ea339524d07}{IsMasterRank}}(\mbox{\hyperlink{classSSAGES_1_1Method_a8471b11097a1018a9635bc578bf22f61}{world\_}}))}
\DoxyCodeLine{195                 \mbox{\hyperlink{classSSAGES_1_1Meta_ad5a8f790fa4281d53ef6a0790de22192}{PrintHill}}(\mbox{\hyperlink{classSSAGES_1_1Meta_a83a72749ecba4e0c248a191566689d63}{hills\_}}.back(), iteration);}
\DoxyCodeLine{196         \}}
\DoxyCodeLine{197 }
\DoxyCodeLine{198         \textcolor{comment}{// If grid is defined, add bias onto grid. }}
\DoxyCodeLine{199         \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\_}} != \textcolor{keyword}{nullptr})}
\DoxyCodeLine{200         \{}
\DoxyCodeLine{201             std::vector<double> dx(n, 0.0), df(n, 1.0);}
\DoxyCodeLine{202             \textcolor{keyword}{auto}\& hill = \mbox{\hyperlink{classSSAGES_1_1Meta_a83a72749ecba4e0c248a191566689d63}{hills\_}}.back();}
\DoxyCodeLine{203             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto} it = \mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1Grid_a709374b3cadf320347604077a2e45e5b}{begin}}(); it != \mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1Grid_ac4fcc9f0cd61476ce4fd880c768d9694}{end}}(); ++it)}
\DoxyCodeLine{204             \{}
\DoxyCodeLine{205                 \textcolor{keyword}{auto}\& val = *it;}
\DoxyCodeLine{206                 \textcolor{keyword}{auto} coord = it.coordinates();}
\DoxyCodeLine{207 }
\DoxyCodeLine{208                 \textcolor{comment}{// Compute difference between grid point and current val. }}
\DoxyCodeLine{209                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n; ++i)}
\DoxyCodeLine{210                 \{}
\DoxyCodeLine{211                     dx[i] = -\/cvs[i]-\/>GetDifference(coord[i]);}
\DoxyCodeLine{212                     df[i] = 1.;}
\DoxyCodeLine{213                 \}}
\DoxyCodeLine{214 }
\DoxyCodeLine{215                 \textcolor{comment}{// Compute derivative.}}
\DoxyCodeLine{216                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n; ++i)}
\DoxyCodeLine{217                 \{}
\DoxyCodeLine{218                     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} j = 0; j < n; ++j)}
\DoxyCodeLine{219                     \{}
\DoxyCodeLine{220                         \textcolor{keywordflow}{if}(j != i) }
\DoxyCodeLine{221                             df[i] *= \mbox{\hyperlink{namespaceSSAGES_a9bb4c0d6df4a5148519c0c72ccba45a2}{gaussian}}(dx[j], hill.width[j]);}
\DoxyCodeLine{222                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{223                             df[i] *= \mbox{\hyperlink{namespaceSSAGES_a5f352371649672a16fac4c194b31625e}{gaussianDerv}}(dx[j], hill.width[j]);}
\DoxyCodeLine{224                     \}}
\DoxyCodeLine{225                 \}}
\DoxyCodeLine{226 }
\DoxyCodeLine{227                 \textcolor{comment}{// Add to grid. }}
\DoxyCodeLine{228                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n; ++i)}
\DoxyCodeLine{229                     val[i] += \mbox{\hyperlink{classSSAGES_1_1Meta_adfad422c777be811ccb5a47729992a4e}{height\_}}*df[i];}
\DoxyCodeLine{230             \}}
\DoxyCodeLine{231         \}}
\DoxyCodeLine{232     \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::gaussian(), and S\+S\+A\+G\+E\+S\+::gaussian\+Derv().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1Meta_afc8e23308641672a8e0363e2d40b19c2_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1Meta_a51bd46425cf7d5aad4205ea17e2ac3e9}\label{classSSAGES_1_1Meta_a51bd46425cf7d5aad4205ea17e2ac3e9}} 
\index{SSAGES::Meta@{SSAGES::Meta}!Build@{Build}}
\index{Build@{Build}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{Build()}{Build()}}
{\footnotesize\ttfamily \mbox{\hyperlink{classSSAGES_1_1Meta}{Meta}} $\ast$ S\+S\+A\+G\+E\+S\+::\+Meta\+::\+Build (\begin{DoxyParamCaption}\item[{const Json\+::\+Value \&}]{json,  }\item[{const M\+P\+I\+\_\+\+Comm \&}]{world,  }\item[{const M\+P\+I\+\_\+\+Comm \&}]{comm,  }\item[{const std\+::string \&}]{path }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Build a derived method from \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node. 


\begin{DoxyParams}{Parameters}
{\em json} & \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} Value containing all input information. \\
\hline
{\em world} & M\+PI global communicator. \\
\hline
{\em comm} & M\+PI local communicator. \\
\hline
{\em path} & Path for \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} path specification. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the \mbox{\hyperlink{classSSAGES_1_1Method}{Method}} built. nullptr if an unknown error occurred.
\end{DoxyReturn}
This function builds a registered method from a \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node. The difference between this function and \char`\"{}\+Build\char`\"{} is that this automatically determines the appropriate derived type based on the \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node information.

\begin{DoxyNote}{Note}
Object lifetime is the caller\textquotesingle{}s responsibility. 
\end{DoxyNote}


Definition at line 332 of file Meta.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{336     \{}
\DoxyCodeLine{337         \mbox{\hyperlink{classJson_1_1ObjectRequirement}{ObjectRequirement}} validator;}
\DoxyCodeLine{338         Value schema;}
\DoxyCodeLine{339         CharReaderBuilder rbuilder;}
\DoxyCodeLine{340         CharReader* reader = rbuilder.newCharReader();}
\DoxyCodeLine{341 }
\DoxyCodeLine{342         reader-\/>parse(JsonSchema::MetadynamicsMethod.c\_str(),}
\DoxyCodeLine{343                       JsonSchema::MetadynamicsMethod.c\_str() + JsonSchema::MetadynamicsMethod.size(),}
\DoxyCodeLine{344                       \&schema, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{345         validator.\mbox{\hyperlink{classJson_1_1ObjectRequirement_a4ed02ae1d612a5efba1688fcdd2df092}{Parse}}(schema, path);}
\DoxyCodeLine{346 }
\DoxyCodeLine{347         \textcolor{comment}{// Validate inputs.}}
\DoxyCodeLine{348         validator.\mbox{\hyperlink{classJson_1_1ObjectRequirement_a9ac3b920001a35bc70580035d8d802b7}{Validate}}(json, path);}
\DoxyCodeLine{349         \textcolor{keywordflow}{if}(validator.\mbox{\hyperlink{classJson_1_1Requirement_adfaec336a9f051d6f6b9a6d7f1d97b75}{HasErrors}}())}
\DoxyCodeLine{350             \textcolor{keywordflow}{throw} BuildException(validator.\mbox{\hyperlink{classJson_1_1Requirement_a60bc275c366eb59f192fa2e621268480}{GetErrors}}());}
\DoxyCodeLine{351 }
\DoxyCodeLine{352         std::vector<double> widths;}
\DoxyCodeLine{353         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& s : json[\textcolor{stringliteral}{"widths"}])}
\DoxyCodeLine{354             widths.push\_back(s.asDouble());}
\DoxyCodeLine{355 }
\DoxyCodeLine{356         std::vector<double> lowerb, upperb, lowerk, upperk;}
\DoxyCodeLine{357         Grid<Vector>* grid = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{358         \textcolor{keywordflow}{if}(json.isMember(\textcolor{stringliteral}{"grid"}))}
\DoxyCodeLine{359             grid = \mbox{\hyperlink{classSSAGES_1_1Grid_a24d2373042debae156618906637e819c}{Grid<Vector>::BuildGrid}}(json.get(\textcolor{stringliteral}{"grid"}, Json::Value()));}
\DoxyCodeLine{360         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(!json.isMember(\textcolor{stringliteral}{"lower\_bounds"}) || !json.isMember(\textcolor{stringliteral}{"upper\_bounds"}))}
\DoxyCodeLine{361             \textcolor{keywordflow}{throw} BuildException(\{}
\DoxyCodeLine{362                 \textcolor{stringliteral}{"\#/Method/Metadynamics: Both upper\_bounds and lower\_bounds "}}
\DoxyCodeLine{363                 \textcolor{stringliteral}{"must be defined if grid is not being used."}\});}
\DoxyCodeLine{364 }
\DoxyCodeLine{365         \textcolor{comment}{// Assume all vectors are the same size. }}
\DoxyCodeLine{366         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{int} i = 0; i < static\_cast<int>(json[\textcolor{stringliteral}{"lower\_bound\_restraints"}].size()); ++i)}
\DoxyCodeLine{367         \{}
\DoxyCodeLine{368             lowerk.push\_back(json[\textcolor{stringliteral}{"lower\_bound\_restraints"}][i].asDouble());}
\DoxyCodeLine{369             upperk.push\_back(json[\textcolor{stringliteral}{"upper\_bound\_restraints"}][i].asDouble());}
\DoxyCodeLine{370             lowerb.push\_back(json[\textcolor{stringliteral}{"lower\_bounds"}][i].asDouble());}
\DoxyCodeLine{371             upperb.push\_back(json[\textcolor{stringliteral}{"upper\_bounds"}][i].asDouble());}
\DoxyCodeLine{372         \}}
\DoxyCodeLine{373     }
\DoxyCodeLine{374         \textcolor{keyword}{auto} height = json.get(\textcolor{stringliteral}{"height"}, 1.0).asDouble();}
\DoxyCodeLine{375         \textcolor{keyword}{auto} hillfreq = json.get(\textcolor{stringliteral}{"hill\_frequency"}, 1).asInt();}
\DoxyCodeLine{376         \textcolor{keyword}{auto} freq = json.get(\textcolor{stringliteral}{"frequency"}, 1).asInt();}
\DoxyCodeLine{377 }
\DoxyCodeLine{378         \textcolor{keyword}{auto}* m = \textcolor{keyword}{new} \mbox{\hyperlink{classSSAGES_1_1Meta_a3a8bf5758a11025cd76aea99895cc855}{Meta}}(}
\DoxyCodeLine{379             world, comm, height, widths, }
\DoxyCodeLine{380             lowerb, upperb, lowerk, upperk,}
\DoxyCodeLine{381             grid, hillfreq, freq}
\DoxyCodeLine{382         );}
\DoxyCodeLine{383 }
\DoxyCodeLine{384         \textcolor{keywordflow}{if}(json.isMember(\textcolor{stringliteral}{"load\_hills"}))}
\DoxyCodeLine{385             m-\/>LoadHills(json[\textcolor{stringliteral}{"load\_hills"}].asString());}
\DoxyCodeLine{386 }
\DoxyCodeLine{387         \textcolor{keywordflow}{return} m;       }
\DoxyCodeLine{388     \}}

\end{DoxyCode}


References Json\+::\+Requirement\+::\+Get\+Errors(), Json\+::\+Requirement\+::\+Has\+Errors(), Json\+::\+Object\+Requirement\+::\+Parse(), and Json\+::\+Object\+Requirement\+::\+Validate().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1Meta_a51bd46425cf7d5aad4205ea17e2ac3e9_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1Meta_a9cd073ee3c04a98e5131e96ffcb11df8}\label{classSSAGES_1_1Meta_a9cd073ee3c04a98e5131e96ffcb11df8}} 
\index{SSAGES::Meta@{SSAGES::Meta}!CalcBiasForce@{CalcBiasForce}}
\index{CalcBiasForce@{CalcBiasForce}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{CalcBiasForce()}{CalcBiasForce()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Meta\+::\+Calc\+Bias\+Force (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespaceSSAGES_acddea47426ac0a643b048f870ddd2907}{C\+V\+List}} \&}]{cvs }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Computes the bias force. 


\begin{DoxyParams}{Parameters}
{\em cvs} & List of C\+Vs. \\
\hline
\end{DoxyParams}


Definition at line 253 of file Meta.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{254     \{   }
\DoxyCodeLine{255         \textcolor{comment}{// Reset bias and derivatives.}}
\DoxyCodeLine{256         \textcolor{keywordtype}{double} bias = 0.;}
\DoxyCodeLine{257         \textcolor{keyword}{auto} n = cvs.size();}
\DoxyCodeLine{258 }
\DoxyCodeLine{259         \textcolor{comment}{// Reset vectors.}}
\DoxyCodeLine{260         std::fill(\mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\_}}.begin(), \mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\_}}.end(), 0);}
\DoxyCodeLine{261         }
\DoxyCodeLine{262         \textcolor{comment}{// Look up and apply grid bias. }}
\DoxyCodeLine{263         \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\_}} != \textcolor{keyword}{nullptr})}
\DoxyCodeLine{264         \{}
\DoxyCodeLine{265             \textcolor{keywordtype}{bool} inbounds = \textcolor{keyword}{true};}
\DoxyCodeLine{266             std::vector<double> val(n, 0.);}
\DoxyCodeLine{267             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n; ++i)}
\DoxyCodeLine{268             \{}
\DoxyCodeLine{269                 val[i] = cvs[i]-\/>GetValue();}
\DoxyCodeLine{270                 \textcolor{keywordflow}{if}(val[i] < \mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a2270a9233a9dc2d341e8ab88ce6655c9}{GetLower}}(i) || val[i]  > \mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1GridBase_a875feace8fff4743b103147c4193eca0}{GetUpper}}(i))}
\DoxyCodeLine{271                     inbounds = \textcolor{keyword}{false};}
\DoxyCodeLine{272             \}}
\DoxyCodeLine{273 }
\DoxyCodeLine{274             \textcolor{keywordflow}{if}(inbounds)}
\DoxyCodeLine{275             \{}
\DoxyCodeLine{276                 \textcolor{keyword}{auto} frc = (*grid\_)[val];}
\DoxyCodeLine{277                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n; ++i)}
\DoxyCodeLine{278                     \mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\_}}[i] = frc[i];}
\DoxyCodeLine{279             \}}
\DoxyCodeLine{280             \textcolor{keywordflow}{else}}
\DoxyCodeLine{281             \{}
\DoxyCodeLine{282                 \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSSAGES_1_1EventListener_af9666daacfb047c1dd279ea339524d07}{IsMasterRank}}(\mbox{\hyperlink{classSSAGES_1_1Method_a1118666d61dbf3bc7606e3b61aa3a460}{comm\_}}))}
\DoxyCodeLine{283                 \{}
\DoxyCodeLine{284                     std::cerr << \textcolor{stringliteral}{"Metadynamics: out of bounds ( "};}
\DoxyCodeLine{285                     \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& v : val)}
\DoxyCodeLine{286                         std::cerr << v << \textcolor{stringliteral}{" "}; }
\DoxyCodeLine{287                     std::cerr << \textcolor{stringliteral}{")"} << std::endl;}
\DoxyCodeLine{288                 \}}
\DoxyCodeLine{289             \}}
\DoxyCodeLine{290         \}}
\DoxyCodeLine{291         \textcolor{keywordflow}{else}}
\DoxyCodeLine{292         \{}
\DoxyCodeLine{293             \textcolor{comment}{// Loop through hills and calculate the bias force.}}
\DoxyCodeLine{294             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& hill : \mbox{\hyperlink{classSSAGES_1_1Meta_a83a72749ecba4e0c248a191566689d63}{hills\_}})}
\DoxyCodeLine{295             \{       }
\DoxyCodeLine{296                 \textcolor{keyword}{auto} tbias = 1.;}
\DoxyCodeLine{297                 std::fill(tder\_.begin(), tder\_.end(), 1.0);}
\DoxyCodeLine{298                 std::fill(dx\_.begin(), dx\_.end(), 1.0);}
\DoxyCodeLine{299                 }
\DoxyCodeLine{300                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n; ++i)}
\DoxyCodeLine{301                 \{}
\DoxyCodeLine{302                     dx\_[i] = cvs[i]-\/>GetDifference(hill.center[i]);}
\DoxyCodeLine{303                     tbias *= \mbox{\hyperlink{namespaceSSAGES_a9bb4c0d6df4a5148519c0c72ccba45a2}{gaussian}}(dx\_[i], hill.width[i]);}
\DoxyCodeLine{304                 \}}
\DoxyCodeLine{305 }
\DoxyCodeLine{306                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n; ++i)}
\DoxyCodeLine{307                     \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} j = 0; j < n; ++j)}
\DoxyCodeLine{308                     \{}
\DoxyCodeLine{309                         \textcolor{keywordflow}{if}(j != i) }
\DoxyCodeLine{310                             tder\_[i] *= \mbox{\hyperlink{namespaceSSAGES_a9bb4c0d6df4a5148519c0c72ccba45a2}{gaussian}}(dx\_[j], hill.width[j]);}
\DoxyCodeLine{311                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{312                             tder\_[i] *= \mbox{\hyperlink{namespaceSSAGES_a5f352371649672a16fac4c194b31625e}{gaussianDerv}}(dx\_[j], hill.width[j]);}
\DoxyCodeLine{313                     \}}
\DoxyCodeLine{314 }
\DoxyCodeLine{315                 bias += \mbox{\hyperlink{classSSAGES_1_1Meta_adfad422c777be811ccb5a47729992a4e}{height\_}} * tbias;}
\DoxyCodeLine{316                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n; ++i)}
\DoxyCodeLine{317                     \mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\_}}[i] += \mbox{\hyperlink{classSSAGES_1_1Meta_adfad422c777be811ccb5a47729992a4e}{height\_}}*tder\_[i];}
\DoxyCodeLine{318             \}}
\DoxyCodeLine{319         \}}
\DoxyCodeLine{320 }
\DoxyCodeLine{321         \textcolor{comment}{// Restraints.}}
\DoxyCodeLine{322         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n; ++i)}
\DoxyCodeLine{323         \{}
\DoxyCodeLine{324             \textcolor{keyword}{auto} cval = cvs[i]-\/>GetValue();}
\DoxyCodeLine{325             \textcolor{keywordflow}{if}(cval < lowerb\_[i])}
\DoxyCodeLine{326                 \mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\_}}[i] += lowerk\_[i]*(cval -\/ lowerb\_[i]);}
\DoxyCodeLine{327             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(cval > \mbox{\hyperlink{classSSAGES_1_1Meta_a3f6d45e420b5795563de6f891908e807}{upperb\_}}[i])}
\DoxyCodeLine{328                 \mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\_}}[i] += \mbox{\hyperlink{classSSAGES_1_1Meta_a33e2f67c058c3178af21631fe9777b4e}{upperk\_}}[i]*(cval -\/ \mbox{\hyperlink{classSSAGES_1_1Meta_a3f6d45e420b5795563de6f891908e807}{upperb\_}}[i]);}
\DoxyCodeLine{329         \}}
\DoxyCodeLine{330     \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::gaussian(), and S\+S\+A\+G\+E\+S\+::gaussian\+Derv().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1Meta_a9cd073ee3c04a98e5131e96ffcb11df8_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1Meta_a9c53debbdcc91a5a5f54958dd67ae51f}\label{classSSAGES_1_1Meta_a9c53debbdcc91a5a5f54958dd67ae51f}} 
\index{SSAGES::Meta@{SSAGES::Meta}!LoadHills@{LoadHills}}
\index{LoadHills@{LoadHills}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{LoadHills()}{LoadHills()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Meta\+::\+Load\+Hills (\begin{DoxyParamCaption}\item[{const std\+::string \&}]{filename }\end{DoxyParamCaption})}



Load hills from file. 


\begin{DoxyParams}{Parameters}
{\em filename} & File name containing hills.\\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
File format must match the output written by this method and the dimensionality of the hills must match the initialized \mbox{\hyperlink{classSSAGES_1_1Meta}{Meta}} class. 
\end{DoxyNote}


Definition at line 136 of file Meta.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{137     \{}
\DoxyCodeLine{138         std::ifstream file(filename);}
\DoxyCodeLine{139         std::string line; }
\DoxyCodeLine{140 }
\DoxyCodeLine{141         \textcolor{keyword}{auto} dim = \mbox{\hyperlink{classSSAGES_1_1Meta_aad9cf755f8fd35f3d7fed60b981c1497}{widths\_}}.size();}
\DoxyCodeLine{142         \textcolor{keywordtype}{double} iteration = 0, height = 0;}
\DoxyCodeLine{143         std::vector<double> width(dim, 0.), center(dim, 0);}
\DoxyCodeLine{144 }
\DoxyCodeLine{145         \textcolor{comment}{// First line is a comment. }}
\DoxyCodeLine{146         std::getline(file, line);}
\DoxyCodeLine{147         \textcolor{keywordflow}{while}(std::getline(file, line))}
\DoxyCodeLine{148         \{}
\DoxyCodeLine{149             std::istringstream iss(line);}
\DoxyCodeLine{150             iss >> iteration; \textcolor{comment}{// Not really using this. }}
\DoxyCodeLine{151             }
\DoxyCodeLine{152             \textcolor{comment}{// Load centers.}}
\DoxyCodeLine{153             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < dim; ++i)}
\DoxyCodeLine{154                 iss >> center[i];}
\DoxyCodeLine{155             }
\DoxyCodeLine{156             \textcolor{comment}{// Load widths.}}
\DoxyCodeLine{157             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < dim; ++i)}
\DoxyCodeLine{158                 iss >> width[i];}
\DoxyCodeLine{159             }
\DoxyCodeLine{160             \textcolor{comment}{// Load height. }}
\DoxyCodeLine{161             iss >> height;}
\DoxyCodeLine{162 }
\DoxyCodeLine{163             \mbox{\hyperlink{classSSAGES_1_1Meta_a83a72749ecba4e0c248a191566689d63}{hills\_}}.emplace\_back(center, width, height);}
\DoxyCodeLine{164         \}}
\DoxyCodeLine{165     \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSSAGES_1_1Meta_a352edd1cebb4731d7b2e260fbb96d3bc}\label{classSSAGES_1_1Meta_a352edd1cebb4731d7b2e260fbb96d3bc}} 
\index{SSAGES::Meta@{SSAGES::Meta}!PostIntegration@{PostIntegration}}
\index{PostIntegration@{PostIntegration}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{PostIntegration()}{PostIntegration()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Meta\+::\+Post\+Integration (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$}]{snapshot,  }\item[{const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&}]{cvmanager }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



\mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call post integration. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Pointer to the simulation snapshot. \\
\hline
{\em cvmanager} & Collective variable manager.\\
\hline
\end{DoxyParams}
This function will be called after each integration step. 

Implements \mbox{\hyperlink{classSSAGES_1_1Method_af2f33dfaa758c5cd505477f4767fb339}{S\+S\+A\+G\+E\+S\+::\+Method}}.



Definition at line 100 of file Meta.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{101     \{}
\DoxyCodeLine{102         \textcolor{keyword}{auto} cvs = cvmanager.GetCVs(\mbox{\hyperlink{classSSAGES_1_1Method_a24b0ac53b1fabcab0a5f3bd6cde26909}{cvmask\_}});}
\DoxyCodeLine{103         \textcolor{comment}{// Add hills when needed.}}
\DoxyCodeLine{104         \textcolor{keywordflow}{if}(snapshot-\/>GetIteration() \% \mbox{\hyperlink{classSSAGES_1_1Meta_a588f0dfffb71410b59caf12b7ad0cc50}{hillfreq\_}} == 0)}
\DoxyCodeLine{105             \mbox{\hyperlink{classSSAGES_1_1Meta_afc8e23308641672a8e0363e2d40b19c2}{AddHill}}(cvs, snapshot-\/>GetIteration());}
\DoxyCodeLine{106 }
\DoxyCodeLine{107         \textcolor{comment}{// Always calculate the current bias.}}
\DoxyCodeLine{108         \mbox{\hyperlink{classSSAGES_1_1Meta_a9cd073ee3c04a98e5131e96ffcb11df8}{CalcBiasForce}}(cvs);}
\DoxyCodeLine{109 }
\DoxyCodeLine{110         \textcolor{comment}{// Take each CV and add its biased forces to the atoms}}
\DoxyCodeLine{111         \textcolor{comment}{// using the chain rule.}}
\DoxyCodeLine{112         \textcolor{keyword}{auto}\& forces = snapshot-\/>GetForces();}
\DoxyCodeLine{113         \textcolor{keyword}{auto}\& virial = snapshot-\/>GetVirial();}
\DoxyCodeLine{114 }
\DoxyCodeLine{115         \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < cvs.size(); ++i)}
\DoxyCodeLine{116         \{}
\DoxyCodeLine{117             \textcolor{keyword}{auto}\& grad = cvs[i]-\/>GetGradient();}
\DoxyCodeLine{118             \textcolor{keyword}{auto}\& boxgrad = cvs[i]-\/>GetBoxGradient();}
\DoxyCodeLine{119             }
\DoxyCodeLine{120             \textcolor{comment}{// Update the forces in snapshot by adding in the force bias from each}}
\DoxyCodeLine{121             \textcolor{comment}{// CV to each atom based on the gradient of the CV.}}
\DoxyCodeLine{122             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} j = 0; j < forces.size(); ++j)}
\DoxyCodeLine{123                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} k = 0; k < 3; ++k)}
\DoxyCodeLine{124                     forces[j][k] -\/= \mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\_}}[i]*grad[j][k];}
\DoxyCodeLine{125             }
\DoxyCodeLine{126             virial += \mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\_}}[i]*boxgrad;}
\DoxyCodeLine{127         \}}
\DoxyCodeLine{128     \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+C\+V\+Manager\+::\+Get\+C\+Vs(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Forces(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Iteration(), and S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Virial().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1Meta_a352edd1cebb4731d7b2e260fbb96d3bc_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1Meta_a218346ad51e6991576baffde2e82f0e0}\label{classSSAGES_1_1Meta_a218346ad51e6991576baffde2e82f0e0}} 
\index{SSAGES::Meta@{SSAGES::Meta}!PostSimulation@{PostSimulation}}
\index{PostSimulation@{PostSimulation}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{PostSimulation()}{PostSimulation()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Meta\+::\+Post\+Simulation (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$}]{snapshot,  }\item[{const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&}]{cvmanager }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



\mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call post simulation. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Pointer to the simulation snapshot. \\
\hline
{\em cvmanager} & Collective variable manager.\\
\hline
\end{DoxyParams}
This function will be called after the end of the simulation run. 

Implements \mbox{\hyperlink{classSSAGES_1_1Method_a7d18226669c88bc76b9b758f2d29e3c9}{S\+S\+A\+G\+E\+S\+::\+Method}}.



Definition at line 131 of file Meta.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{132     \{}
\DoxyCodeLine{133     \}}

\end{DoxyCode}
\mbox{\Hypertarget{classSSAGES_1_1Meta_a9a584ea39168a9fd57f5f7cf98102480}\label{classSSAGES_1_1Meta_a9a584ea39168a9fd57f5f7cf98102480}} 
\index{SSAGES::Meta@{SSAGES::Meta}!PreSimulation@{PreSimulation}}
\index{PreSimulation@{PreSimulation}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{PreSimulation()}{PreSimulation()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Meta\+::\+Pre\+Simulation (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} $\ast$}]{snapshot,  }\item[{const class \mbox{\hyperlink{classSSAGES_1_1CVManager}{C\+V\+Manager}} \&}]{cvmanager }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [override]}, {\ttfamily [virtual]}}



\mbox{\hyperlink{classSSAGES_1_1Method}{Method}} call prior to simulation initiation. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Pointer to the simulation snapshot. \\
\hline
{\em cvmanager} & Collective variable manager.\\
\hline
\end{DoxyParams}
This function will be called before the simulation is started. 

Implements \mbox{\hyperlink{classSSAGES_1_1Method_a7d840d2b5f6dbf9ec75a7909ccf13ef7}{S\+S\+A\+G\+E\+S\+::\+Method}}.



Definition at line 62 of file Meta.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{63     \{}
\DoxyCodeLine{64         \textcolor{keyword}{auto} cvs = cvmanager.GetCVs(\mbox{\hyperlink{classSSAGES_1_1Method_a24b0ac53b1fabcab0a5f3bd6cde26909}{cvmask\_}});}
\DoxyCodeLine{65         \textcolor{comment}{// Write ouput file header.}}
\DoxyCodeLine{66         \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSSAGES_1_1EventListener_af9666daacfb047c1dd279ea339524d07}{IsMasterRank}}(\mbox{\hyperlink{classSSAGES_1_1Method_a8471b11097a1018a9635bc578bf22f61}{world\_}}))}
\DoxyCodeLine{67         \{}
\DoxyCodeLine{68             \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}}.open(\textcolor{stringliteral}{"hills.out"});}
\DoxyCodeLine{69             \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}} << \textcolor{stringliteral}{"\#Iteration "}; }
\DoxyCodeLine{70 }
\DoxyCodeLine{71             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < cvs.size(); ++i)}
\DoxyCodeLine{72                 \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}} << \textcolor{stringliteral}{"center."} << i << \textcolor{stringliteral}{" "};}
\DoxyCodeLine{73     }
\DoxyCodeLine{74             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < cvs.size(); ++i)}
\DoxyCodeLine{75                 \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}} << \textcolor{stringliteral}{"sigma."} << i << \textcolor{stringliteral}{" "};}
\DoxyCodeLine{76             }
\DoxyCodeLine{77             \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}} << \textcolor{stringliteral}{"height"} << std::endl;}
\DoxyCodeLine{78                 }
\DoxyCodeLine{79             \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}}.close();}
\DoxyCodeLine{80         \}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         \textcolor{comment}{// Initialize grid to zero. }}
\DoxyCodeLine{83         \textcolor{keywordflow}{if}(\mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\_}} != \textcolor{keyword}{nullptr})}
\DoxyCodeLine{84         \{}
\DoxyCodeLine{85             \mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} vec = Vector::Zero(cvs.size());}
\DoxyCodeLine{86             std::fill(\mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1Grid_a709374b3cadf320347604077a2e45e5b}{begin}}(), \mbox{\hyperlink{classSSAGES_1_1Meta_aa6dfcaf45887ff30bfe28c65055a0494}{grid\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1Grid_ac4fcc9f0cd61476ce4fd880c768d9694}{end}}(), vec);}
\DoxyCodeLine{87         \} }
\DoxyCodeLine{88 }
\DoxyCodeLine{89         \textcolor{keyword}{auto} n = snapshot-\/>GetTargetIterations();}
\DoxyCodeLine{90         n = n ? n : 1e5; \textcolor{comment}{// Pre-\/allocate at least something.}}
\DoxyCodeLine{91     }
\DoxyCodeLine{92         \mbox{\hyperlink{classSSAGES_1_1Meta_a83a72749ecba4e0c248a191566689d63}{hills\_}}.reserve(n+1);}
\DoxyCodeLine{93         \mbox{\hyperlink{classSSAGES_1_1Meta_aad9cf755f8fd35f3d7fed60b981c1497}{widths\_}}.reserve(n+1);}
\DoxyCodeLine{94         \mbox{\hyperlink{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}{derivatives\_}}.resize(cvs.size());}
\DoxyCodeLine{95         tder\_.resize(cvs.size());}
\DoxyCodeLine{96         dx\_.resize(cvs.size());}
\DoxyCodeLine{97     \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+C\+V\+Manager\+::\+Get\+C\+Vs(), and S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Target\+Iterations().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1Meta_a9a584ea39168a9fd57f5f7cf98102480_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1Meta_ad5a8f790fa4281d53ef6a0790de22192}\label{classSSAGES_1_1Meta_ad5a8f790fa4281d53ef6a0790de22192}} 
\index{SSAGES::Meta@{SSAGES::Meta}!PrintHill@{PrintHill}}
\index{PrintHill@{PrintHill}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{PrintHill()}{PrintHill()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Meta\+::\+Print\+Hill (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structSSAGES_1_1Hill}{Hill}} \&}]{hill,  }\item[{int}]{iteration }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [private]}}



Prints the new hill to file. 


\begin{DoxyParams}{Parameters}
{\em hill} & \mbox{\hyperlink{structSSAGES_1_1Hill}{Hill}} to be printed. \\
\hline
{\em iteration} & Current iteration. \\
\hline
\end{DoxyParams}


Definition at line 236 of file Meta.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{237     \{}
\DoxyCodeLine{238         \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}}.open(\textcolor{stringliteral}{"hills.out"}, std::fstream::app);}
\DoxyCodeLine{239         }
\DoxyCodeLine{240         \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}} << iteration << \textcolor{stringliteral}{" "};}
\DoxyCodeLine{241         \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}}.precision(8);}
\DoxyCodeLine{242         }
\DoxyCodeLine{243         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& cv : hill.center)}
\DoxyCodeLine{244             \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}} << cv << \textcolor{stringliteral}{" "};}
\DoxyCodeLine{245         }
\DoxyCodeLine{246         \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& w : hill.width)}
\DoxyCodeLine{247             \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}} << w << \textcolor{stringliteral}{" "};}
\DoxyCodeLine{248 }
\DoxyCodeLine{249         \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}} << \mbox{\hyperlink{classSSAGES_1_1Meta_adfad422c777be811ccb5a47729992a4e}{height\_}} << std::endl;}
\DoxyCodeLine{250         \mbox{\hyperlink{classSSAGES_1_1Meta_ac2f065cf13305f71d5e86e78b9a4854b}{hillsout\_}}.close();}
\DoxyCodeLine{251     \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+Hill\+::center, and S\+S\+A\+G\+E\+S\+::\+Hill\+::width.



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}\label{classSSAGES_1_1Meta_a96930633275f22009adb899c9f39d635}} 
\index{SSAGES::Meta@{SSAGES::Meta}!derivatives\_@{derivatives\_}}
\index{derivatives\_@{derivatives\_}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{derivatives\_}{derivatives\_}}
{\footnotesize\ttfamily std\+::vector$<$double$>$ S\+S\+A\+G\+E\+S\+::\+Meta\+::derivatives\+\_\+\hspace{0.3cm}{\ttfamily [private]}}

Derivatives and temporary storage vectors. 

Definition at line 82 of file Meta.\+h.

\mbox{\Hypertarget{classSSAGES_1_1Meta_a3f6d45e420b5795563de6f891908e807}\label{classSSAGES_1_1Meta_a3f6d45e420b5795563de6f891908e807}} 
\index{SSAGES::Meta@{SSAGES::Meta}!upperb\_@{upperb\_}}
\index{upperb\_@{upperb\_}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{upperb\_}{upperb\_}}
{\footnotesize\ttfamily std\+::vector$<$double$>$ S\+S\+A\+G\+E\+S\+::\+Meta\+::upperb\+\_\+\hspace{0.3cm}{\ttfamily [private]}}

Bounds ~\newline
 

Definition at line 93 of file Meta.\+h.

\mbox{\Hypertarget{classSSAGES_1_1Meta_a33e2f67c058c3178af21631fe9777b4e}\label{classSSAGES_1_1Meta_a33e2f67c058c3178af21631fe9777b4e}} 
\index{SSAGES::Meta@{SSAGES::Meta}!upperk\_@{upperk\_}}
\index{upperk\_@{upperk\_}!SSAGES::Meta@{SSAGES::Meta}}
\doxysubsubsection{\texorpdfstring{upperk\_}{upperk\_}}
{\footnotesize\ttfamily std\+::vector$<$double$>$ S\+S\+A\+G\+E\+S\+::\+Meta\+::upperk\+\_\+\hspace{0.3cm}{\ttfamily [private]}}

Bound restraints. ~\newline
 

Definition at line 98 of file Meta.\+h.



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
/home/michael/development/\+S\+S\+A\+G\+E\+S/src/\+Methods/Meta.\+h\item 
/home/michael/development/\+S\+S\+A\+G\+E\+S/src/\+Methods/Meta.\+cpp\end{DoxyCompactItemize}
