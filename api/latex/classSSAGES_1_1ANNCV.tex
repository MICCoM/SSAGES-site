\hypertarget{classSSAGES_1_1ANNCV}{}\doxysection{S\+S\+A\+G\+ES\+::A\+N\+N\+CV Class Reference}
\label{classSSAGES_1_1ANNCV}\index{SSAGES::ANNCV@{SSAGES::ANNCV}}


\mbox{\hyperlink{classSSAGES_1_1ANN}{A\+NN}} (artifical neural network) collective variables.  




{\ttfamily \#include $<$A\+N\+N\+C\+V.\+h$>$}



Inheritance diagram for S\+S\+A\+G\+ES\+::A\+N\+N\+CV\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=223pt]{classSSAGES_1_1ANNCV__inherit__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classSSAGES_1_1ANNCV_ac2a9803e346a8da16cc785becaa3b291}{A\+N\+N\+CV}} (\mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}} atomids, double scaling\+\_\+factor, std\+::vector$<$ int $>$ num\+\_\+nodes, std\+::string coeff\+\_\+file, std\+::vector$<$ std\+::string $>$ activations, int out\+\_\+index)
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1ANNCV_a0a00620dd01926d57136d1c28420a7d4}{Initialize}} (const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&snapshot) override
\begin{DoxyCompactList}\small\item\em Initialize necessary variables. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_a636e7bfca865525ab39d25d6ad43d5b9}\label{classSSAGES_1_1ANNCV_a636e7bfca865525ab39d25d6ad43d5b9}} 
std\+::vector$<$ \mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} $>$ {\bfseries forward\+\_\+prop} (\mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} \&input\+\_\+vec)
\item 
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_a6acad091a204a93d04d606be055dc903}\label{classSSAGES_1_1ANNCV_a6acad091a204a93d04d606be055dc903}} 
std\+::vector$<$ \mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} $>$ {\bfseries back\+\_\+prop} (std\+::vector$<$ \mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} $>$ \&output\+\_\+of\+\_\+layers)
\item 
void \mbox{\hyperlink{classSSAGES_1_1ANNCV_a1ddb11f32dbf1c1c19e119310c047a0d}{Evaluate}} (const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&snapshot) override
\begin{DoxyCompactList}\small\item\em Evaluate the CV. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{classSSAGES_1_1ANNCV}{A\+N\+N\+CV}} $\ast$ \mbox{\hyperlink{classSSAGES_1_1ANNCV_a8173b4f597f6eba50295c5eeb508dec1}{Build}} (const Json\+::\+Value \&json, const std\+::string \&path)
\begin{DoxyCompactList}\small\item\em Set up collective variable. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_a5be4fdf5f54fb4d5adc6da681ec97d8f}\label{classSSAGES_1_1ANNCV_a5be4fdf5f54fb4d5adc6da681ec97d8f}} 
\mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}} {\bfseries atomids\+\_\+}
\item 
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_a2f6b2895d80e5bc08cbad2b4c52a4deb}\label{classSSAGES_1_1ANNCV_a2f6b2895d80e5bc08cbad2b4c52a4deb}} 
double {\bfseries scaling\+\_\+factor\+\_\+}
\item 
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_acc9fd314e9b64291f595c1ac8aebaf9e}\label{classSSAGES_1_1ANNCV_acc9fd314e9b64291f595c1ac8aebaf9e}} 
std\+::vector$<$ int $>$ {\bfseries num\+\_\+nodes\+\_\+}
\item 
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_aadc01629c1e519ac90fec420167ba756}\label{classSSAGES_1_1ANNCV_aadc01629c1e519ac90fec420167ba756}} 
std\+::vector$<$ Eigen\+::\+Matrix\+Xd $>$ {\bfseries weight\+\_\+coeff\+\_\+}
\item 
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_a59a3556944a40be1933cdad8a8f2f44c}\label{classSSAGES_1_1ANNCV_a59a3556944a40be1933cdad8a8f2f44c}} 
std\+::vector$<$ \mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} $>$ {\bfseries bias\+\_\+}
\item 
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_a26a58b87c7c5c60ff270bb8685ab0ad5}\label{classSSAGES_1_1ANNCV_a26a58b87c7c5c60ff270bb8685ab0ad5}} 
std\+::vector$<$ std\+::string $>$ {\bfseries activations\+\_\+}
\item 
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_af18511d2d4d3395a933ea8906f49febf}\label{classSSAGES_1_1ANNCV_af18511d2d4d3395a933ea8906f49febf}} 
int {\bfseries out\+\_\+index\+\_\+}
\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
\mbox{\hyperlink{classSSAGES_1_1ANN}{A\+NN}} (artifical neural network) collective variables. 

This CV takes scaled (specified by \char`\"{}scaling\+\_\+factor\char`\"{}) Cartesian coordinates of a group of atoms (specified by \char`\"{}atomids\char`\"{}) as inputs to a neural network (its number of nodes, connection weights, and activation functions are specified by \char`\"{}num\+\_\+nodes\char`\"{}, \char`\"{}coeff\+\_\+file\char`\"{}, \char`\"{}activations\char`\"{}, respectively), computes one component (specified by \char`\"{}out\+\_\+index\char`\"{}) of the final neural network outputs as the CV value. 

Definition at line 42 of file A\+N\+N\+C\+V.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_ac2a9803e346a8da16cc785becaa3b291}\label{classSSAGES_1_1ANNCV_ac2a9803e346a8da16cc785becaa3b291}} 
\index{SSAGES::ANNCV@{SSAGES::ANNCV}!ANNCV@{ANNCV}}
\index{ANNCV@{ANNCV}!SSAGES::ANNCV@{SSAGES::ANNCV}}
\doxysubsubsection{\texorpdfstring{ANNCV()}{ANNCV()}}
{\footnotesize\ttfamily S\+S\+A\+G\+E\+S\+::\+A\+N\+N\+C\+V\+::\+A\+N\+N\+CV (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}}}]{atomids,  }\item[{double}]{scaling\+\_\+factor,  }\item[{std\+::vector$<$ int $>$}]{num\+\_\+nodes,  }\item[{std\+::string}]{coeff\+\_\+file,  }\item[{std\+::vector$<$ std\+::string $>$}]{activations,  }\item[{int}]{out\+\_\+index }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Constructor. 


\begin{DoxyParams}{Parameters}
{\em atomids} & atom I\+Ds used as inputs to \mbox{\hyperlink{classSSAGES_1_1ANN}{A\+NN}} \\
\hline
{\em scaling\+\_\+factor} & scaling factor for input coordinates (input coordinates will be divided by this factor) \\
\hline
{\em num\+\_\+nodes} & numbers of nodes for each layer of \mbox{\hyperlink{classSSAGES_1_1ANN}{A\+NN}} \\
\hline
{\em coeff\+\_\+file} & file storing weights and bias of \mbox{\hyperlink{classSSAGES_1_1ANN}{A\+NN}} \\
\hline
{\em activations} & activations functions (as strings) of \mbox{\hyperlink{classSSAGES_1_1ANN}{A\+NN}} \\
\hline
{\em out\+\_\+index} & index of output component of \mbox{\hyperlink{classSSAGES_1_1ANN}{A\+NN}}\\
\hline
\end{DoxyParams}
\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000002}{Todo}}]Bounds needs to be an input and periodic boundary conditions \end{DoxyRefDesc}


Definition at line 66 of file A\+N\+N\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{73           :}
\DoxyCodeLine{74             atomids\_(atomids), scaling\_factor\_(scaling\_factor), num\_nodes\_(num\_nodes),}
\DoxyCodeLine{75             activations\_(activations), out\_index\_(out\_index)}
\DoxyCodeLine{76         \{}
\DoxyCodeLine{77             \textcolor{comment}{// read coefficients from file}}
\DoxyCodeLine{78             std::ifstream my\_f(coeff\_file);}
\DoxyCodeLine{79             std::string temp\_vec;}
\DoxyCodeLine{80             \textcolor{keywordtype}{int} layer\_index = 0;}
\DoxyCodeLine{81             \textcolor{keywordflow}{if} (num\_nodes\_[0] != atomids\_.size() * 3) \{}
\DoxyCodeLine{82                 \textcolor{keywordflow}{throw} BuildException(\{}
\DoxyCodeLine{83                     \textcolor{stringliteral}{"WARNING: input dim should be "} + std::to\_string(atomids\_.size() * 3) + \textcolor{stringliteral}{" found: "}}
\DoxyCodeLine{84                     + std::to\_string(num\_nodes\_[0])}
\DoxyCodeLine{85                 \});}
\DoxyCodeLine{86             \}}
\DoxyCodeLine{87             \textcolor{keywordflow}{while} (std::getline(my\_f, temp\_vec) )}
\DoxyCodeLine{88             \{}
\DoxyCodeLine{89                 std::istringstream ss(temp\_vec);}
\DoxyCodeLine{90                 std::string token;}
\DoxyCodeLine{91                 std::vector<double> temp\_weight, temp\_bias;}
\DoxyCodeLine{92                 \textcolor{keywordflow}{while} (std::getline(ss, token, \textcolor{charliteral}{','}))  \textcolor{comment}{// coefficients are separated by comma}}
\DoxyCodeLine{93                 \{}
\DoxyCodeLine{94                     temp\_weight.push\_back(stod(token));}
\DoxyCodeLine{95                 \}}
\DoxyCodeLine{96                 \textcolor{keywordflow}{if} (temp\_weight.size() != num\_nodes\_[layer\_index] * num\_nodes\_[layer\_index + 1]) \{}
\DoxyCodeLine{97                     \textcolor{keywordflow}{throw} BuildException(\{}
\DoxyCodeLine{98                         \textcolor{stringliteral}{"WARNING: layer weight size = "} + std::to\_string(temp\_weight.size()) +  \textcolor{stringliteral}{" expected: "}}
\DoxyCodeLine{99                         + std::to\_string(num\_nodes\_[layer\_index] * num\_nodes\_[layer\_index + 1])}
\DoxyCodeLine{100                     \});}
\DoxyCodeLine{101                 \}}
\DoxyCodeLine{102                 Eigen::Map<Eigen::MatrixXd> temp\_weight\_v(}
\DoxyCodeLine{103                     \&temp\_weight[0], num\_nodes\_[layer\_index], num\_nodes\_[layer\_index + 1]}
\DoxyCodeLine{104                 );}
\DoxyCodeLine{105                 std::getline(my\_f, temp\_vec);}
\DoxyCodeLine{106                 std::istringstream ss2(temp\_vec);}
\DoxyCodeLine{107                 \textcolor{keywordflow}{while} (std::getline(ss2, token, \textcolor{charliteral}{','}))}
\DoxyCodeLine{108                 \{}
\DoxyCodeLine{109                     temp\_bias.push\_back(stod(token));}
\DoxyCodeLine{110                 \}}
\DoxyCodeLine{111                 \textcolor{keywordflow}{if} (temp\_bias.size() != num\_nodes\_[layer\_index + 1]) \{}
\DoxyCodeLine{112                     \textcolor{keywordflow}{throw} BuildException(\{}
\DoxyCodeLine{113                         \textcolor{stringliteral}{"WARNING: layer bias size = "} + std::to\_string(temp\_bias.size())}
\DoxyCodeLine{114                         + \textcolor{stringliteral}{" expected: "} + std::to\_string(num\_nodes\_[layer\_index + 1])}
\DoxyCodeLine{115                     \});}
\DoxyCodeLine{116                 \}}
\DoxyCodeLine{117                 \mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} temp\_bias\_v = Vector::Map(temp\_bias.data(), temp\_bias.size());}
\DoxyCodeLine{118                 weight\_coeff\_.push\_back(temp\_weight\_v);}
\DoxyCodeLine{119                 bias\_.push\_back(temp\_bias\_v);}
\DoxyCodeLine{120                 layer\_index ++;}
\DoxyCodeLine{121             \}}
\DoxyCodeLine{122         \}}

\end{DoxyCode}


Referenced by Build().

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1ANNCV_ac2a9803e346a8da16cc785becaa3b291_icgraph}
\end{center}
\end{figure}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_a8173b4f597f6eba50295c5eeb508dec1}\label{classSSAGES_1_1ANNCV_a8173b4f597f6eba50295c5eeb508dec1}} 
\index{SSAGES::ANNCV@{SSAGES::ANNCV}!Build@{Build}}
\index{Build@{Build}!SSAGES::ANNCV@{SSAGES::ANNCV}}
\doxysubsubsection{\texorpdfstring{Build()}{Build()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{classSSAGES_1_1ANNCV}{A\+N\+N\+CV}}$\ast$ S\+S\+A\+G\+E\+S\+::\+A\+N\+N\+C\+V\+::\+Build (\begin{DoxyParamCaption}\item[{const Json\+::\+Value \&}]{json,  }\item[{const std\+::string \&}]{path }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Set up collective variable. 


\begin{DoxyParams}{Parameters}
{\em json} & \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} input value. \\
\hline
{\em path} & Path for \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} path specification. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the CV built by this function. {\ttfamily nullptr} in case of unknown error.
\end{DoxyReturn}
Builds a CV from a \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node. Returns a pointer to the built cv. If an unknown error is encountered, this function will return a {\ttfamily nullptr}, but generally it will throw a \mbox{\hyperlink{classSSAGES_1_1BuildException}{Build\+Exception}} on failure. \begin{DoxyWarning}{Warning}
Object lifetime is the caller\textquotesingle{}s responsibility. 
\end{DoxyWarning}


Definition at line 244 of file A\+N\+N\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{245         \{}
\DoxyCodeLine{246             \mbox{\hyperlink{classJson_1_1ObjectRequirement}{Json::ObjectRequirement}} validator;}
\DoxyCodeLine{247             Json::Value schema;}
\DoxyCodeLine{248             Json::CharReaderBuilder rbuilder;}
\DoxyCodeLine{249             Json::CharReader* reader = rbuilder.newCharReader();}
\DoxyCodeLine{250 }
\DoxyCodeLine{251             reader-\/>parse(JsonSchema::ANNCV.c\_str(),}
\DoxyCodeLine{252                           JsonSchema::ANNCV.c\_str() + JsonSchema::ANNCV.size(),}
\DoxyCodeLine{253                           \&schema, NULL);}
\DoxyCodeLine{254             validator.\mbox{\hyperlink{classJson_1_1ObjectRequirement_a4ed02ae1d612a5efba1688fcdd2df092}{Parse}}(schema, path);}
\DoxyCodeLine{255 }
\DoxyCodeLine{256             \textcolor{comment}{// Validate inputs.}}
\DoxyCodeLine{257             validator.\mbox{\hyperlink{classJson_1_1ObjectRequirement_a9ac3b920001a35bc70580035d8d802b7}{Validate}}(json, path);}
\DoxyCodeLine{258             \textcolor{keywordflow}{if}(validator.\mbox{\hyperlink{classJson_1_1Requirement_adfaec336a9f051d6f6b9a6d7f1d97b75}{HasErrors}}())}
\DoxyCodeLine{259                 \textcolor{keywordflow}{throw} BuildException(validator.\mbox{\hyperlink{classJson_1_1Requirement_a60bc275c366eb59f192fa2e621268480}{GetErrors}}());}
\DoxyCodeLine{260 }
\DoxyCodeLine{261             std::vector<int> atomids;}
\DoxyCodeLine{262             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& s : json[\textcolor{stringliteral}{"atom\_ids"}])}
\DoxyCodeLine{263                 atomids.push\_back(s.asInt());}
\DoxyCodeLine{264             \textcolor{keywordtype}{double} scaling\_factor = json[\textcolor{stringliteral}{"scaling\_factor"}].asDouble();}
\DoxyCodeLine{265             std::vector<int> num\_nodes;}
\DoxyCodeLine{266             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&s : json[\textcolor{stringliteral}{"num\_nodes"}])}
\DoxyCodeLine{267                 num\_nodes.push\_back(s.asInt());}
\DoxyCodeLine{268             std::vector<std::string> activations;}
\DoxyCodeLine{269             std::string coeff\_file = json[\textcolor{stringliteral}{"coeff\_file"}].asString();}
\DoxyCodeLine{270             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \&s : json[\textcolor{stringliteral}{"activations"}]) \{}
\DoxyCodeLine{271                 \textcolor{keyword}{auto} name = s.asString();}
\DoxyCodeLine{272                 \textcolor{keywordflow}{if} (name == \textcolor{stringliteral}{"Tanh"} || name == \textcolor{stringliteral}{"ReLU"} || name == \textcolor{stringliteral}{"Linear"})}
\DoxyCodeLine{273                     activations.push\_back(name);}
\DoxyCodeLine{274                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{275                     \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"invalid activation function "} + name + \textcolor{stringliteral}{" provided"});}
\DoxyCodeLine{276             \}}
\DoxyCodeLine{277             \textcolor{keywordtype}{int} out\_index = json[\textcolor{stringliteral}{"index"}].asInt();}
\DoxyCodeLine{278             \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classSSAGES_1_1ANNCV_ac2a9803e346a8da16cc785becaa3b291}{ANNCV}}(atomids, scaling\_factor, num\_nodes, coeff\_file, activations, out\_index);}
\DoxyCodeLine{279         \}}

\end{DoxyCode}


References A\+N\+N\+C\+V(), Json\+::\+Requirement\+::\+Get\+Errors(), Json\+::\+Requirement\+::\+Has\+Errors(), Json\+::\+Object\+Requirement\+::\+Parse(), and Json\+::\+Object\+Requirement\+::\+Validate().



Referenced by S\+S\+A\+G\+E\+S\+::\+Collective\+Variable\+::\+Build\+C\+V().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1ANNCV_a8173b4f597f6eba50295c5eeb508dec1_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1ANNCV_a8173b4f597f6eba50295c5eeb508dec1_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_a1ddb11f32dbf1c1c19e119310c047a0d}\label{classSSAGES_1_1ANNCV_a1ddb11f32dbf1c1c19e119310c047a0d}} 
\index{SSAGES::ANNCV@{SSAGES::ANNCV}!Evaluate@{Evaluate}}
\index{Evaluate@{Evaluate}!SSAGES::ANNCV@{SSAGES::ANNCV}}
\doxysubsubsection{\texorpdfstring{Evaluate()}{Evaluate()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+A\+N\+N\+C\+V\+::\+Evaluate (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&}]{snapshot }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}



Evaluate the CV. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Current simulation snapshot. \\
\hline
\end{DoxyParams}


Definition at line 194 of file A\+N\+N\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{195         \{}
\DoxyCodeLine{196             \textcolor{comment}{// Get data from snapshot.}}
\DoxyCodeLine{197             \textcolor{keyword}{auto} n = snapshot.GetNumAtoms();}
\DoxyCodeLine{198             \textcolor{keyword}{const} \textcolor{keyword}{auto}\& pos = snapshot.GetPositions();}
\DoxyCodeLine{199             \textcolor{keyword}{auto}\& comm = snapshot.GetCommunicator();}
\DoxyCodeLine{200 }
\DoxyCodeLine{201             \textcolor{comment}{// Initialize gradient.}}
\DoxyCodeLine{202             std::fill(\mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}.begin(), \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}.end(), \mbox{\hyperlink{namespaceSSAGES_a630084a0a5e185e89e21b3735f8f8b2e}{Vector3}}\{0,0,0\});}
\DoxyCodeLine{203             \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}.resize(n, \mbox{\hyperlink{namespaceSSAGES_a630084a0a5e185e89e21b3735f8f8b2e}{Vector3}}\{0,0,0\});}
\DoxyCodeLine{204 }
\DoxyCodeLine{205             \textcolor{comment}{// Vector3 xi\{0, 0, 0\}, xj\{0, 0, 0\}, xk\{0, 0, 0\};}}
\DoxyCodeLine{206             std::vector<Vector3> positions(atomids\_.size(), \mbox{\hyperlink{namespaceSSAGES_a630084a0a5e185e89e21b3735f8f8b2e}{Vector3}}(\{0,0,0\}));}
\DoxyCodeLine{207             \mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}} local\_idx;}
\DoxyCodeLine{208             snapshot.GetLocalIndices(atomids\_, \&local\_idx);}
\DoxyCodeLine{209             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ii = 0; ii < atomids\_.size(); ii ++) \{}
\DoxyCodeLine{210                 \textcolor{keywordflow}{if} (local\_idx[ii] != -\/1) \{}
\DoxyCodeLine{211                     positions[ii] = pos[local\_idx[ii]];}
\DoxyCodeLine{212                 \}}
\DoxyCodeLine{213             \}}
\DoxyCodeLine{214             \textcolor{comment}{// By performing a reduce, we actually collect all. This can}}
\DoxyCodeLine{215             \textcolor{comment}{// be converted to a more intelligent allgater on rank then bcast.}}
\DoxyCodeLine{216             MPI\_Allreduce(MPI\_IN\_PLACE, positions.data(), positions.size(), MPI\_DOUBLE, MPI\_SUM, comm);}
\DoxyCodeLine{217             \textcolor{keyword}{auto} com = snapshot.CenterOfMass(atomids\_, \textcolor{keyword}{false});  \textcolor{comment}{// center of mass coordinates (not weighted with mass)}}
\DoxyCodeLine{218             \textcolor{comment}{// remove translation degree of freedom}}
\DoxyCodeLine{219             \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& temp\_pos: positions) \{}
\DoxyCodeLine{220                 temp\_pos = temp\_pos -\/ com;}
\DoxyCodeLine{221             \}}
\DoxyCodeLine{222             \mbox{\hyperlink{namespaceSSAGES_a3a489a370adbddfb160942e834c1b0c7}{Vector}} input\_vec(positions.size() * 3);  \textcolor{comment}{// flatten input vector}}
\DoxyCodeLine{223             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ii = 0; ii < positions.size(); ii ++) \{}
\DoxyCodeLine{224                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} jj = 0; jj < 3; jj ++) \{}
\DoxyCodeLine{225                     input\_vec[ii * 3 + jj] = positions[ii][jj];}
\DoxyCodeLine{226                 \}}
\DoxyCodeLine{227             \}}
\DoxyCodeLine{228             input\_vec = input\_vec / scaling\_factor\_;}
\DoxyCodeLine{229             \textcolor{keyword}{auto} output\_of\_layers = forward\_prop(input\_vec);}
\DoxyCodeLine{230             \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a65b17f3e9b3c967ad42814c3eec88bb2}{val\_}} = output\_of\_layers[output\_of\_layers.size() -\/ 1][out\_index\_];}
\DoxyCodeLine{231             \textcolor{keyword}{auto} deriv\_back = back\_prop(output\_of\_layers);}
\DoxyCodeLine{232             \textcolor{comment}{// subtract mean from deriv\_back[0]}}
\DoxyCodeLine{233             \textcolor{keywordtype}{int} num\_atoms = deriv\_back[0].size() / 3;}
\DoxyCodeLine{234             \textcolor{keywordtype}{double} average[3] = \{0\};}
\DoxyCodeLine{235             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} kk = 0; kk < 3; kk ++) \{}
\DoxyCodeLine{236                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} ii = 0; ii < num\_atoms; ii ++) \{}
\DoxyCodeLine{237                     average[kk] += deriv\_back[0][ii * 3 + kk];}
\DoxyCodeLine{238                 \}}
\DoxyCodeLine{239                 average[kk] /= num\_atoms;}
\DoxyCodeLine{240             \}}
\DoxyCodeLine{241         \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Center\+Of\+Mass(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Communicator(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Local\+Indices(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Num\+Atoms(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Positions(), S\+S\+A\+G\+E\+S\+::\+Collective\+Variable\+::grad\+\_\+, and S\+S\+A\+G\+E\+S\+::\+Collective\+Variable\+::val\+\_\+.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1ANNCV_a1ddb11f32dbf1c1c19e119310c047a0d_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1ANNCV_a0a00620dd01926d57136d1c28420a7d4}\label{classSSAGES_1_1ANNCV_a0a00620dd01926d57136d1c28420a7d4}} 
\index{SSAGES::ANNCV@{SSAGES::ANNCV}!Initialize@{Initialize}}
\index{Initialize@{Initialize}!SSAGES::ANNCV@{SSAGES::ANNCV}}
\doxysubsubsection{\texorpdfstring{Initialize()}{Initialize()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+A\+N\+N\+C\+V\+::\+Initialize (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&}]{snapshot }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}



Initialize necessary variables. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Current simulation snapshot. \\
\hline
\end{DoxyParams}


Definition at line 128 of file A\+N\+N\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{129         \{}
\DoxyCodeLine{130             \textcolor{keyword}{using} std::to\_string;}
\DoxyCodeLine{131 }
\DoxyCodeLine{132             std::vector<int> found;}
\DoxyCodeLine{133             snapshot.GetLocalIndices(atomids\_, \&found);}
\DoxyCodeLine{134             \textcolor{keywordtype}{int} nfound = found.size();}
\DoxyCodeLine{135             MPI\_Allreduce(MPI\_IN\_PLACE, \&nfound, 1, MPI\_INT, MPI\_SUM, snapshot.GetCommunicator());}
\DoxyCodeLine{136 }
\DoxyCodeLine{137             \textcolor{keywordflow}{if}(nfound != atomids\_.size())}
\DoxyCodeLine{138                 \textcolor{keywordflow}{throw} BuildException(\{}
\DoxyCodeLine{139                     \textcolor{stringliteral}{"ANNCV: Expected to find "} +}
\DoxyCodeLine{140                     to\_string(atomids\_.size()) +}
\DoxyCodeLine{141                     \textcolor{stringliteral}{" atoms, but only found "} +}
\DoxyCodeLine{142                     to\_string(nfound) + \textcolor{stringliteral}{"."}}
\DoxyCodeLine{143                 \});}
\DoxyCodeLine{144         \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Communicator(), and S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Local\+Indices().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1ANNCV_a0a00620dd01926d57136d1c28420a7d4_cgraph}
\end{center}
\end{figure}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
/home/michael/development/\+S\+S\+A\+G\+E\+S/src/\+C\+Vs/A\+N\+N\+C\+V.\+h\end{DoxyCompactItemize}
