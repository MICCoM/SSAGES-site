\hypertarget{classSSAGES_1_1PairwiseCV}{}\doxysection{S\+S\+A\+G\+ES\+::Pairwise\+CV Class Reference}
\label{classSSAGES_1_1PairwiseCV}\index{SSAGES::PairwiseCV@{SSAGES::PairwiseCV}}


Generalized collective variable based on pairwise properties of atoms.  




{\ttfamily \#include $<$Pairwise\+C\+V.\+h$>$}



Inheritance diagram for S\+S\+A\+G\+ES\+::Pairwise\+CV\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=223pt]{classSSAGES_1_1PairwiseCV__inherit__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a77ae0e65a307c1ed5a9d62a484594620}{Pairwise\+CV}} (const \mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}} \&group1, const \mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}} \&group2, \mbox{\hyperlink{classSSAGES_1_1PairwiseKernel}{Pairwise\+Kernel}} $\ast$pk)
\begin{DoxyCompactList}\small\item\em Constructor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a1399e3e75014393502c1dd0ff91b2c95}{Initialize}} (const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&snapshot) override
\begin{DoxyCompactList}\small\item\em Initialize necessary variables. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a807d3a560a3a187c7648da5a282027df}{Evaluate}} (const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&snapshot) override
\begin{DoxyCompactList}\small\item\em Evaluate the CV. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1PairwiseCV_a879b9101ef9db68846f20c9b8a2ddaa8}\label{classSSAGES_1_1PairwiseCV_a879b9101ef9db68846f20c9b8a2ddaa8}} 
\mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a879b9101ef9db68846f20c9b8a2ddaa8}{$\sim$\+Pairwise\+CV}} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Static Public Member Functions}
\begin{DoxyCompactItemize}
\item 
static \mbox{\hyperlink{classSSAGES_1_1PairwiseCV}{Pairwise\+CV}} $\ast$ \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_ad07080b9c899d5a31f233a2103994931}{Build}} (const Json\+::\+Value \&json, const std\+::string \&path)
\begin{DoxyCompactList}\small\item\em Set up collective variable. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classSSAGES_1_1PairwiseCV_a0cd20f16a2efe8f80350e8e822c1300b}\label{classSSAGES_1_1PairwiseCV_a0cd20f16a2efe8f80350e8e822c1300b}} 
\mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}} \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a0cd20f16a2efe8f80350e8e822c1300b}{group1\+\_\+}}
\begin{DoxyCompactList}\small\item\em I\+Ds of the first group of atoms. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1PairwiseCV_a490ab92a63322695d8be2a93ef5121d6}\label{classSSAGES_1_1PairwiseCV_a490ab92a63322695d8be2a93ef5121d6}} 
\mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}} \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a490ab92a63322695d8be2a93ef5121d6}{group2\+\_\+}}
\begin{DoxyCompactList}\small\item\em I\+Ds of the second group of atoms. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{classSSAGES_1_1PairwiseCV_ad9a650d491217bde6c9f31d41244aeba}\label{classSSAGES_1_1PairwiseCV_ad9a650d491217bde6c9f31d41244aeba}} 
\mbox{\hyperlink{classSSAGES_1_1PairwiseKernel}{Pairwise\+Kernel}} $\ast$ \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_ad9a650d491217bde6c9f31d41244aeba}{pk\+\_\+}}
\begin{DoxyCompactList}\small\item\em Pairwise kernel function used for CV. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Additional Inherited Members}


\doxysubsection{Detailed Description}
Generalized collective variable based on pairwise properties of atoms. 

Collective variable on pairwise properties between two groups of atoms. To ensure generality of usage, there are various pairwise kernel functions from which to choose. 

Definition at line 40 of file Pairwise\+C\+V.\+h.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classSSAGES_1_1PairwiseCV_a77ae0e65a307c1ed5a9d62a484594620}\label{classSSAGES_1_1PairwiseCV_a77ae0e65a307c1ed5a9d62a484594620}} 
\index{SSAGES::PairwiseCV@{SSAGES::PairwiseCV}!PairwiseCV@{PairwiseCV}}
\index{PairwiseCV@{PairwiseCV}!SSAGES::PairwiseCV@{SSAGES::PairwiseCV}}
\doxysubsubsection{\texorpdfstring{PairwiseCV()}{PairwiseCV()}}
{\footnotesize\ttfamily S\+S\+A\+G\+E\+S\+::\+Pairwise\+C\+V\+::\+Pairwise\+CV (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}} \&}]{group1,  }\item[{const \mbox{\hyperlink{namespaceSSAGES_afbb26053e292f94ea83b1c441ce6df74}{Label}} \&}]{group2,  }\item[{\mbox{\hyperlink{classSSAGES_1_1PairwiseKernel}{Pairwise\+Kernel}} $\ast$}]{pk }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}}



Constructor. 


\begin{DoxyParams}{Parameters}
{\em group1} & I\+Ds of the first group of atoms. \\
\hline
{\em group2} & I\+Ds of the second group of atoms. \\
\hline
{\em pk} & pairwise kernel (function) to use.\\
\hline
\end{DoxyParams}
Construct a \mbox{\hyperlink{classSSAGES_1_1PairwiseCV}{Pairwise\+CV}}. 

Definition at line 57 of file Pairwise\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{57                                                                                  : }
\DoxyCodeLine{58         \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a0cd20f16a2efe8f80350e8e822c1300b}{group1\_}}(group1), \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a490ab92a63322695d8be2a93ef5121d6}{group2\_}}(group2), \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_ad9a650d491217bde6c9f31d41244aeba}{pk\_}}(pk)}
\DoxyCodeLine{59         \{}
\DoxyCodeLine{60         \}}

\end{DoxyCode}


Referenced by Build().

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1PairwiseCV_a77ae0e65a307c1ed5a9d62a484594620_icgraph}
\end{center}
\end{figure}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classSSAGES_1_1PairwiseCV_ad07080b9c899d5a31f233a2103994931}\label{classSSAGES_1_1PairwiseCV_ad07080b9c899d5a31f233a2103994931}} 
\index{SSAGES::PairwiseCV@{SSAGES::PairwiseCV}!Build@{Build}}
\index{Build@{Build}!SSAGES::PairwiseCV@{SSAGES::PairwiseCV}}
\doxysubsubsection{\texorpdfstring{Build()}{Build()}}
{\footnotesize\ttfamily static \mbox{\hyperlink{classSSAGES_1_1PairwiseCV}{Pairwise\+CV}}$\ast$ S\+S\+A\+G\+E\+S\+::\+Pairwise\+C\+V\+::\+Build (\begin{DoxyParamCaption}\item[{const Json\+::\+Value \&}]{json,  }\item[{const std\+::string \&}]{path }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [static]}}



Set up collective variable. 


\begin{DoxyParams}{Parameters}
{\em json} & \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} input value. \\
\hline
{\em path} & Path for \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} path specification. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Pointer to the CV built by this function. {\ttfamily nullptr} in case of unknown error.
\end{DoxyReturn}
Builds a CV from a \mbox{\hyperlink{namespaceJSON}{J\+S\+ON}} node. Returns a pointer to the built cv. If an unknown error is encountered, this function will return a {\ttfamily nullptr}, but generally it will throw a \mbox{\hyperlink{classSSAGES_1_1BuildException}{Build\+Exception}} on failure. \begin{DoxyWarning}{Warning}
Object lifetime is the caller\textquotesingle{}s responsibility. 
\end{DoxyWarning}


Definition at line 200 of file Pairwise\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{201         \{}
\DoxyCodeLine{202             \mbox{\hyperlink{classJson_1_1ObjectRequirement}{Json::ObjectRequirement}} validator;}
\DoxyCodeLine{203             Json::Value schema;}
\DoxyCodeLine{204             Json::CharReaderBuilder rbuilder;}
\DoxyCodeLine{205             Json::CharReader* reader = rbuilder.newCharReader();}
\DoxyCodeLine{206 }
\DoxyCodeLine{207             reader-\/>parse(JsonSchema::PairwiseCV.c\_str(),}
\DoxyCodeLine{208                           JsonSchema::PairwiseCV.c\_str() + JsonSchema::PairwiseCV.size(),}
\DoxyCodeLine{209                           \&schema, \textcolor{keyword}{nullptr});}
\DoxyCodeLine{210             validator.\mbox{\hyperlink{classJson_1_1ObjectRequirement_a4ed02ae1d612a5efba1688fcdd2df092}{Parse}}(schema, path);}
\DoxyCodeLine{211 }
\DoxyCodeLine{212             \textcolor{comment}{// Validate inputs.}}
\DoxyCodeLine{213             validator.\mbox{\hyperlink{classJson_1_1ObjectRequirement_a9ac3b920001a35bc70580035d8d802b7}{Validate}}(json, path);}
\DoxyCodeLine{214             \textcolor{keywordflow}{if}(validator.\mbox{\hyperlink{classJson_1_1Requirement_adfaec336a9f051d6f6b9a6d7f1d97b75}{HasErrors}}())}
\DoxyCodeLine{215                 \textcolor{keywordflow}{throw} BuildException(validator.\mbox{\hyperlink{classJson_1_1Requirement_a60bc275c366eb59f192fa2e621268480}{GetErrors}}());}
\DoxyCodeLine{216             }
\DoxyCodeLine{217             std::vector<int> group1, group2;}
\DoxyCodeLine{218             }
\DoxyCodeLine{219             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& s : json[\textcolor{stringliteral}{"group1"}])}
\DoxyCodeLine{220                 group1.push\_back(s.asInt());}
\DoxyCodeLine{221 }
\DoxyCodeLine{222             \textcolor{keywordflow}{for}(\textcolor{keyword}{auto}\& s : json[\textcolor{stringliteral}{"group2"}])}
\DoxyCodeLine{223                 group2.push\_back(s.asInt());}
\DoxyCodeLine{224             }
\DoxyCodeLine{225             \textcolor{keywordflow}{return} \textcolor{keyword}{new} \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a77ae0e65a307c1ed5a9d62a484594620}{PairwiseCV}}(group1, group2, \mbox{\hyperlink{classSSAGES_1_1PairwiseKernel_a86c0b897d04fe123892e6c2040bfb93c}{PairwiseKernel::Build}}(json[\textcolor{stringliteral}{"kernel"}], path));}
\DoxyCodeLine{226         \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+Pairwise\+Kernel\+::\+Build(), Json\+::\+Requirement\+::\+Get\+Errors(), Json\+::\+Requirement\+::\+Has\+Errors(), Pairwise\+C\+V(), Json\+::\+Object\+Requirement\+::\+Parse(), and Json\+::\+Object\+Requirement\+::\+Validate().



Referenced by S\+S\+A\+G\+E\+S\+::\+Collective\+Variable\+::\+Build\+C\+V().

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1PairwiseCV_ad07080b9c899d5a31f233a2103994931_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1PairwiseCV_ad07080b9c899d5a31f233a2103994931_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1PairwiseCV_a807d3a560a3a187c7648da5a282027df}\label{classSSAGES_1_1PairwiseCV_a807d3a560a3a187c7648da5a282027df}} 
\index{SSAGES::PairwiseCV@{SSAGES::PairwiseCV}!Evaluate@{Evaluate}}
\index{Evaluate@{Evaluate}!SSAGES::PairwiseCV@{SSAGES::PairwiseCV}}
\doxysubsubsection{\texorpdfstring{Evaluate()}{Evaluate()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Pairwise\+C\+V\+::\+Evaluate (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&}]{snapshot }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}



Evaluate the CV. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Current simulation snapshot. \\
\hline
\end{DoxyParams}


Definition at line 112 of file Pairwise\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{113         \{}
\DoxyCodeLine{114             \textcolor{comment}{// Get local atom indices.}}
\DoxyCodeLine{115             std::vector<int> idx1, idx2;}
\DoxyCodeLine{116             snapshot.GetLocalIndices(\mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a0cd20f16a2efe8f80350e8e822c1300b}{group1\_}}, \&idx1);}
\DoxyCodeLine{117             snapshot.GetLocalIndices(\mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a490ab92a63322695d8be2a93ef5121d6}{group2\_}}, \&idx2);}
\DoxyCodeLine{118 }
\DoxyCodeLine{119             \textcolor{comment}{// Get data from snapshot. }}
\DoxyCodeLine{120             \textcolor{keyword}{auto} n = snapshot.GetNumAtoms();}
\DoxyCodeLine{121             \textcolor{keyword}{auto}\& atomids = snapshot.GetAtomIDs();}
\DoxyCodeLine{122             \textcolor{keyword}{auto}\& positions = snapshot.GetPositions();}
\DoxyCodeLine{123             \textcolor{keyword}{auto}\& comm = snapshot.GetCommunicator();}
\DoxyCodeLine{124 }
\DoxyCodeLine{125             \textcolor{comment}{// Initialize gradient.}}
\DoxyCodeLine{126             std::fill(\mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}.begin(), \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}.end(), \mbox{\hyperlink{namespaceSSAGES_a630084a0a5e185e89e21b3735f8f8b2e}{Vector3}}\{0,0,0\});}
\DoxyCodeLine{127             \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}.resize(n, \mbox{\hyperlink{namespaceSSAGES_a630084a0a5e185e89e21b3735f8f8b2e}{Vector3}}\{0,0,0\});}
\DoxyCodeLine{128             \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a3896192a76e97af8f41a39be9e220f13}{boxgrad\_}} = Matrix3::Zero();}
\DoxyCodeLine{129 }
\DoxyCodeLine{130             \textcolor{comment}{// Fill eigen matrix with coordinate data. }}
\DoxyCodeLine{131             std::vector<double> pos1(3*idx1.size()), pos2(3*idx2.size());}
\DoxyCodeLine{132             std::vector<int> id1(idx1.size()), id2(idx2.size()); }
\DoxyCodeLine{133             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < idx1.size(); ++i)}
\DoxyCodeLine{134             \{}
\DoxyCodeLine{135                 pos1[3*i+0] = positions[idx1[i]][0]; }
\DoxyCodeLine{136                 pos1[3*i+1] = positions[idx1[i]][1]; }
\DoxyCodeLine{137                 pos1[3*i+2] = positions[idx1[i]][2];}
\DoxyCodeLine{138 }
\DoxyCodeLine{139                 id1[i] = atomids[idx1[i]];}
\DoxyCodeLine{140             \}}
\DoxyCodeLine{141 }
\DoxyCodeLine{142             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < idx2.size(); ++i)}
\DoxyCodeLine{143             \{}
\DoxyCodeLine{144                 pos2[3*i+0] = positions[idx2[i]][0]; }
\DoxyCodeLine{145                 pos2[3*i+1] = positions[idx2[i]][1]; }
\DoxyCodeLine{146                 pos2[3*i+2] = positions[idx2[i]][2];}
\DoxyCodeLine{147 }
\DoxyCodeLine{148                 id2[i] = atomids[idx2[i]];}
\DoxyCodeLine{149             \}}
\DoxyCodeLine{150 }
\DoxyCodeLine{151             \textcolor{comment}{// Gather across all procs. }}
\DoxyCodeLine{152             pos1 = mxx::allgatherv(pos1.data(), pos1.size(), comm);}
\DoxyCodeLine{153             pos2 = mxx::allgatherv(pos2.data(), pos2.size(), comm);}
\DoxyCodeLine{154             id1 = mxx::allgatherv(id1.data(), id1.size(), comm);}
\DoxyCodeLine{155             id2 = mxx::allgatherv(id2.data(), id2.size(), comm);}
\DoxyCodeLine{156 }
\DoxyCodeLine{157             \textcolor{comment}{// Create Eigen map for ease of use.}}
\DoxyCodeLine{158             \textcolor{keyword}{using} Map = Eigen::Map<Eigen::Matrix<double, Eigen::Dynamic, 3, Eigen::RowMajor>>;}
\DoxyCodeLine{159             Map gpos1(pos1.data(), \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a0cd20f16a2efe8f80350e8e822c1300b}{group1\_}}.size(), 3), gpos2(pos2.data(), \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a490ab92a63322695d8be2a93ef5121d6}{group2\_}}.size(), 3);}
\DoxyCodeLine{160 }
\DoxyCodeLine{161             \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a65b17f3e9b3c967ad42814c3eec88bb2}{val\_}} = 0;}
\DoxyCodeLine{162             \textcolor{keywordtype}{double} df = 0.;}
\DoxyCodeLine{163             \textcolor{comment}{// Compute gradient and value.}}
\DoxyCodeLine{164             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a0cd20f16a2efe8f80350e8e822c1300b}{group1\_}}.size(); ++i)}
\DoxyCodeLine{165             \{}
\DoxyCodeLine{166                 \textcolor{keyword}{auto} t1 = id1[i];}
\DoxyCodeLine{167                 \textcolor{keyword}{const} \textcolor{keyword}{auto}\& pi = gpos1.row(i);}
\DoxyCodeLine{168                 \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} j = 0; j < \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a490ab92a63322695d8be2a93ef5121d6}{group2\_}}.size(); ++j)}
\DoxyCodeLine{169                 \{}
\DoxyCodeLine{170                     \textcolor{keyword}{auto} t2 = id2[j];}
\DoxyCodeLine{171                     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& pj = gpos2.row(j);}
\DoxyCodeLine{172 }
\DoxyCodeLine{173                     \textcolor{comment}{// Skip identical pairs. }}
\DoxyCodeLine{174                     \textcolor{keywordflow}{if}(t1 == t2)}
\DoxyCodeLine{175                         \textcolor{keywordflow}{continue};}
\DoxyCodeLine{176                     }
\DoxyCodeLine{177                     \textcolor{comment}{// Compute distance and pairwise function. }}
\DoxyCodeLine{178                     \mbox{\hyperlink{namespaceSSAGES_a630084a0a5e185e89e21b3735f8f8b2e}{Vector3}} rij = pi -\/ pj;}
\DoxyCodeLine{179                     snapshot.ApplyMinimumImage(\&rij);}
\DoxyCodeLine{180                     \textcolor{keyword}{auto} r = rij.norm();}
\DoxyCodeLine{181                     \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a65b17f3e9b3c967ad42814c3eec88bb2}{val\_}} +=  \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_ad9a650d491217bde6c9f31d41244aeba}{pk\_}}-\/>\mbox{\hyperlink{classSSAGES_1_1PairwiseKernel_a4c8fb122b9d895399a04f0df76d3a9d4}{Evaluate}}(r, df);}
\DoxyCodeLine{182 }
\DoxyCodeLine{183                     \textcolor{comment}{// Get local indices and sum gradients.}}
\DoxyCodeLine{184                     \textcolor{keyword}{auto} lid1 = snapshot.GetLocalIndex(t1);}
\DoxyCodeLine{185                     \textcolor{keywordflow}{if}(lid1 != -\/1)}
\DoxyCodeLine{186                         \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}[lid1] += df*rij/r;}
\DoxyCodeLine{187                     }
\DoxyCodeLine{188                     \textcolor{keyword}{auto} lid2 = snapshot.GetLocalIndex(t2);}
\DoxyCodeLine{189                     \textcolor{keywordflow}{if}(lid2 != -\/1)}
\DoxyCodeLine{190                         \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a390202f6e541da879f1cfcde22c49489}{grad\_}}[lid2] -\/= df*rij/r;}
\DoxyCodeLine{191 }
\DoxyCodeLine{192                     \textcolor{comment}{// Only sum box gradient on a single proc.}}
\DoxyCodeLine{193                     \textcolor{keywordflow}{if}(comm.rank() == 0)}
\DoxyCodeLine{194                         \mbox{\hyperlink{classSSAGES_1_1CollectiveVariable_a3896192a76e97af8f41a39be9e220f13}{boxgrad\_}} += df*rij/r*rij.transpose();}
\DoxyCodeLine{195                 \}}
\DoxyCodeLine{196             \}}
\DoxyCodeLine{197         \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Apply\+Minimum\+Image(), S\+S\+A\+G\+E\+S\+::\+Collective\+Variable\+::boxgrad\+\_\+, S\+S\+A\+G\+E\+S\+::\+Pairwise\+Kernel\+::\+Evaluate(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Atom\+I\+Ds(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Communicator(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Local\+Index(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Local\+Indices(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Num\+Atoms(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Positions(), S\+S\+A\+G\+E\+S\+::\+Collective\+Variable\+::grad\+\_\+, group1\+\_\+, group2\+\_\+, pk\+\_\+, and S\+S\+A\+G\+E\+S\+::\+Collective\+Variable\+::val\+\_\+.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1PairwiseCV_a807d3a560a3a187c7648da5a282027df_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{classSSAGES_1_1PairwiseCV_a1399e3e75014393502c1dd0ff91b2c95}\label{classSSAGES_1_1PairwiseCV_a1399e3e75014393502c1dd0ff91b2c95}} 
\index{SSAGES::PairwiseCV@{SSAGES::PairwiseCV}!Initialize@{Initialize}}
\index{Initialize@{Initialize}!SSAGES::PairwiseCV@{SSAGES::PairwiseCV}}
\doxysubsubsection{\texorpdfstring{Initialize()}{Initialize()}}
{\footnotesize\ttfamily void S\+S\+A\+G\+E\+S\+::\+Pairwise\+C\+V\+::\+Initialize (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{classSSAGES_1_1Snapshot}{Snapshot}} \&}]{snapshot }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [inline]}, {\ttfamily [override]}}



Initialize necessary variables. 


\begin{DoxyParams}{Parameters}
{\em snapshot} & Current simulation snapshot. \\
\hline
\end{DoxyParams}


Definition at line 66 of file Pairwise\+C\+V.\+h.


\begin{DoxyCode}{0}
\DoxyCodeLine{67         \{}
\DoxyCodeLine{68             \textcolor{keyword}{using} std::to\_string;}
\DoxyCodeLine{69 }
\DoxyCodeLine{70             \textcolor{keyword}{auto} n1 = \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a0cd20f16a2efe8f80350e8e822c1300b}{group1\_}}.size(), n2 = \mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a490ab92a63322695d8be2a93ef5121d6}{group2\_}}.size();}
\DoxyCodeLine{71 }
\DoxyCodeLine{72             \textcolor{comment}{// Make sure atom ID's are on at least one processor. }}
\DoxyCodeLine{73             std::vector<int> found1(n1, 0), found2(n2, 0);}
\DoxyCodeLine{74             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n1; ++i)}
\DoxyCodeLine{75             \{}
\DoxyCodeLine{76                 \textcolor{keywordflow}{if}(snapshot.GetLocalIndex(\mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a0cd20f16a2efe8f80350e8e822c1300b}{group1\_}}[i]) != -\/1)}
\DoxyCodeLine{77                     found1[i] = 1;}
\DoxyCodeLine{78             \}}
\DoxyCodeLine{79             }
\DoxyCodeLine{80             \textcolor{keywordflow}{for}(\textcolor{keywordtype}{size\_t} i = 0; i < n2; ++i)}
\DoxyCodeLine{81             \{}
\DoxyCodeLine{82                 \textcolor{keywordflow}{if}(snapshot.GetLocalIndex(\mbox{\hyperlink{classSSAGES_1_1PairwiseCV_a490ab92a63322695d8be2a93ef5121d6}{group2\_}}[i]) != -\/1)}
\DoxyCodeLine{83                     found2[i] = 1;}
\DoxyCodeLine{84             \}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86             MPI\_Allreduce(MPI\_IN\_PLACE, found1.data(), n1, MPI\_INT, MPI\_SUM, snapshot.GetCommunicator());}
\DoxyCodeLine{87             MPI\_Allreduce(MPI\_IN\_PLACE, found2.data(), n2, MPI\_INT, MPI\_SUM, snapshot.GetCommunicator());}
\DoxyCodeLine{88 }
\DoxyCodeLine{89             \textcolor{keywordtype}{unsigned} ntot1 = std::accumulate(found1.begin(), found1.end(), 0, std::plus<int>());}
\DoxyCodeLine{90             \textcolor{keywordtype}{unsigned} ntot2 = std::accumulate(found2.begin(), found2.end(), 0, std::plus<int>());}
\DoxyCodeLine{91             \textcolor{keywordflow}{if}(ntot1 != n1)}
\DoxyCodeLine{92                 \textcolor{keywordflow}{throw} BuildException(\{}
\DoxyCodeLine{93                     \textcolor{stringliteral}{"Pairwise: Expected to find "} + }
\DoxyCodeLine{94                     to\_string(n1) + }
\DoxyCodeLine{95                     \textcolor{stringliteral}{" atoms in group 1, but only found "} + }
\DoxyCodeLine{96                     to\_string(ntot1) + \textcolor{stringliteral}{"."}}
\DoxyCodeLine{97                 \});         }
\DoxyCodeLine{98 }
\DoxyCodeLine{99             \textcolor{keywordflow}{if}(ntot2 != n2)}
\DoxyCodeLine{100                 \textcolor{keywordflow}{throw} BuildException(\{}
\DoxyCodeLine{101                     \textcolor{stringliteral}{"Pairwise: Expected to find "} + }
\DoxyCodeLine{102                     to\_string(n2) + }
\DoxyCodeLine{103                     \textcolor{stringliteral}{" atoms in group 2, but only found "} + }
\DoxyCodeLine{104                     to\_string(ntot2) + \textcolor{stringliteral}{"."}}
\DoxyCodeLine{105                 \});         }
\DoxyCodeLine{106         \}}

\end{DoxyCode}


References S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Communicator(), S\+S\+A\+G\+E\+S\+::\+Snapshot\+::\+Get\+Local\+Index(), group1\+\_\+, and group2\+\_\+.

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classSSAGES_1_1PairwiseCV_a1399e3e75014393502c1dd0ff91b2c95_cgraph}
\end{center}
\end{figure}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
/home/michael/development/\+S\+S\+A\+G\+E\+S/src/\+C\+Vs/Pairwise\+C\+V.\+h\end{DoxyCompactItemize}
